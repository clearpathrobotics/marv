/*!
 * MARV
 * Copyright (C) 2016  Ternaris, Munich, Germany
 * 
 * This file is part of MARV
 * 
 * MARV is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 * 
 * MARV is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 * 
 * You should have received a copy of the GNU Affero General Public License
 * along with MARV.  If not, see <http://www.gnu.org/licenses/>.
 */

/*
 Leaflet 1.0.0, a JS library for interactive maps. http://leafletjs.com
 (c) 2010-2016 Vladimir Agafonkin, (c) 2010-2011 CloudMade
*/

function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}return info.done?void resolve(value):Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}return step("next")})}}var _uAMD_m={},_uAMD_r={},define=function(g,q,B){_uAMD_m[g]=[q,B]},require=function(g){if(!_uAMD_m[g])throw new Error("Module \""+g+"\" required, but does not exist.");if(!_uAMD_r[g]){_uAMD_r[g]={exports:{}};var q,B,C,D,E=[];for(B=0,q=_uAMD_m[g][0],C=q.length;B<C;B++)E[B]="module"===(D=q[B])?_uAMD_r[g]:"exports"===(D=q[B])?_uAMD_r[g].exports:require(D);_uAMD_m[g][1].apply(this.global||this,E)}return _uAMD_r[g].exports};define("app",["exports","muc/m","app/pods/application-route/component","app/pods/button-confirm/component","app/pods/detail-route/component","app/pods/field-datetime/component","app/pods/field-filesize/component","app/pods/field-string/component","app/pods/field-subset/component","app/pods/field-timedelta/component","app/pods/index-route/component","app/pods/input-checkbox/component","app/pods/input-control/component","app/pods/input-textarea/component","app/pods/m-select/component","app/pods/m-tag/component","app/pods/notfound-route/component","app/pods/routes/main","app/pods/widget-comment/component","app/pods/widget-filter/component","app/pods/widget-gallery/component","app/pods/widget-image/component","app/pods/widget-keyval/component","app/pods/widget-modal/component","app/pods/widget-osm/component","app/pods/widget-table/component","app/pods/widget-tag/component"],function(g,q,B,C,D,E,G,H,I,J,K,N,P,Q,R,T,U,V,W,X,Y,Z,$,_,aa,ba,ca){"use strict";function da(Fa){return Fa&&Fa.__esModule?Fa:{default:Fa}}Object.defineProperty(g,"__esModule",{value:!0});var ea=da(B),fa=da(C),ga=da(D),ha=da(E),ia=da(G),ja=da(H),ka=da(I),la=da(J),ma=da(K),na=da(N),oa=da(P),pa=da(Q),qa=da(R),ra=da(T),sa=da(U),ta=da(V),va=da(W),wa=da(X),xa=da(Y),ya=da(Z),za=da($),Aa=da(_),Ba=da(aa),Ca=da(ba),Da=da(ca);const Ea=q.M.create({});Ea.components["application-route"]=ea.default,Ea.components["button-confirm"]=fa.default,Ea.components["detail-route"]=ga.default,Ea.components["field-datetime"]=ha.default,Ea.components["field-filesize"]=ia.default,Ea.components["field-string"]=ja.default,Ea.components["field-subset"]=ka.default,Ea.components["field-timedelta"]=la.default,Ea.components["index-route"]=ma.default,Ea.components["input-checkbox"]=na.default,Ea.components["input-control"]=oa.default,Ea.components["input-textarea"]=pa.default,Ea.components["m-select"]=qa.default,Ea.components["m-tag"]=ra.default,Ea.components["notfound-route"]=sa.default,Ea.components.main=ta.default,Ea.components["widget-comment"]=va.default,Ea.components["widget-filter"]=wa.default,Ea.components["widget-gallery"]=xa.default,Ea.components["widget-image"]=ya.default,Ea.components["widget-keyval"]=za.default,Ea.components["widget-modal"]=Aa.default,Ea.components["widget-osm"]=Ba.default,Ea.components["widget-table"]=Ca.default,Ea.components["widget-tag"]=Da.default,Ea.routes=ta.default,g.default=Ea}),define("app/pods/application-route/component",["exports","muc/component","muc/observable"],function(g,q,B){"use strict";Object.defineProperty(g,"__esModule",{value:!0}),window.marvLoaded=!0;class C extends q.RoutableComponent{constructor(){super(),this.template=`
            <nav class="navbar navbar-default navbar-fixed-top">
				<div class="container-fluid">
					<div class="left-right vcenter">
						<link-to href="/"><img src="{{logo}}" width=100></link-to>
						<ul class="nav navbar-nav">
							<li>
								{{#if loggedin}}
									<button type="button" class="btn btn-default" {{"action" ("noexpand" "signout")}}>Sign out <strong>{{loggedin}}</strong></button>
								{{else}}
									<button type="button" class="btn btn-default" {{"action" ("noexpand" "openSignin")}}>Sign in</button>
								{{/if}}
							</li>
						</ul>
					</div>
				</div>
            </nav>

            <!--
            <div class="pace pace-active">
                <div class="pace-progress" data-progress="{{owner.xhrProgress}}" data-progress-text="{{owner.xhrProgress}}%" style="transform: translate3d({{owner.xhrProgress}}%, 0px, 0px);">
                    <div class="pace-progress-inner">
                    </div>
                </div>
                <div class="pace-activity"></div>
            </div>
            -->

            <div class="container-fluid main bagbunker">
                {{#if owner.ajaxError}}
                    <div class="alert alert-danger" role="alert">
                        <strong>Request failed:</strong> {{owner.ajaxError}}
                    </div>
                {{/if}}

                {{outlet}}
            </div>

            <form {{"action" ("noexpand" "signin" on="submit")}}>
                <widget-modal open={{signinOpen}}
                              setOpen={{"curry" ("noexpand" ("set" ("noexpand" signinOpen)))}}
                              title="Sign in"
                              as="target">
                    {{#if ("is-equal" target "body")}}
                            <div class="form-group">
                                <label>Username</label>
                                <input-control class="form-control"
                                               placeholder="username"
                                               value={{username}}
                                               changeAction={{"curry" ("noexpand" ("set" ("noexpand" username)))}} />
                            </div>
                            <div class="form-group {{"if" password_error "has-error"}}">
                                <label>Password</label>
                                <input-control type="password"
                                               class="form-control"
                                               placeholder="password"
                                               value={{password}}
                                               changeAction={{"curry" ("noexpand" ("set" ("noexpand" password)))}} />
                            </div>
                    {{else}}
                        <button type="submit" class="btn btn-default">Sign in</button>
                    {{/if}}
                </widget-modal>
            </form>

            <nav class="navbar navbar-inverted footer">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <a class="navbar-brand" href="https://ternaris.com" target=_blank><img src="app/styles/ternaris-weiss.svg" width=100></a>
                    </div>
                    <div class="navbar-collapse">
                    <p class="navbar-text">
                        <ul class="list-inline">
                            <li>
                                <a class="navbar-link" href={{code}} target=_blank>Code</a>
                            </li>
                            <li>
                                <a class="navbar-link" href={{issues}} target=_blank>Issues</a>
                            </li>
                        </ul>
                    </p>
                    </div>
                </div>
            </nav>
        `,this.logo=(0,B.computed)(function(){return Array.from(this.renderNode.doc.querySelectorAll("script")).map(D=>D.dataset.marvLogo).filter(D=>D)[0]}),this.code=(0,B.computed)(function(){return Array.from(this.renderNode.doc.querySelectorAll("script")).map(D=>D.dataset.marvCodeLink).filter(D=>D)[0]}),this.issues=(0,B.computed)(function(){return Array.from(this.renderNode.doc.querySelectorAll("script")).map(D=>D.dataset.marvIssuesLink).filter(D=>D)[0]}),this.loggedin="",this.username="",this.password="",this.password_error=(0,B.computed)("username","password",function(){return!1}),this.apiEndpoint=`${document.querySelector("base").href}marv/api/2/`,this.sleep=D=>{return new Promise((E,G)=>{setTimeout(()=>{E("foo")},D)})},this.actions={openSignin(){this.signinOpen=!0},signin(D){const E={url:"login",method:"POST",data:{username:this.username,password:this.password}};this.api(E).then(G=>{G.username?(this.loggedin=G.username,this.username="",this.password="",this.signinOpen=!1):(this.password="",this.password_error=!0)}),D.preventDefault()},signout(){this.api({url:"logout",method:"POST"}).then(D=>{this.loggedin=""})}}}modelHook(){return this.api({url:"login"}).then(D=>{this.loggedin=D.username||""})}api(D){return D.url=`${this.apiEndpoint}${D.url}`,this.loading=!0,this.getOwner().ajax(D).then(E=>{return this.loading=!1,this.error=E.error,E},E=>{return this.error="The frontend is unable to communicate with the server.",E})}postData(D){return{contentType:"application/json",data:JSON.stringify(D),type:"POST"}}comment(D){return this.api({url:"comment",method:"POST",data:D})}tag(D){return this.api({url:"tag",method:"POST",data:D})}getFilelist(D){return this.api({url:"file-list",method:"POST",data:D,sync:!0}).then(E=>JSON.parse(E))}delete(D){return this.api({url:"fileset",method:"DELETE",data:D})}}g.default=C}),define("app/pods/button-confirm/component",["exports","muc/component","muc/observable"],function(g,q,B){"use strict";Object.defineProperty(g,"__esModule",{value:!0});class C extends q.Component{constructor(){super(),this.template=`
            {{#if ("is-equal" mode "link")}}
                <a class="{{class}} {{buttonClass}}" {{"action" ("noexpand" "check")}}>
                    <yield-block />
                </a>
            {{else}}
                <button class="{{class}} {{buttonClass}}" {{"action" ("noexpand" "check")}}>
                    <yield-block />
                </button>
            {{/if}}
            <widget-modal open={{modalOpen}}
                          setOpen={{"curry" ("noexpand" ("set" ("noexpand" modalOpen)))}}
                          title={{title}}
                          as="target">
                {{#if ("is-equal" target "body")}}
                    {{text}}
                {{else}}
                    <button class="{{class}} {{actionButtonClass}}" {{"action" ("noexpand" "execute")}}>{{("if" confirmText confirmText "Confirm")}}</button>
                {{/if}}
            </widget-modal>
        `,this.modalOpen=!1,this.actions={check(){this.modalOpen=!0},execute(){this.action(),this.modalOpen=!1}}}}g.default=C}),define("app/pods/detail-route/component",["exports","muc/component","muc/observable"],function(g,q,B){"use strict";Object.defineProperty(g,"__esModule",{value:!0});class C extends q.RoutableComponent{constructor(){super(),this.template=`
            {{#if model.error}}
                <div class="alert alert-danger" role="alert">{{model.error}}</div>
            {{else}}
                <div class="breadcrumbs left-right vcenter">
                    <ol class="breadcrumb">
                      <li><link-to href="/">Overview</link-to></li>
                      <li class="active">{{model.title}}</li>
                    </ol>
					<span>
						<widget-tag class="btn btn-xs btn-default" disabled={{"not" bagbunker.loggedin}} tags={{model.tags}} alltags={{model.all_known_tags}} changeAction={{"fn" retag}} menuClass="dropdown-menu-right" />
						<widget-comment class="btn btn-xs btn-default" disabled={{"not" bagbunker.loggedin}} changeAction={{"fn" Xcomment}} menuClass="dropdown-menu-right" />
					</span>
                </div>
                <ul class="nav nav-tabs">
                    <li role="presentation" class="{{"if" ("is-equal" tabindex "summary") "active"}}"><a role="button" {{"action" ("noexpand" "settab" "summary")}}>Summary</a></li>
                    {{#each model.sections as |section index|}}
                        <li role="presentation" class="{{"if" ("is-equal" tabindex index) "active"}}"><a role="button" {{"action" ("noexpand" "settab" index)}}>{{section.title}}</a></li>
                    {{/each}}
                </ul>
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane {{"if" ("is-equal" tabindex "summary") "active"}}">
                        <div class="panel panel-default">
                            <div class="panel-body">
                                <div class="left-right">
                                    <widget-keyval model={{model.summary.widget}} />
                                    <div>
                                        {{#if bagbunker.loggedin}}
                                            <button-confirm buttonClass="link-default" actionButtonClass="btn btn-default"
                                                            mode="link"
                                                            title="Delete fileset {{uuid}}" text="Are you sure you want to discard this fileset. Tags and comments would be IRREVOCABLY gone. If the fileset still exists on disk it would be re-added with a new UUID during the next scan."
                                                            action={{"fn" delete}}
                                                            confirmText="Discard fileset">
                                                Discard fileset
                                            </button-confirm>
                                        {{else}}
                                            <a role="button" class="link-default disabled">Discard fileset</a>
                                        {{/if}}
                                    </div>
                                </div>
                                <hr />

                                <div>
                                    Tagged
                                    <ul class="list-inline tagged">{{#each model.tags as |tag|}}<li><span class="badge">{{tag}}</span></li>{{/each}}</ul>
                                    <widget-tag class="btn btn-xs btn-default" disabled={{"not" bagbunker.loggedin}} tags={{model.tags}} alltags={{model.all_known_tags}} changeAction={{"fn" retag}} />
                                </div>
                                <hr />

                                {{#each model.comments as |comment|}}
                                    <div class="comment panel panel-default">
                                        <div class="comment-header panel-heading">
                                            <strong>{{comment.username}}</strong> commented <time datetime="{{comment.timestamp}}" is="relative-time" title="{{comment.timestamp}}" >{{("print-relatime" comment.timestamp)}}</time>
                                        </div>
                                        <div class="comment-content panel-body">
                                            {{comment.comment}}
                                        </div>
                                    </div>
                                {{/each}}
                                <div class="panel panel-default">
                                    <div class="panel-body">
                                        <div class="form-group">
                                            {{#if bagbunker.loggedin}}
                                                <input-textarea class="form-control"
                                                                placeholder="Leave a comment"
                                                                value={{comment}}
                                                                rows=5
                                                                changeAction={{"curry" ("noexpand" ("set" ("noexpand" comment)))}} />
                                            {{else}}
                                                <input-textarea class="form-control"
                                                                placeholder="Sign in to comment"
                                                                value={{comment}}
                                                                rows=5
                                                                changeAction={{"curry" ("noexpand" ("set" ("noexpand" comment)))}}
                                                                disabled="disabled" />
                                            {{/if}}
                                        </div>
                                        {{#if bagbunker.loggedin}}
                                            <button type="button"
                                                    class="btn btn-default pull-right"
                                                    {{"action" ("noexpand" "saveComment")}}>
                                                Comment
                                            </button>
                                        {{/if}}
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    {{#each model.sections as |section index|}}
                        <div role="tabpanel" class="tab-pane {{"if" ("is-equal" tabindex index) "active"}}">
                            <!--section-collapse model={{section}} / -->
                            {{#if ("is-equal" tabindex index)}}

                            {{#each section.widgets as |widget|}}
                                <div class="panel panel-default">
                                    <div class="panel-body">
                                        <h3>{{widget.caption}}</h3>
                                        <delegate-component component="widget-{{widget.type}}" model={{widget}} />
                                    </div>
                                </div>
                            {{/each}}

                            {{/if}}
                        </div>
                    {{/each}}
                </div>
            {{/if}}
        `,this.bagbunker=(0,B.computed)(function(){return this.getOwner().lookup("application-route")}),this.tabindex="summary",this.comment="",this.actions={toggleControls(){this.controlsOpen=!this.controlsOpen},saveComment(){this.comment&&(this.bagbunker.comment({[this.uuid]:{add:[this.comment]}}).then(()=>this.reloadModel()),this.comment="")},settab(D){this.tabindex=D}}}retag(D){this.bagbunker.tag({[this.uuid]:{add:D.added,remove:D.removed}}).then(()=>this.reloadModel())}Xcomment(D){this.bagbunker.comment({[this.uuid]:{add:[D]}}).then(()=>this.reloadModel())}delete(){this.bagbunker.delete([this.uuid]).then(()=>{this.transitionTo({route:"index"})})}reloadModel(){this.modelHook({id:this.uuid}).then(D=>{this.model=D})}modelHook(D){return this.uuid=D.id,this.baseurl=`${this.bagbunker.apiEndpoint}fileset-detail/${D.id}`,this.getOwner().ajax({url:this.baseurl}).then(E=>{return E.sections.forEach(G=>{G.widgets.forEach(H=>{"image"===H.type?H.image.src=`${this.baseurl}/${H.image.src}`:"gallery"===H.type?H.images.forEach(I=>{I.src=`${this.baseurl}/${I.src}`}):"table"===H.type&&H.columns.forEach((I,J)=>{"rellink"===I.formatter&&(I.formatter="link",H.rows.forEach(K=>K.values[J].href=`${this.baseurl}/${K.values[J].href}`))})})}),E.comments=B.A.create(E.comments),this.getOwner().ajax({url:`${this.bagbunker.apiEndpoint}all-known-tags`}).then(G=>{return E.all_known_tags=B.A.create(G),E.tags=B.A.create(E.tags),B.O.create(E)})},E=>{return B.O.create({error:`Could not load fileset ${D.id}, reason "${E.statusText}"`})})}}g.default=C}),define("app/pods/field-datetime/component",["exports","muc/component","muc/observable","muc/helper"],function(g,q,B,C){"use strict";function D(G,H){do{if(G===H)return!0;H=H.parentElement}while(H.parentElement);return!1}Object.defineProperty(g,"__esModule",{value:!0});class E extends q.Component{constructor(){super(),this.template=`
            <div class="row">
                <div class="col-xs-6">
                    <div class="input-group date"
                         {{"action" ("noexpand" "calendarFocusIn" on="focus" capture=true)}}
                         {{"action" ("noexpand" "calendarFocusOut" on="blur" capture=true)}}>
                        <span class="input-group-addon dropdown {{"if" calendarOpen "open"}}">
                            <span class="glyphicon glyphicon-calendar"></span>
                            {{#if calendarOpen}}
                                <div class="dropdown-menu" tabindex="-1">
                                    <table class="Xtable table-condensed small text-center">
                                        <thead>
                                            <tr>
                                                <th class="text-center" style="Xpadding-left:0; padding-right:0">
                                                    <button class="btn btn-default btn-xs" type="button" {{"action" ("noexpand" "prev")}}>
                                                        <span class="small glyphicon glyphicon-backward"></span>
                                                    </button>
                                                </th>
                                                <th class="text-center" colspan="5">{{displayMonthyear}}</th>
                                                <th class="text-center" style="padding-left:0; Xpadding-right:0">
                                                    <button class="btn btn-default btn-xs" type="button" {{"action" ("noexpand" "next")}}>
                                                        <span class="small glyphicon glyphicon-forward"></span>
                                                    </button>
                                                </th>
                                            </tr>
                                            <tr>
                                                {{!#group}}
                                                    {{#each weekdays as |weekday|}}
                                                        <th>{{weekday}}</th>
                                                    {{/each}}
                                                {{!/group}}
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {{#each matrix as |line|}}
                                                <tr>
                                                    {{#each line as |column|}}
                                                        <td class={{"if" column.isCurrent "currentDay"}}>
                                                            <a class="btn btn-xs {{"if" column.isMonth "black" "gray"}}" {{"action" ("noexpand" "setDate" column.year column.month column.date)}}>{{column.date}}</a>
                                                        </td>
                                                    {{/each}}
                                                </tr>
                                            {{/each}}
                                        </tbody>
                                    </table>
                                </div>
                            {{/if}}
                        </span>
                        <input-control class="form-control" value={{displayDate}} />
                    </div>
                </div>
                <div class="col-xs-6">
                    <div class="input-group time"
                         {{"action" ("noexpand" "clockFocusIn" on="focus" capture=true)}}
                         {{"action" ("noexpand" "clockFocusOut" on="blur" capture=true)}}>
                        <span class="input-group-addon dropdown {{"if" clockOpen "open"}}">
                            <span class="glyphicon glyphicon-time"></span>
                            {{#if clockOpen}}
                                <div class="dropdown-menu" style="min-width:0" tabindex="-1">
                                    <table class="Xtable table-condensed small text-center">
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <button class="btn btn-default" {{"action" ("noexpand" "hourUp")}}>
                                                        <span class="glyphicon glyphicon-chevron-up"></span>
                                                    </button>
                                                </td>
                                                <td class="separator">&nbsp;</td>
                                                <td>
                                                    <button class="btn btn-default" {{"action" ("noexpand" "minuteUp")}}>
                                                        <span class="glyphicon glyphicon-chevron-up"></span>
                                                    </button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>{{hour}}</td>
                                                <td class="separator">:</td>
                                                <td>{{minute}}</td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <button class="btn btn-default" {{"action" ("noexpand" "hourDown")}}>
                                                        <span class="glyphicon glyphicon-chevron-down"></span>
                                                    </button>
                                                </td>
                                                <td class="separator">&nbsp;</td>
                                                <td>
                                                    <button class="btn btn-default" {{"action" ("noexpand" "minuteDown")}}>
                                                        <span class="glyphicon glyphicon-chevron-down"></span>
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            {{/if}}
                        </span>
                        <!--input-control class="form-control" value={{displayTime}} /-->
                        <input class="form-control" value={{displayTime}} disabled=disabled >
                    </div>
                </div>
            </div>
        `,this.weekdays=[0,1,2,3,4,5,6].map(G=>{const H=new C.Moment;return H.weekday=G,H.format("dd")}),this.val=(0,B.computed)("value",function(){return this.value?new C.Moment(this.value):new C.Moment().startOf("date")}),this.currentMonth=(0,B.computed)("value",function(){return this.val.clone().startOf("month")}),this.displayMonthyear=(0,B.computed)("currentMonth",function(){return this.currentMonth.format("MMM YYYY")}),this.displayDate=(0,B.computed)("val",function(){return this.value?this.val.format("LL"):""}),this.displayTime=(0,B.computed)("val",function(){return this.val.format("LT")}),this.hour=(0,B.computed)("val",function(){return this.val.hours}),this.minute=(0,B.computed)("val",function(){return this.val.minutes}),this.matrix=(0,B.computed)("currentMonth","val",function(){const G=this.val,H=this.currentMonth,I=G.year,J=G.month,K=G.date,N=H.month,P=H.clone().startOf("month").startOf("week"),Q=H.clone().endOf("month").endOf("week");for(var R=B.A.create();P<Q;){const T=B.A.create();for(let U=0;7>U;U++)T.push(B.O.create({isCurrent:P.date===K&&P.month===J&&P.year===I,isMonth:P.month===N,year:P.year,month:P.month,date:P.date})),P.add(1,"date");R.push(T)}return R}),this.actions={calendarFocusIn(G){console.log("focusin",G),this.calendarOpen=!0},calendarFocusOut(G){if(console.log("focusout",G),G.relatedTarget){const H=this.renderNode.children[0].elements[0];if(D(H,G.relatedTarget))return}this.calendarOpen=!1},clockFocusIn(){this.clockOpen=!0},clockFocusOut(G){if(G.relatedTarget){const H=this.renderNode.children[0].elements[0];if(D(H,G.relatedTarget))return}this.clockOpen=!1},prev(){this.currentMonth=this.currentMonth.clone().add(-1,"month")},next(){this.currentMonth=this.currentMonth.clone().add(1,"month")},setDate(G,H,I){const J=this.val.clone();J.year=G,J.month=H,J.date=I,this.changeAction(J.format()),console.log("selected",J.format()),this.val=J},hourUp(){this.val=this.val.clone().add(1,"hour")},hourDown(){this.val=this.val.clone().add(-1,"hour")},minuteUp(){this.val=this.val.clone().add(1,"minute")},minuteDown(){this.val=this.val.clone().add(-1,"minute")}}}mChangeAction(G){this.changeAction(G?G:G)}}g.default=E}),define("app/pods/field-filesize/component",["exports","muc/component","muc/observable"],function(g,q,B){"use strict";function C(H){if(""===H)return"";const I=D.exec(H);return!I||isNaN(I[1])?NaN:(H=+I[1],I[2]&&(H*=Math.pow(2,10*E.indexOf(I[2][0].toLowerCase()))),Math.floor(H))}Object.defineProperty(g,"__esModule",{value:!0});const D=/^\s*([0-9.]+)\s*([kmgtpezy][b]?)?\s*$/i,E=["b","k","m","g","t","p","e","z","y"];class G extends q.Component{constructor(){super(),this.template=`
            <div class="row">
                <div class="col-xs-9">
                    <input-control class="form-control"
                                   value={{value}}
                                   changeAction={{"fn" mChangeAction}} />
                </div>
                <div class="col-xs-3">
                    <input class="form-control" value={{size}} disabled=true>
                </div>
            </div>
        `,this.size=(0,B.computed)("value",function(){const H=C(this.value);return H?`${H} bytes`:""})}mChangeAction(H){const I=C(H);isNaN(I)?this.changeErrorAction("Value must be a number and optional unit (e.g. MB)"):this.changeErrorAction(null),this.changeAction(H)}}g.default=G}),define("app/pods/field-string/component",["exports","muc/component","muc/observable"],function(g,q,B){"use strict";Object.defineProperty(g,"__esModule",{value:!0});class C extends q.Component{constructor(){super(),this.template=`
            <input-control class="form-control"
                           value={{value}}
                           changeAction={{"fn" mChangeAction}} />
        `}mChangeAction(D){this.changeAction(D?D:D)}}g.default=C}),define("app/pods/field-subset/component",["exports","muc/component","muc/observable"],function(g,q,B){"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.default=class extends q.Component{constructor(){super(),this.template=`
            <m-tag tags={{value}}
                   suggestions={{constraints}}
                   subset=true
                   add={{"fn" add}}
                   remove={{"fn" remove}} />
        `}add(C){this.value.push(C),this.changeAction(B.A.create(this.value))}remove(C){this.value.splice(this.value.indexOf(C),1),this.changeAction(B.A.create(this.value))}}}),define("app/pods/field-timedelta/component",["exports","muc/component"],function(g,q){"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.default=class extends q.Component{constructor(){super(),this.template=`
            <input-control class="form-control"
                           value={{value}}
                           changeAction={{"fn" mChangeAction}} />
        `}mChangeAction(B){isNaN(+B)?this.changeErrorAction("Value must be a number"):this.changeErrorAction(null),this.changeAction(B)}}}),define("app/pods/index-route/component",["exports","muc/component","muc/observable"],function(g,q,B){"use strict";Object.defineProperty(g,"__esModule",{value:!0});class C extends q.RoutableComponent{constructor(){super(),this.template=`
            <h2>
                {{model.summary.title}}
                <button type="button" class="btn btn-default btn-sm pull-right {{"if" filtersOpen "active"}}" {{"action" ("noexpand" "toggleFilters")}}>{{model.filters.title}}</button>
            </h2>
            <div class="panel panel-default">
                {{#if filtersOpen}}
                    <div class="panel-body">
                        <widget-filter model={{model.filters.widget}} />
                    </div>
                    <hr />
                {{/if}}
                <div class="panel-body">
                    <widget-keyval model={{model.summary.widget}} />
                </div>
            </div>

            <h2>{{model.listing.title}}</h2>
            <div class="panel panel-default">
                <div class="panel-body">
                    <widget-table model={{model.listing.widget}} selectable=true as="selected">
                        <ul class="list-inline inline-block">
                            <li>
                                ({{selected.length}} items selected)
                            </li>
                            <li>
                                <!--
                                <form class="dropdown {{"if" tagging "open"}}" {{"action" ("noexpand" "toggleTagging" selected on="xfocusout")}} {{"action" ("noexpand" "bulkTag" selected on="submit")}}>
                                    <button class="btn btn-xs btn-default button-tag"
                                            type="button"
                                            disabled={{"not" selected.length}}
                                            {{"action" ("noexpand" "toggleTagging" selected)}}>
                                        tag <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu bulk-dropdown">
                                        {{#if bagbunker.loggedin}}
                                            <li class="dropdown-header">Add tag</li>
                                            <li>
                                                <a role="button">
                                                    <div class="input-group input-group-sm">
                                                        <input-control type="text" class="form-control input-sm" placeholder="Label" value={{tag}} changeAction={{"curry" ("noexpand" ("set" ("noexpand" tag)))}} />
                                                        <span class="input-group-btn">
                                                            <button class="btn btn-default" type="button" {{"action" ("noexpand" "bulkTagAdd" selected tag)}} disabled={{"not" tag}}><span class="glyphicon glyphicon-plus"></span></button>
                                                        </span>
                                                    </div>
                                                </a>
                                            </li>

                                            <li class="dropdown-header">Tags</li>
                                            {{#each tags as |tag|}}
                                                <li class="xtag">
                                                    <a role="button" xclass="btn btn-block btn-default btn-xs" type="button" {{"action" ("noexpand" "bulkTagToggle" selected tag.name)}} title={{tag.hint}}>
                                                        <span class="glyphicon glyphicon-{{tag.state}}"></span>
                                                        {{tag.name}}
                                                    </a>
                                                </li>
                                            {{/each}}
                                            <li role="separator" class="divider"></li>
                                            <li class="text-right">
                                                <a role="button">
                                                    <button class="btn btn-default btn-xs" type="button" {{"action" ("noexpand" "toggleTagging" selected)}}>Cancel</button>
                                                    <button class="btn btn-default btn-xs" type="submit" disabled={{saveTagsDisabled}}>Save tags</button>
                                                </a>
                                            </li>
                                        {{else}}
                                            <li class="text-center">Sign in to tag</li>
                                        {{/if}}
                                    </ul>
                                </form>
                                -->
                                <widget-tag class="btn btn-xs btn-default" disabled={{"not" bagbunker.loggedin}} fulldisabled={{"not" selected.length}} tags={{selected}} alltags={{alltags}} changeAction={{"fn" execTag selected}} />
                            </li>
                            <li>
                                <!--
                                <form class="dropdown {{"if" commenting "open"}}" {{"action" ("noexpand" "bulkComment" selected on="submit")}}>
                                    <button class="btn btn-xs btn-default button-comment"
                                            type="button"
                                            disabled={{"not" selected.length}}
                                            {{"action" ("noexpand" "toggleCommenting" selected)}}>
                                        comment <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu bulk-dropdown">
                                        {{#if bagbunker.loggedin}}
                                            <li class="dropdown-header">Comment</li>
                                            <li>
                                                <a role="button" class="form-group">
                                                    <input-textarea class="form-control" rows=10 cols=80 value={{comment}} changeAction={{"curry" ("noexpand" ("set" ("noexpand" comment)))}} />
                                                </a>
                                            </li>
                                            <li role="separator" class="divider"></li>
                                            <li class="text-right">
                                                <a role="button">
                                                    <button class="btn btn-default btn-xs" type="button" {{"action" ("noexpand" "toggleCommenting" selected)}}>Cancel</button>
                                                    <button class="btn btn-default btn-xs" type="submit" disabled={{"not" comment}}>Comment</button>
                                                </a>
                                            </li>
                                        {{else}}
                                            <li class="text-center">Sign in to comment</li>
                                        {{/if}}
                                    </ul>
                                </form>
                                -->
                                <widget-comment class="btn btn-xs btn-default" disabled={{"not" bagbunker.loggedin}} fulldisabled={{"not" selected.length}} changeAction={{"fn" Xcomment selected}} />
                            </li>
                            <li>
                                <button class="btn btn-xs btn-default"
                                        disabled={{"not" selected.length}}
                                        {{"action" ("noexpand" "copyFilelist" selected)}}>
                                    {{copyFilelistStr}}
                                </button>
                            </li>
                            <li>
                                <button class="btn btn-xs btn-default"
                                        disabled={{"not" selected.length}}
                                        {{"action" ("noexpand" "copyUrllist" selected)}}>
                                    {{copyUrllistStr}}
                                </button>
                            </li>
                        </ul>
                    </widget-table>
                </div>
            </div>

        `,this.queryParamsX={filter:{refreshModel:!0},debugfilters:{}},this.filter="",this.debugfilters=!1,this.filterFixed=(0,B.computed)("filter",function(){return"undefined"==typeof this.filter?"":this.filter}),this.filterObj=(0,B.computed)(function(){const D={};if(this.filter){const E=JSON.parse(atob(this.filter));for(let G in E)D[G]=B.O.create(E[G])}return B.O.create(D)}),this.filterJSON=(0,B.computed)("model",function(){const D=[];this.model.filters.widget.filters.forEach(G=>{D.push(`filterObj.${G.key}.op`),D.push(`filterObj.${G.key}.val`)}),(0,B.updateComputed)(this,"filterJSON",D);const E={};for(let G in this.filterObj)this.filterObj[G].val.length&&(E[G]={op:this.filterObj[G].op,val:this.filterObj[G].val});return JSON.stringify(E,0,1)}),this.filterBase=(0,B.computed)("filterJSON",function(){this.filterJSON;const D={};for(let G in this.filterObj)this.filterObj[G].val.length&&(D[G]={op:this.filterObj[G].op,val:this.filterObj[G].val});const E=JSON.stringify(D);return"{}"===E?"":btoa(E)}),this.copyFilelistStr=(0,B.computed)("selected.@each",function(){return"copy file paths"}),this.copyUrllistStr=(0,B.computed)("selected.@each",function(){return"copy URLs"}),this.tags=B.A.create(),this.tag="",this.filtersOpen=(0,B.computed)("filterFixed",function(){return!!this.filterFixed}),this.alltags=(0,B.computed)("model.all_known",function(){const D=Object.keys(this.model.all_known).filter(E=>/tags$/.test(E))[0];return B.A.create(this.model.all_known[D])}),this.saveTagsDisabled=(0,B.computed)("tags.@each.state",function(){const D=!!this.tags.filter(G=>G.initial&&"minus"!==G.state).length,E=!!this.tags.filter(G=>"check"===G.state).length;return!(D||E)}),this.comment="",this.actions={toggleFilters(){this.filtersOpen=!this.filtersOpen},applyFilter(D){D.preventDefault(),this.transitionTo({query:{filter:this.filterBase}})},resetFilters(){for(let D in this.filterObj){const E=this.filterObj[D];E.val=E.val.slice(0,0)}},toggleTagging(D){if(this.selected=D,this.tagging=!this.tagging,this.tagging){this.tags=B.A.create();const E={};D.forEach(G=>G.tags.forEach(H=>E[H]=!0)),Object.keys(E).forEach(G=>{const H=D.filter(I=>~I.tags.indexOf(G)).length!==D.length;this.tags.push(B.O.create({name:G,state:H?"minus":"check",isSome:H,initial:!0}))}),this.tags.selected=D}else this.tags.selected=null},toggleCommenting(){this.commenting=!this.commenting},bulkTagAdd(D,E){let G=this.tags.filter(H=>H.name===E)[0];G||this.tags.push(B.O.create({name:E,state:"check",hint:"add to all",isSome:!1})),this.tag=""},bulkTagToggle(D,E){let G=this.tags.filter(H=>H.name===E)[0];G.state=G.isSome?{check:"unchecked",unchecked:"minus",minus:"check"}[G.state]:{check:"unchecked",unchecked:"check"}[G.state],G.hint={checked:"add to all",unchecked:"remove from all",minus:"leave unmodified"}[G.state]},bulkTag(){const D={};this.tags.forEach(E=>{this.tags.selected.forEach(G=>{if("minus"!==E.state&&(E.initial||"unchecked"!==E.state)){D[G.id]||(D[G.id]={});const H=D[G.id],I="check"===E.state?"add":"remove";H[I]||(H[I]=[]),H[I].push(E.name)}})}),this.bagbunker.tag(D).then(()=>this.reloadModel()),this.tagging=!1,this.tag="",event.preventDefault()},bulkComment(D){this.selected=D;const E={};D.forEach(G=>{E[G.id]={add:[this.comment]}}),this.bagbunker.comment(E).then(()=>this.reloadModel()),this.commenting=!1,this.comment="",event.preventDefault()},copyFilelist(D){this.selected=D;const E=D.map(G=>G.id);this.bagbunker.getFilelist(E).then(G=>{this.copyToClipboard(G.paths.join("\n")),this.copyFilelistStr="Paths copied"})},copyUrllist(D){this.selected=D;const E=D.map(G=>G.id);this.bagbunker.getFilelist(E).then(G=>{this.copyToClipboard(G.urls.map(H=>`${this.bagbunker.apiEndpoint}${H}`).join("\n")),this.copyUrllistStr="URLs copied"})}}}execTag(D,E){const G={};D.forEach(H=>{G[H.id]={add:E.added,remove:E.removed}}),this.bagbunker.tag(G).then(()=>this.reloadModel())}Xcomment(D,E){const G={};D.forEach(H=>{G[H.id]={add:[E]}}),this.bagbunker.comment(G).then(()=>this.reloadModel())}copyToClipboard(D){const E=this.renderNode.doc.createElement("textarea");E.value=D,this.renderNode.children[0].elements[0].appendChild(E),E.select(),this.renderNode.doc.execCommand("copy"),E.remove()}init(){super.init(),this.bagbunker=this.getOwner().lookup("application-route")}modelHook(D){var _this=this;return _asyncToGenerator(function*(){_this.params=D;const E={};return D.filter&&(E.filter=atob(D.filter)),_this.getOwner().ajax({url:`${_this.bagbunker.apiEndpoint}fileset-listing`,data:E})})()}show(D){this.transitionToRoute("set",D.id)}reloadModel(){this.modelHook(this.params).then(D=>{this.model=D})}}g.default=C}),define("app/pods/input-checkbox/component",["exports","muc/component","muc/observable"],function(g,q,B){"use strict";Object.defineProperty(g,"__esModule",{value:!0});class C extends q.Component{constructor(){super(),this.template=`
            <input type="checkbox"
                   class={{class}}
                   disabled={{"if" disabled "disabled" undefined}}
                   checked={{mValue}}
                   {{"action" ("noexpand" "change" on="change")}} >
        `,this.mValue=(0,B.computed)("value",function(){const D=this.renderNode.children[0].elements[0];return D.firstChild.nextSibling.checked=this.value,this.value}),this.actions={change(){const D=this.renderNode.children[0].elements[0],E=D.firstChild.nextSibling.checked;console.log(this.__oid__,"checked?",E),this.changeAction(E)}}}}g.default=C}),define("app/pods/input-control/component",["exports","muc/component","muc/observable"],function(g,q,B){"use strict";Object.defineProperty(g,"__esModule",{value:!0});class C extends q.Component{constructor(){super(),this.template=`
            <input type={{type}}
                   class={{class}}
                   disabled={{"if" disabled "disabled" undefined}}
                   placeholder={{placeholder}}
                   value={{mValue}}
                   {{"action" ("noexpand" "change" on="change")}}
                   {{"action" ("noexpand" "change" on="keyup")}} >
        `,this.type="text",this.mValue=(0,B.computed)("value",function(){const D=this.renderNode.children[0].elements[0];return D.firstChild.nextSibling.value=this.value,this.value}),this.actions={change(){const D=this.renderNode.children[0].elements[0],E=D.firstChild.nextSibling.value;console.log(this.__oid__,E),this.changeAction(E)}}}}g.default=C}),define("app/pods/input-textarea/component",["exports","muc/component","muc/observable"],function(g,q,B){"use strict";Object.defineProperty(g,"__esModule",{value:!0});class C extends q.Component{constructor(){super(),this.template=`
            <textarea class={{class}}
                      disabled={{"if" disabled "disabled" undefined}}
                      value={{mValue}}
                      rows={{rows}}
                      cols={{cols}}
                      placeholder={{placeholder}}
                      {{"action" ("noexpand" "change" on="change")}}
                      {{"action" ("noexpand" "change" on="keyup")}} >
            </textarea>
        `,this.mValue=(0,B.computed)("value",function(){const D=this.renderNode.children[0].elements[0];return D.firstChild.nextSibling.value=this.value,this.value}),this.actions={change(){const D=this.renderNode.children[0].elements[0],E=D.firstChild.nextSibling.value;this.changeAction(E)}}}}g.default=C}),define("app/pods/m-select/component",["exports","muc/component","muc/observable"],function(g,q,B){"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.default=class extends q.Component{constructor(){super(),this.template=`
            <select class="form-control" {{"action" ("noexpand" "change" on="change")}} disabled={{disabled}}>
                {{#each mOptions as |item|}}
                    <option value={{item.value}} selected={{"if" ("is-equal" item.value mSelected) "selected"}}>
                        {{item.name}}
                    </option>
                {{/each}}
            </select>
        `,this.nameKey="",this.valueKey="__index__",this.mOptions=(0,B.computed)("options",function(){return this.options.map((C,D)=>{return{name:this.nameKey?C[this.nameKey]:C,value:"__index__"===this.valueKey?D:C[this.valueKey]}})}),this.mSelected=(0,B.computed)("options","selected",function(){console.log("recalculating selected...");const C=this.options,D=this.selected,E=C.indexOf(D);if(~E){if("__index__"===this.valueKey)return E;return D[this.valueKey]}}),this.actions={change(){const C=this.renderNode.children[0].elements[0],D=C.firstChild.nextSibling.selectedIndex;this.changeAction(this.options[D])}}}foo(){return console.log("foo called"),"bar"}init(){super.init()}}}),define("app/pods/m-tag/component",["exports","muc/component","muc/observable"],function(g,q,B){"use strict";function C(E,G){do{if(E===G)return!0;G=G.parentElement}while(G.parentElement);return!1}Object.defineProperty(g,"__esModule",{value:!0});class D extends q.Component{constructor(){super(),this.template=`
			<div class="dropdown {{"if" resultsVisible "open"}}"
                 {{"action" ("noexpand" "click")}}
                 {{"action" ("noexpand" "keydown" on="keydown")}}
                 {{"action" ("noexpand" "focusIn" on="focus" capture=true)}}
                 {{"action" ("noexpand" "focusOut" on="blur" capture=true)}}>
				<div class="form-control {{"if" focused "focus"}}">
					{{#each tags as |tag|}}
						<span class="badge">
							{{tag}}
							{{#if disabled}}
							{{else}}
								<span {{"action" ("noexpand" "remove" tag)}}>x</span>
							{{/if}}
						</span>
					{{/each}}
					<input-control value={{search}} disabled={{disabled}} placeholder={{placeholder}} changeAction={{"fn" inputChangeAction}} />
				</div>
				<ul class="dropdown-menu">
					{{#each results as |result|}}
						<li class={{"if" result.active "active"}} {{"action" ("noexpand" "highlight" result on="mouseenter")}} {{"action" ("noexpand" "add" result)}}>
							<a href="#" tabindex=-1 {{"action" ("noexpand" "add" result)}}>
								{{result.tag}}
							</a>
						</li>
					{{/each}}
				</ul>
			</div>
		`,this.tags=null,this.suggestions=null,this.search="",this.focused=!1,this.disabled=(0,B.computed)("subset","suggestions.@each",function(){return this.subset&&!this.suggestions.length}),this.placeholder=(0,B.computed)("subset","suggestions.@each",function(){return this.subset&&!this.suggestions.length?"There are no items":void 0}),this.results=(0,B.computed)("search","tags.@each","suggestions.@each",function(){const E=this.search,G=this.subset;if(!E&&!G)return B.A.create();const H=this.tags,I=new RegExp(E,"i");return B.A.create(this.suggestions.filter(J=>!~H.indexOf(J)).filter(J=>I.test(J)).map(J=>B.O.create({tag:J,active:!1})))}),this.resultsVisible=(0,B.computed)("results.@each","focused",function(){return this.results.length&&this.focused}),this.actions={click(){this.renderNode.children[0].elements[0].querySelector("input").focus()},focusIn(){this.focused=!0},focusOut(E){if(E.relatedTarget){const G=this.renderNode.children[0].elements[0];if(C(G,E.relatedTarget))return}this.focused=!1},add(E,G){this.add(E.tag),this.renderNode.children[0].elements[0].querySelector("input").focus(),this.search="",G.stopPropagation(),G.preventDefault()},remove(E,G){this.remove(E),G.stopPropagation(),G.preventDefault()},highlight(E){const G=this.results;if(G.length){const H=G.filter(I=>!0===I.active)[0];if(G.forEach(I=>I.active=!1),"number"==typeof E){let I=G.indexOf(H);I=(I+G.length+E)%G.length,G[I].active=!0}else E.active=!0}},keydown(E){const G=E;if(38===G.keyCode)this.actions.highlight.call(this,-1),G.stopPropagation(),G.preventDefault();else if(40===G.keyCode)this.actions.highlight.call(this,1),G.stopPropagation(),G.preventDefault();else if(13===G.keyCode||9===G.keyCode){this.tags;const H=this.results,I=this.search.trim();this.search="";const J=H.filter(K=>!0===K.active)[0];if(J)this.add(J.tag);else if(I.length)(!this.subset||H.filter(K=>K.tag===I)[0])&&this.add(I);else if(9===G.keyCode)return;G.stopPropagation(),G.preventDefault()}else if(8===G.keyCode){if(this.search.length)return;this.tags.length&&this.remove(this.tags[this.tags.length-1]),G.stopPropagation(),G.preventDefault()}}}}inputChangeAction(E){this.search=E,this.subset&&E&&!this.results.length&&(this.search=E.substr(0,E.length-1))}}g.default=D}),define("app/pods/notfound-route/component",["exports","muc/component"],function(g,q){"use strict";Object.defineProperty(g,"__esModule",{value:!0});class B extends q.RoutableComponent{constructor(){super(),this.template=`
        	<div class="alert alert-danger" role="alert">
				<strong>Error:</strong> This is not a valid marv route.
			</div>
			<link-to href="/">Go to overview</link-to>
        `}}g.default=B}),define("app/pods/routes/main",["exports"],function(g){"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.default=[{name:"index",path:"",queryParams:{filter:{refreshModel:!0},debugfilters:{}}},{name:"detail",path:"/detail/:id"},{name:"notfound",path:"*wildcard"}]}),define("app/pods/widget-comment/component",["exports","muc/component","muc/observable"],function(g,q,B){"use strict";function C(E,G){do{if(E===G)return!0;G=G.parentElement}while(G.parentElement);return!1}Object.defineProperty(g,"__esModule",{value:!0});class D extends q.Component{constructor(){super(),this.template=`
            <span class="dropdown {{"if" focused "open"}}">
                <span class="backdrop" {{"action" ("noexpand" "focusIn")}}></span>
                <button role="button" class="{{class}}" disabled={{fulldisabled}} {{"action" ("noexpand" "focusIn")}}>
                    comment <span class="caret"></span>
                </button>
                <ul class="dropdown-menu {{menuClass}} bulk-dropdown">
                    {{#if disabled}}
                        <li class="text-center">Sign in to comment</li>
                    {{else}}
                        <li>
                            <a role="button">
								<input-textarea class="form-control" rows=10 cols=80 placeholder="Comment" value={{comment}} changeAction={{"curry" ("noexpand" ("set" ("noexpand" comment)))}} />
                            </a>
                        </li>
                        <li role="separator" class="divider"></li>
                        <li class="text-right">
                            <a role="button">
                                <button class="btn btn-default btn-xs" type="button" {{"action" ("noexpand" "save")}}>Comment</button>
                            </a>
                        </li>
                    {{/if}}
                </ul>
            </span>
		`,this.comment="",this.focused=!1,this.actions={focusIn(E){console.log("in",E.target),this.focused=!this.focused},focusOut(E){if(console.log("out",E.target,E.relatedTarget),E.relatedTarget){const G=this.renderNode.children[0].elements[0];if(C(G,E.relatedTarget))return}this.focused=!1},save(){this.comment&&(this.changeAction(this.comment),this.comment="",this.focused=!1)}}}}g.default=D}),define("app/pods/widget-filter/component",["exports","muc/component","muc/observable"],function(g,q,B){"use strict";Object.defineProperty(g,"__esModule",{value:!0});class C extends q.Component{constructor(){super(),this.template=`
            <div class="row">
                <div class="col-xs-2">Add new filter</div>
                <div class="col-xs-10">
                    <ul class="list-inline">
                        {{#each fields as |field|}}
                            <li>
                                <button class="btn btn-default btn-xs" type="button" {{"action" ("noexpand" "add" field)}} disabled={{field.active}}>{{field.title}}</button>
                            </li>
                        {{/each}}
                    </ul>
                </div>
            </div>

            <form class="form-horizontal" {{"action" ("noexpand" "applyFilter" on="submit")}}>
                {{#each fields as |field|}}
                    {{#if field.active}}
                    <div class="row form-group form-group-sm {{"if" field.entry.error "has-error"}}">
                        <label class="col-xs-2 control-label">
                            {{field.title}}
                        </label>
                        {{#if ("is-greater" field.operators.length 1)}}
                            <div class="col-xs-2">
                                <m-select options={{field.operators}}
                                          selected={{field.entry.op}}
                                          changeAction={{"curry" ("noexpand" ("set" ("noexpand" field.entry.op)))}}
                                          disabled={{"if" ("is-greater" field.operators.length 1) undefined true}}
                                />
                            </div>
                            <div class="col-xs-7">
                                <delegate-component component="field-{{field.value_type}}"
                                                    value={{field.entry.val}}
                                                    constraints={{field.constraints}}
                                                    changeAction={{"curry" ("noexpand" ("set" ("noexpand" field.entry.val)))}}
                                                    changeErrorAction={{"curry" ("noexpand" ("set" ("noexpand" field.entry.error)))}} />
                                {{#if field.entry.error}}
                                    <span class="help-block">{{field.entry.error}}</span>
                                {{/if}}
                            </div>
                        {{else}}
                            <div class="col-xs-9">
                                <delegate-component component="field-{{field.value_type}}"
                                                    value={{field.entry.val}}
                                                    constraints={{field.constraints}}
                                                    changeAction={{"curry" ("noexpand" ("set" ("noexpand" field.entry.val)))}}
                                                    changeErrorAction={{"curry" ("noexpand" ("set" ("noexpand" field.entry.error)))}} />
                                {{#if field.entry.error}}
                                    <span class="help-block">{{field.entry.error}}</span>
                                {{/if}}
                            </div>
                        {{/if}}
                        <div class="col-xs-1">
                            <button class="btn btn-default btn-sm" type="button" {{"action" ("noexpand" "remove" field)}}>
                                <span class="glyphicon glyphicon-remove"></span>
                            </button>
                        </div>
                    </div>
                    {{/if}}
                {{/each}}

                <div class="filter-controls row">
                    {{#if bagbunker_index.debugfilters}}
                        <h4>Filter Debug</h4>
                        <pre>{{bagbunker_index.filterJSON}}</pre>
                        <pre>{{bagbunker_index.filterBase}}</pre>
                    {{/if}}

                    <div class="col-xs-9 col-xs-offset-2 text-right">
                        <button type="button"
                                class="btn btn-default btn-sm"
                                disabled={{"is-equal" bagbunker_index.filterBase ""}}
                                {{"action" ("noexpand" "resetFilters")}}>reset filters</button>
                        <button type="submit"
                                class="btn btn-primary btn-sm"
                                disabled={{"is-equal" bagbunker_index.filterFixed bagbunker_index.filterBase}}>apply filter</button>
                    </div>
                </div>
            </form>
        `,this.fields=(0,B.computed)("model","bagbunker_index.filterObj",function(){const D=this.bagbunker_index.filterObj,E=this.model.filters;return E.map((G,H)=>{const I=D[G.key]||(D[G.key]=B.O.create({}));return I.op=I.op||G.operators[0],I.val=I.val||("subset"===G.value_type?B.A.create():""),I.error=null,B.O.create({key:G.key,title:G.title,operators:G.operators,value_type:G.value_type,constraints:B.A.create(G.constraints),active:0===H||!!I.val.length,entry:I})})}),this.actions={add(D){D.active=!0},remove(D){D.active=!1,D.entry.val=D.entry.val instanceof B.A?B.A.create():""},applyFilter(D){this.bagbunker_index.actions.applyFilter.apply(this.bagbunker_index,[D]),D.preventDefault()},resetFilters(){for(let D in this.bagbunker_index.filterObj){const E=this.bagbunker_index.filterObj[D];E.val=E.val.slice(0,0)}}}}init(){super.init(),this.bagbunker_index=this.getOwner().lookup("index-route")}}g.default=C}),define("app/pods/widget-gallery/component",["exports","muc/component","muc/observable"],function(g,q,B){"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.default=class extends q.Component{constructor(){super(),this.template=`
            {{#if showTitle}}
                <h4 class="text-center">Image {{("increment" index)}} of {{model.images.length}} <small>{{image.alt}}</small></h4>
            {{/if}}
            <div class="row">
                <div class="{{("if" hasBlock "col-xs-9" "col-xs-12")}}">
                    <div class="carousel">
                        <div class="carousel-inner" role="listbox">
                            {{#each model.images as |image i|}}
                                <div class="item {{("if" ("is-equal" i index) "active")}}">
                                    <img class="img-responsive center-block" src={{image.src}} alt={{image.alt}}>
                                </div>
                            {{/each}}
                        </div>
                        <a class="left carousel-control" {{"action" ("noexpand" "setIndex" "-1")}}>
                            <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="right carousel-control" {{"action" ("noexpand" "setIndex" "+1")}}>
                            <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                            <span class="sr-only">Next</span>
                        </a>
                    </div>
                </div>
                {{#if hasBlock}}<div class="col-xs-3"><yield-block /></div>{{/if}}
            </div>
            <ul class="image-stripe">
                {{#each model.images as |image i|}}
                    <li>
                        <div class="img-thumbnail-wrapper {{"if" ("is-equal" i index) "active"}}" {{"action" ("noexpand" "setIndex" i)}}>
                            <img src={{image.src}} alt={{image.alt}}>
                        </div>
                    </li>
                {{/each}}
            </ul>
        `,this.index=0,this.image=(0,B.computed)("index",function(){return this.model.images[this.index]}),this.actions={setIndex(C){"-1"===C?0<this.index&&this.index--:"+1"===C?this.index<this.model.images.length-1&&this.index++:this.index=C}}}}}),define("app/pods/widget-image/component",["exports","muc/component"],function(g,q){"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.default=class extends q.Component{constructor(){super(),this.tagName="img",this.attributeBindings=["class","src:model.image.src","alt:model.image.alt","width:model.image.width"],this.class="img-responsive widget-img",this.template=null}}}),define("app/pods/widget-keyval/component",["exports","muc/component"],function(g,q){"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.default=class extends q.Component{constructor(){super(),this.template=`
            <!--
            <table class="table">
                <thead>
                    <tr>
                        {{#each model.items as |row index|}}
                            <th>{{row.title}}</th>
                        {{/each}}
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        {{#each model.items as |row index|}}
                            <td>
                                {{#if row.list}}
                                    {{#each row.value as |val|}}
                                        {{(("concat" "format-" row.formatter) val)}}
                                    {{/each}}
                                {{else}}
                                    {{(("concat" "format-" row.formatter) row.value)}}
                                {{/if}}
                            </td>
                        {{/each}}
                    </tr>
                </tbody>
            </table>
            -->
            <ul class="list-inline">
                {{#each model.items as |row index|}}
                    <li>
                        <div class="value">
                            {{#if row.list}}
                                {{#each row.value as |val|}}
                                    {{(("concat" "format-" row.formatter) val)}}
                                {{/each}}
                            {{else}}
                                {{(("concat" "format-" row.formatter) row.value)}}
                            {{/if}}
                        </div>
                        <div class="uint">
                            {{row.title}}
                        </div>
                    </li>
                {{/each}}
            </ul>
        `}}}),define("app/pods/widget-modal/component",["exports","muc/component","muc/observable"],function(g,q,B){"use strict";Object.defineProperty(g,"__esModule",{value:!0});class C extends q.Component{constructor(){super(),this.template=`
            <div class="modal fade {{"if" open "in"}} {{class}}" style={{"if" open "display:block;"}}>
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button"
                                    class="close"
                                    data-dismiss="modal"
                                    aria-label="Close"
                                    {{"action" ("noexpand" "close")}}>
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <h4 class="modal-title">{{title}}</h4>
                        </div>
                        <div class="modal-body">
                            <yield-block params={{"body"}} />
                        </div>
                        <div class="modal-footer">
                            <yield-block params={{"footer"}} />
                            <!--
                            <button type="button"
                                    class="btn btn-default"
                                    data-dismiss="modal"
                                    {{"action" ("noexpand" "close")}}>
                                Close
                            </button>
                            -->
                        </div>
                    </div>
                </div>
            </div>
        `,this.actions={close(){this.setOpen(!1)}}}}g.default=C}),define("app/pods/widget-osm/component",["exports","muc/component","muc/observable","leaflet"],function(g,q,B,C){"use strict";Object.defineProperty(g,"__esModule",{value:!0});var D=function(G){return G&&G.__esModule?G:{default:G}}(C);D.default.Icon.Default.imagePath="/bower_components/leaflet/dist/images",g.default=class extends q.Component{constructor(){super(),this.template=`
            <div class="map {{modelObserve}}"></div>
        `,this.modelObserve=(0,B.computed)("model",function(){if(this.inDom){const E=this.trajectories;if(E){E.clearLayers(),E.addData(this.model.geoJSON||[]);const G=E.getBounds();return G.isValid()&&this.map.fitBounds(G,{padding:[100,100]}),""}}})}didInsertElement(){this.inDom=!0;const E=D.default.tileLayer(`${window.location.protocol}//{s}.osm.ternaris.com/mapbox-studio-osm-bright/{z}/{x}/{y}${D.default.Browser.retina?"@2x":""}.png`,{attribution:"\xA9 <a href=\"https://www.mapbox.com/map-feedback/\">Mapbox</a> \xA9 <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>",maxZoom:22}),G=D.default.tileLayer("http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"\xA9 <a href=\"http://www.esri.com/\">Esri</a> i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",maxZoom:22}),H=D.default.geoJson([],{style(N){return N.properties.style||{}}}),I=this.renderNode.children[0].elements[0].querySelector(".map"),J=D.default.map(I,{layers:[E,H],zoom:18,minZoom:0,maxZoom:22,maxBounds:D.default.LatLngBounds(D.default.latLng([75,-180]),D.default.latLng([-75,180]))});D.default.control.layers({Roadmap:E,Satellite:G},{Trajectories:H}).addTo(J),this.map=J,this.trajectories=H,H.addData(this.model.geoJSON||[]);const K=H.getBounds();K.isValid()&&this.map.fitBounds(K,{padding:[100,100]})}}}),define("app/pods/widget-table/component",["exports","muc/component","muc/observable"],function(g,q,B){"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.default=class extends q.Component{constructor(){super(),this.template=`
            {{#if sorted.length}}
                {{#if selectable}}
                    <label style="padding-left: 8px">
                    <input-checkbox value={{allChecked}} changeAction={{"fn" toggleAll}} />
                    All
                    </label>
                {{/if}}
                <yield-block params={{selected}} />
                <table class="table table-striped">
                    <thead>
                        <tr>
                            {{#if selectable}}<th></th>{{/if}}
                            {{#each omodel.columns as |col index|}}
                                <th class="interactive text-{{col.align}}" {{"action" ("noexpand" "sort" index)}}>
                                    {{col.title}}
                                    {{#if ("is-equal" index sort)}}
                                        <span class="glyphicon glyphicon-sort-by-attributes{{"if" descending "-alt" ""}}"></span>
                                    {{/if}}
                                </th>
                            {{/each}}
                        </tr>
                    </thead>
                    <tbody>
                        {{#each paginated as |row|}}
                            <tr>
                                {{#if selectable}}
                                    <td>
                                        <input-checkbox value={{row.selected}} changeAction={{"curry" ("noexpand" ("set" ("noexpand" row.selected)))}} />
                                    </td>
                                {{/if}}
                                {{#each row.columns as |col|}}
                                    <td class="text-{{col.align}}">
                                        {{#if col.list}}
                                            {{#each col.value as |val|}}
                                                {{(("concat" "format-" col.formatter) val)}}
                                            {{/each}}
                                        {{else}}
                                            {{(("concat" "format-" col.formatter) col.value)}}
                                        {{/if}}
                                    </td>
                                {{/each}}
                            </tr>
                        {{/each}}
                    </tbody>
                </table>
                {{#if ("not" ("is-equal" numPages 1))}}
                    <nav class="text-center">
                        <ul class="pagination pagination-sm">
                            <li class="{{"if" pager.prev.disabled "disabled"}}">
                                <a role="button" aria-label="Previous" {{"action" ("noexpand" "prevPage")}}>
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            {{#each pager.pages as |page|}}
                                <li class="{{"if" page.active "active"}} {{"if" page.disabled "disabled"}}"><a role="button" {{"action" ("noexpand" "page" page.num)}}>{{page.num}}</a></li>
                            {{/each}}
                            <li class="{{"if" pager.next.disabled "disabled"}}">
                                <a role="button" aria-label="Next" {{"action" ("noexpand" "nextPage")}}>
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                {{/if}}
            {{/if}}
        `,this.actions={prevPage(){0<this.page&&this.page--},nextPage(){this.page<this.numPages-1&&this.page++},page(C){"..."===C||(this.page=C-1)},sort(C){var D=this.sort;D===C?this.descending=!this.descending:(this.descending=!0,this.sort=C)}},this.omodel=(0,B.computed)("model",function(){this.model.rows.forEach(D=>{D.columns=D.values.map((E,G)=>{const H={value:E};return Object.assign(H,this.model.columns[G]),H})});const C=B.O.create(this.model);return C.rows=B.A.create(C.rows.map(D=>B.O.create(D))),C}),this.sort=(0,B.computed)("omodel.sort",function(){return this.omodel.sort}),this.descending=(0,B.computed)("omodel.sort_descending",function(){return this.omodel.sort_descending}),this.sorted=(0,B.computed)("sort","descending","omodel.rows",function(){console.time("sorted");const C=this.omodel.rows,D=this.sort,E=this.descending;if(null===D||!C.length)return C;if(!("sort"in C[0].columns[D])){let H;if(this.model.columns[D].sort_key){const I=this.model.columns[D].sort_key;H=J=>null===J?"":J[I]}else H=this.model.columns[D].list?I=>null===I?"":I.length:I=>null===I?"":I;C.forEach(I=>{I.columns[D].sort=H(I.columns[D].value)})}const G=C.sort((H,I)=>{return H=H.columns[D].sort,I=I.columns[D].sort,H===I?0:E?2*(H<I)-1:2*(H>=I)-1});return console.timeEnd("sorted"),G}),this.page=0,this.pagesizes=[50,100],this.pagesize=50,this.numPages=(0,B.computed)("sorted","pagesize",function(){return this.pagesize?Math.ceil(this.sorted.length/this.pagesize):1}),this.paginated=(0,B.computed)("sorted","page","pagesize",function(){const C=this.page,D=this.pagesize;return-1===D?this.sorted:this.sorted.slice(C*D,(C+1)*D)}),this.selected=B.A.create(),this.allChecked=(0,B.computed)("omodel.rows.@each.selected",function(){return this.selected.splice.apply(this.selected,[0,this.selected.length].concat(this.omodel.rows.filter(C=>C.selected))),this.omodel.rows.filter(C=>C.selected).length===this.omodel.rows.length}),this.pagersize=7,this.pager=(0,B.computed)("page","pagesize","sorted",function(){if(this.sorted.length<this.pagesize)return[];const C={prev:{disabled:0===this.page,page:this.page-1},next:{disabled:this.page===this.numPages-1,page:this.page+1},pages:[]};for(let D=0,E=this.numPages;D<E;D++)C.pages.push({num:D+1,active:D===this.page});if(C.pages.length>this.pagersize){const D={num:"...",disabled:!0},E=this.pagersize-1,G=E>>1,H=(E>>1)+(1&E);this.page<=G?C.pages.splice(E-1,C.pages.length-E,D):this.page>=C.pages.length-1-H?C.pages.splice(1,C.pages.length-E,D):(C.pages.splice(this.page+H-1,C.pages.length-1-(this.page+H-1),D),C.pages.splice(1,this.page-(G-1),D))}return C})}toggleAll(){this.allChecked?this.omodel.rows.forEach(C=>C.selected=!1):this.omodel.rows.forEach(C=>C.selected=!0)}}}),define("app/pods/widget-tag/component",["exports","muc/component","muc/observable"],function(g,q,B){"use strict";function C(E,G){do{if(E===G)return!0;G=G.parentElement}while(G.parentElement);return!1}Object.defineProperty(g,"__esModule",{value:!0});class D extends q.Component{constructor(){super(),this.template=`
            <span class="dropdown {{"if" focused "open"}}"
                        {{"action" ("noexpand" "keydown" on="keydown")}}
                        {{"action" ("noexpand" "focusIn" on="focusinX")}}
                        {{"action" ("noexpand" "focusOut" on="focusoutX")}}>
                <span class="backdrop" {{"action" ("noexpand" "focusIn")}}></span>
                <button role="button" class="{{class}}" disabled={{fulldisabled}} {{"action" ("noexpand" "focusIn")}}>
                    tag <span class="caret"></span>
                </button>
                <ul class="dropdown-menu {{menuClass}} bulk-dropdown">
                    {{#if disabled}}
                        <li class="text-center">Sign in to tag</li>
                    {{else}}
                        <li>
                            <a role="button">
                                <input-control type="text" class="form-control input-sm" placeholder="Label" value={{search}} changeAction={{"curry" ("noexpand" ("set" ("noexpand" search)))}} />
                            </a>
                        </li>
						<!--
                        <li class="dropdown-header">Tags</li>
						-->
                        {{#each results as |tag|}}
                            <li class="xtag">
                                <a role="button" {{"action" ("noexpand" "toggle" tag)}} title={{tag.hint}} tabindex=-1>
                                    <span class="glyphicon glyphicon-{{tag.state}}"></span>
                                    {{tag.name}}
                                </a>
                            </li>
                        {{/each}}
                        <li role="separator" class="divider"></li>
                        <li class="text-right">
                            <a role="button">
                                <button class="btn btn-default btn-xs" type="button" {{"action" ("noexpand" "save")}}>Save tags</button>
                            </a>
                        </li>
                    {{/if}}
                </ul>
            </span>
		`,this.tags=null,this.alltags=null,this.search="",this.realtags=(0,B.computed)("focused",function(){if(!this.tags.length)return B.A.create();if("string"==typeof this.tags[0])return B.A.create(this.tags);let E=this.tags[0].tags.slice();return this.tags.forEach(G=>{E=E.filter(H=>~G.tags.indexOf(H))}),B.A.create(E)}),this.mtags=(0,B.computed)("realtags",function(){return B.A.create(this.realtags)}),this.malltags=(0,B.computed)("focused",function(){return B.A.create(this.alltags)}),this.vtags=(0,B.computed)("mtags.@each","malltags.@each",function(){return B.A.create(this.realtags.map(E=>{return B.O.create({name:E,state:~this.mtags.indexOf(E)?"check":"unchecked"})}).concat(this.malltags.filter(E=>!~this.realtags.indexOf(E)).map(E=>{return B.O.create({name:E,state:~this.mtags.indexOf(E)?"check":"unchecked"})})))}),this.results=(0,B.computed)("search","vtags.@each",function(){const E=this.search,G=new RegExp(E,"i"),H=B.A.create(this.vtags.filter(I=>G.test(I.name)));return E&&!H.filter(I=>I.name===E).length&&H.push(B.O.create({name:`create "${E}"`,action:"create",label:this.search})),H}),this.focused=!1,this.actions={focusIn(E){console.log("in",E.target),this.focused=!this.focused},focusOut(E){if(console.log("out",E.target,E.relatedTarget),E.relatedTarget){const G=this.renderNode.children[0].elements[0];if(C(G,E.relatedTarget))return}this.focused=!1},toggle(E){"create"===E.action?(this.mtags.push(this.search),!~this.malltags.indexOf(this.search)&&this.malltags.push(this.search),this.search=""):~this.mtags.indexOf(E.name)?this.mtags.splice(this.mtags.indexOf(E.name),1):this.mtags.push(E.name)},keydown(E){const G=E;13===G.keyCode&&(~this.malltags.indexOf(this.search)?~this.mtags.indexOf(this.search)?this.mtags.splice(this.mtags.indexOf(this.search),1):this.mtags.push(this.search):(this.malltags.push(this.search),this.mtags.push(this.search)),this.search="",G.stopPropagation(),G.preventDefault())},save(){const E=this.mtags.filter(H=>!~this.realtags.indexOf(H)),G=this.realtags.filter(H=>!~this.mtags.indexOf(H));this.changeAction({added:E,removed:G}),this.focused=!1}}}}g.default=D}),define("leaflet",["module","exports"],function(g,q){"use strict";function B(){var I=window.L;C.noConflict=function(){return window.L=I,this},window.L=C}Object.defineProperty(q,"__esModule",{value:!0});var C={version:"1.0.0"};"object"==typeof g&&"object"==typeof g.exports?g.exports=C:"function"==typeof define&&define.amd&&define(C),"undefined"!=typeof window&&B(),C.Util={extend:function(I){var J,K,N,P;for(K=1,N=arguments.length;K<N;K++)for(J in P=arguments[K],P)I[J]=P[J];return I},create:Object.create||function(){function I(){}return function(J){return I.prototype=J,new I}}(),bind:function(I,J){var K=Array.prototype.slice;if(I.bind)return I.bind.apply(I,K.call(arguments,1));var N=K.call(arguments,2);return function(){return I.apply(J,N.length?N.concat(K.call(arguments)):arguments)}},stamp:function(I){return I._leaflet_id=I._leaflet_id||++C.Util.lastId,I._leaflet_id},lastId:0,throttle:function(I,J,K){var N,P,Q,R;return R=function(){N=!1,P&&(Q.apply(K,P),P=!1)},Q=function(){N?P=arguments:(I.apply(K,arguments),setTimeout(R,J),N=!0)},Q},wrapNum:function(I,J,K){var N=J[1],P=J[0],Q=N-P;return I===N&&K?I:((I-P)%Q+Q)%Q+P},falseFn:function(){return!1},formatNum:function(I,J){var K=Math.pow(10,J||5);return Math.round(I*K)/K},trim:function(I){return I.trim?I.trim():I.replace(/^\s+|\s+$/g,"")},splitWords:function(I){return C.Util.trim(I).split(/\s+/)},setOptions:function(I,J){for(var K in I.hasOwnProperty("options")||(I.options=I.options?C.Util.create(I.options):{}),J)I.options[K]=J[K];return I.options},getParamString:function(I,J,K){var N=[];for(var P in I)N.push(encodeURIComponent(K?P.toUpperCase():P)+"="+encodeURIComponent(I[P]));return(J&&-1!==J.indexOf("?")?"&":"?")+N.join("&")},template:function(I,J){return I.replace(C.Util.templateRe,function(K,N){var P=J[N];if(P===void 0)throw new Error("No value provided for variable "+K);else"function"==typeof P&&(P=P(J));return P})},templateRe:/\{ *([\w_\-]+) *\}/g,isArray:Array.isArray||function(I){return"[object Array]"===Object.prototype.toString.call(I)},indexOf:function(I,J){for(var K=0;K<I.length;K++)if(I[K]===J)return K;return-1},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function I(Q){return window["webkit"+Q]||window["moz"+Q]||window["ms"+Q]}function J(Q){var R=+new Date,T=Math.max(0,16-(R-K));return K=R+T,window.setTimeout(Q,T)}var K=0,N=window.requestAnimationFrame||I("RequestAnimationFrame")||J,P=window.cancelAnimationFrame||I("CancelAnimationFrame")||I("CancelRequestAnimationFrame")||function(Q){window.clearTimeout(Q)};C.Util.requestAnimFrame=function(Q,R,T){return T&&N===J?void Q.call(R):N.call(window,C.bind(Q,R))},C.Util.cancelAnimFrame=function(Q){Q&&P.call(window,Q)}}(),C.extend=C.Util.extend,C.bind=C.Util.bind,C.stamp=C.Util.stamp,C.setOptions=C.Util.setOptions,C.Class=function(){},C.Class.extend=function(I){var J=function(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},K=J.__super__=this.prototype,N=C.Util.create(K);for(var P in N.constructor=J,J.prototype=N,this)this.hasOwnProperty(P)&&"prototype"!==P&&(J[P]=this[P]);return I.statics&&(C.extend(J,I.statics),delete I.statics),I.includes&&(C.Util.extend.apply(null,[N].concat(I.includes)),delete I.includes),N.options&&(I.options=C.Util.extend(C.Util.create(N.options),I.options)),C.extend(N,I),N._initHooks=[],N.callInitHooks=function(){if(!this._initHooksCalled){K.callInitHooks&&K.callInitHooks.call(this),this._initHooksCalled=!0;for(var Q=0,R=N._initHooks.length;Q<R;Q++)N._initHooks[Q].call(this)}},J},C.Class.include=function(I){return C.extend(this.prototype,I),this},C.Class.mergeOptions=function(I){return C.extend(this.prototype.options,I),this},C.Class.addInitHook=function(I){var J=Array.prototype.slice.call(arguments,1),K="function"==typeof I?I:function(){this[I].apply(this,J)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(K),this},C.Evented=C.Class.extend({on:function(I,J,K){if("object"==typeof I)for(var N in I)this._on(N,I[N],J);else{I=C.Util.splitWords(I);for(var P=0,Q=I.length;P<Q;P++)this._on(I[P],J,K)}return this},off:function(I,J,K){if(!I)delete this._events;else if("object"==typeof I)for(var N in I)this._off(N,I[N],J);else{I=C.Util.splitWords(I);for(var P=0,Q=I.length;P<Q;P++)this._off(I[P],J,K)}return this},_on:function(I,J,K){this._events=this._events||{};var N=this._events[I];N||(N=[],this._events[I]=N),K===this&&(K=void 0);var P={fn:J,ctx:K},Q=N;for(var R=0,T=Q.length;R<T;R++)if(Q[R].fn===J&&Q[R].ctx===K)return;Q.push(P),N.count++},_off:function(I,J,K){var N,P,Q;if(this._events&&(N=this._events[I],!!N)){if(!J){for(P=0,Q=N.length;P<Q;P++)N[P].fn=C.Util.falseFn;return void delete this._events[I]}if(K===this&&(K=void 0),N)for(P=0,Q=N.length;P<Q;P++){var R=N[P];R.ctx===K&&R.fn===J&&(R.fn=C.Util.falseFn,this._firingCount&&(this._events[I]=N=N.slice()),N.splice(P,1))}}},fire:function(I,J,K){if(!this.listens(I,K))return this;var N=C.Util.extend({},J,{type:I,target:this});if(this._events){var P=this._events[I];if(P){this._firingCount=this._firingCount+1||1;for(var Q=0,R=P.length;Q<R;Q++){var T=P[Q];T.fn.call(T.ctx||this,N)}this._firingCount--}}return K&&this._propagateEvent(N),this},listens:function(I,J){var K=this._events&&this._events[I];if(K&&K.length)return!0;if(J)for(var N in this._eventParents)if(this._eventParents[N].listens(I,J))return!0;return!1},once:function(I,J,K){if("object"==typeof I){for(var N in I)this.once(N,I[N],J);return this}var P=C.bind(function(){this.off(I,J,K).off(I,P,K)},this);return this.on(I,J,K).on(I,P,K)},addEventParent:function(I){return this._eventParents=this._eventParents||{},this._eventParents[C.stamp(I)]=I,this},removeEventParent:function(I){return this._eventParents&&delete this._eventParents[C.stamp(I)],this},_propagateEvent:function(I){for(var J in this._eventParents)this._eventParents[J].fire(I.type,C.extend({layer:I.target},I),!0)}});var D=C.Evented.prototype;D.addEventListener=D.on,D.removeEventListener=D.clearAllEventListeners=D.off,D.addOneTimeEventListener=D.once,D.fireEvent=D.fire,D.hasEventListeners=D.listens,C.Mixin={Events:D},function(){var I=navigator.userAgent.toLowerCase(),J=document.documentElement,K="ActiveXObject"in window,N=-1!==I.indexOf("webkit"),P=-1!==I.indexOf("phantom"),Q=-1!==I.search("android [23]"),R=-1!==I.indexOf("chrome"),T=-1!==I.indexOf("gecko")&&!N&&!window.opera&&!K,U=0===navigator.platform.indexOf("Win"),V="undefined"!=typeof orientation||-1!==I.indexOf("mobile"),W=!window.PointerEvent&&window.MSPointerEvent,X=window.PointerEvent||W,Y=K&&"transition"in J.style,Z="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Q,$="MozPerspective"in J.style,_="OTransition"in J.style,aa=!window.L_NO_TOUCH&&(X||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch);C.Browser={ie:K,ielt9:K&&!document.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in document),webkit:N,gecko:T,android:-1!==I.indexOf("android"),android23:Q,chrome:R,safari:!R&&-1!==I.indexOf("safari"),win:U,ie3d:Y,webkit3d:Z,gecko3d:$,opera12:_,any3d:!window.L_DISABLE_3D&&(Y||Z||$)&&!_&&!P,mobile:V,mobileWebkit:V&&N,mobileWebkit3d:V&&Z,mobileOpera:V&&window.opera,mobileGecko:V&&T,touch:!!aa,msPointer:!!W,pointer:!!X,retina:1<(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)}}(),C.Point=function(I,J,K){this.x=K?Math.round(I):I,this.y=K?Math.round(J):J},C.Point.prototype={clone:function(){return new C.Point(this.x,this.y)},add:function(I){return this.clone()._add(C.point(I))},_add:function(I){return this.x+=I.x,this.y+=I.y,this},subtract:function(I){return this.clone()._subtract(C.point(I))},_subtract:function(I){return this.x-=I.x,this.y-=I.y,this},divideBy:function(I){return this.clone()._divideBy(I)},_divideBy:function(I){return this.x/=I,this.y/=I,this},multiplyBy:function(I){return this.clone()._multiplyBy(I)},_multiplyBy:function(I){return this.x*=I,this.y*=I,this},scaleBy:function(I){return new C.Point(this.x*I.x,this.y*I.y)},unscaleBy:function(I){return new C.Point(this.x/I.x,this.y/I.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},distanceTo:function(I){I=C.point(I);var J=I.x-this.x,K=I.y-this.y;return Math.sqrt(J*J+K*K)},equals:function(I){return I=C.point(I),I.x===this.x&&I.y===this.y},contains:function(I){return I=C.point(I),Math.abs(I.x)<=Math.abs(this.x)&&Math.abs(I.y)<=Math.abs(this.y)},toString:function(){return"Point("+C.Util.formatNum(this.x)+", "+C.Util.formatNum(this.y)+")"}},C.point=function(I,J,K){return I instanceof C.Point?I:C.Util.isArray(I)?new C.Point(I[0],I[1]):void 0===I||null===I?I:"object"==typeof I&&"x"in I&&"y"in I?new C.Point(I.x,I.y):new C.Point(I,J,K)},C.Bounds=function(I,J){if(I){var K=J?[I,J]:I;for(var N=0,P=K.length;N<P;N++)this.extend(K[N])}},C.Bounds.prototype={extend:function(I){return I=C.point(I),this.min||this.max?(this.min.x=Math.min(I.x,this.min.x),this.max.x=Math.max(I.x,this.max.x),this.min.y=Math.min(I.y,this.min.y),this.max.y=Math.max(I.y,this.max.y)):(this.min=I.clone(),this.max=I.clone()),this},getCenter:function(I){return new C.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,I)},getBottomLeft:function(){return new C.Point(this.min.x,this.max.y)},getTopRight:function(){return new C.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(I){var J,K;return I="number"==typeof I[0]||I instanceof C.Point?C.point(I):C.bounds(I),I instanceof C.Bounds?(J=I.min,K=I.max):J=K=I,J.x>=this.min.x&&K.x<=this.max.x&&J.y>=this.min.y&&K.y<=this.max.y},intersects:function(I){I=C.bounds(I);var J=this.min,K=this.max,N=I.min,P=I.max,Q=P.x>=J.x&&N.x<=K.x,R=P.y>=J.y&&N.y<=K.y;return Q&&R},overlaps:function(I){I=C.bounds(I);var J=this.min,K=this.max,N=I.min,P=I.max,Q=P.x>J.x&&N.x<K.x,R=P.y>J.y&&N.y<K.y;return Q&&R},isValid:function(){return!!(this.min&&this.max)}},C.bounds=function(I,J){return!I||I instanceof C.Bounds?I:new C.Bounds(I,J)},C.Transformation=function(I,J,K,N){this._a=I,this._b=J,this._c=K,this._d=N},C.Transformation.prototype={transform:function(I,J){return this._transform(I.clone(),J)},_transform:function(I,J){return J=J||1,I.x=J*(this._a*I.x+this._b),I.y=J*(this._c*I.y+this._d),I},untransform:function(I,J){return J=J||1,new C.Point((I.x/J-this._b)/this._a,(I.y/J-this._d)/this._c)}},C.DomUtil={get:function(I){return"string"==typeof I?document.getElementById(I):I},getStyle:function(I,J){var K=I.style[J]||I.currentStyle&&I.currentStyle[J];if((!K||"auto"===K)&&document.defaultView){var N=document.defaultView.getComputedStyle(I,null);K=N?N[J]:null}return"auto"===K?null:K},create:function(I,J,K){var N=document.createElement(I);return N.className=J||"",K&&K.appendChild(N),N},remove:function(I){var J=I.parentNode;J&&J.removeChild(I)},empty:function(I){for(;I.firstChild;)I.removeChild(I.firstChild)},toFront:function(I){I.parentNode.appendChild(I)},toBack:function(I){var J=I.parentNode;J.insertBefore(I,J.firstChild)},hasClass:function(I,J){if(I.classList!==void 0)return I.classList.contains(J);var K=C.DomUtil.getClass(I);return 0<K.length&&new RegExp("(^|\\s)"+J+"(\\s|$)").test(K)},addClass:function(I,J){if(I.classList!==void 0){var K=C.Util.splitWords(J);for(var N=0,P=K.length;N<P;N++)I.classList.add(K[N])}else if(!C.DomUtil.hasClass(I,J)){var Q=C.DomUtil.getClass(I);C.DomUtil.setClass(I,(Q?Q+" ":"")+J)}},removeClass:function(I,J){I.classList===void 0?C.DomUtil.setClass(I,C.Util.trim((" "+C.DomUtil.getClass(I)+" ").replace(" "+J+" "," "))):I.classList.remove(J)},setClass:function(I,J){I.className.baseVal===void 0?I.className=J:I.className.baseVal=J},getClass:function(I){return I.className.baseVal===void 0?I.className:I.className.baseVal},setOpacity:function(I,J){"opacity"in I.style?I.style.opacity=J:"filter"in I.style&&C.DomUtil._setOpacityIE(I,J)},_setOpacityIE:function(I,J){var K=!1,N="DXImageTransform.Microsoft.Alpha";try{K=I.filters.item(N)}catch(P){if(1===J)return}J=Math.round(100*J),K?(K.Enabled=100!==J,K.Opacity=J):I.style.filter+=" progid:"+N+"(opacity="+J+")"},testProp:function(I){var J=document.documentElement.style;for(var K=0;K<I.length;K++)if(I[K]in J)return I[K];return!1},setTransform:function(I,J,K){var N=J||new C.Point(0,0);I.style[C.DomUtil.TRANSFORM]=(C.Browser.ie3d?"translate("+N.x+"px,"+N.y+"px)":"translate3d("+N.x+"px,"+N.y+"px,0)")+(K?" scale("+K+")":"")},setPosition:function(I,J){I._leaflet_pos=J,C.Browser.any3d?C.DomUtil.setTransform(I,J):(I.style.left=J.x+"px",I.style.top=J.y+"px")},getPosition:function(I){return I._leaflet_pos||new C.Point(0,0)}},function(){C.DomUtil.TRANSFORM=C.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]);var I=C.DomUtil.TRANSITION=C.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);if(C.DomUtil.TRANSITION_END="webkitTransition"===I||"OTransition"===I?I+"End":"transitionend","onselectstart"in document)C.DomUtil.disableTextSelection=function(){C.DomEvent.on(window,"selectstart",C.DomEvent.preventDefault)},C.DomUtil.enableTextSelection=function(){C.DomEvent.off(window,"selectstart",C.DomEvent.preventDefault)};else{var J=C.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);C.DomUtil.disableTextSelection=function(){if(J){var K=document.documentElement.style;this._userSelect=K[J],K[J]="none"}},C.DomUtil.enableTextSelection=function(){J&&(document.documentElement.style[J]=this._userSelect,delete this._userSelect)}}C.DomUtil.disableImageDrag=function(){C.DomEvent.on(window,"dragstart",C.DomEvent.preventDefault)},C.DomUtil.enableImageDrag=function(){C.DomEvent.off(window,"dragstart",C.DomEvent.preventDefault)},C.DomUtil.preventOutline=function(K){for(;-1===K.tabIndex;)K=K.parentNode;K&&K.style&&(C.DomUtil.restoreOutline(),this._outlineElement=K,this._outlineStyle=K.style.outline,K.style.outline="none",C.DomEvent.on(window,"keydown",C.DomUtil.restoreOutline,this))},C.DomUtil.restoreOutline=function(){this._outlineElement&&(this._outlineElement.style.outline=this._outlineStyle,delete this._outlineElement,delete this._outlineStyle,C.DomEvent.off(window,"keydown",C.DomUtil.restoreOutline,this))}}(),C.LatLng=function(I,J,K){if(isNaN(I)||isNaN(J))throw new Error("Invalid LatLng object: ("+I+", "+J+")");this.lat=+I,this.lng=+J,K!==void 0&&(this.alt=+K)},C.LatLng.prototype={equals:function(I,J){if(!I)return!1;I=C.latLng(I);var K=Math.max(Math.abs(this.lat-I.lat),Math.abs(this.lng-I.lng));return K<=(J===void 0?1e-9:J)},toString:function(I){return"LatLng("+C.Util.formatNum(this.lat,I)+", "+C.Util.formatNum(this.lng,I)+")"},distanceTo:function(I){return C.CRS.Earth.distance(this,C.latLng(I))},wrap:function(){return C.CRS.Earth.wrapLatLng(this)},toBounds:function(I){var J=180*I/40075017,K=J/Math.cos(Math.PI/180*this.lat);return C.latLngBounds([this.lat-J,this.lng-K],[this.lat+J,this.lng+K])},clone:function(){return new C.LatLng(this.lat,this.lng,this.alt)}},C.latLng=function(I,J,K){return I instanceof C.LatLng?I:C.Util.isArray(I)&&"object"!=typeof I[0]?3===I.length?new C.LatLng(I[0],I[1],I[2]):2===I.length?new C.LatLng(I[0],I[1]):null:void 0===I||null===I?I:"object"==typeof I&&"lat"in I?new C.LatLng(I.lat,"lng"in I?I.lng:I.lon,I.alt):void 0===J?null:new C.LatLng(I,J,K)},C.LatLngBounds=function(I,J){if(I){var K=J?[I,J]:I;for(var N=0,P=K.length;N<P;N++)this.extend(K[N])}},C.LatLngBounds.prototype={extend:function(I){var N,P,J=this._southWest,K=this._northEast;if(I instanceof C.LatLng)N=I,P=I;else{if(!(I instanceof C.LatLngBounds))return I?this.extend(C.latLng(I)||C.latLngBounds(I)):this;if(N=I._southWest,P=I._northEast,!N||!P)return this}return J||K?(J.lat=Math.min(N.lat,J.lat),J.lng=Math.min(N.lng,J.lng),K.lat=Math.max(P.lat,K.lat),K.lng=Math.max(P.lng,K.lng)):(this._southWest=new C.LatLng(N.lat,N.lng),this._northEast=new C.LatLng(P.lat,P.lng)),this},pad:function(I){var J=this._southWest,K=this._northEast,N=Math.abs(J.lat-K.lat)*I,P=Math.abs(J.lng-K.lng)*I;return new C.LatLngBounds(new C.LatLng(J.lat-N,J.lng-P),new C.LatLng(K.lat+N,K.lng+P))},getCenter:function(){return new C.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new C.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new C.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(I){I="number"==typeof I[0]||I instanceof C.LatLng?C.latLng(I):C.latLngBounds(I);var N,P,J=this._southWest,K=this._northEast;return I instanceof C.LatLngBounds?(N=I.getSouthWest(),P=I.getNorthEast()):N=P=I,N.lat>=J.lat&&P.lat<=K.lat&&N.lng>=J.lng&&P.lng<=K.lng},intersects:function(I){I=C.latLngBounds(I);var J=this._southWest,K=this._northEast,N=I.getSouthWest(),P=I.getNorthEast(),Q=P.lat>=J.lat&&N.lat<=K.lat,R=P.lng>=J.lng&&N.lng<=K.lng;return Q&&R},overlaps:function(I){I=C.latLngBounds(I);var J=this._southWest,K=this._northEast,N=I.getSouthWest(),P=I.getNorthEast(),Q=P.lat>J.lat&&N.lat<K.lat,R=P.lng>J.lng&&N.lng<K.lng;return Q&&R},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(I){return!!I&&(I=C.latLngBounds(I),this._southWest.equals(I.getSouthWest())&&this._northEast.equals(I.getNorthEast()))},isValid:function(){return!!(this._southWest&&this._northEast)}},C.latLngBounds=function(I,J){return I instanceof C.LatLngBounds?I:new C.LatLngBounds(I,J)},C.Projection={},C.Projection.LonLat={project:function(I){return new C.Point(I.lng,I.lat)},unproject:function(I){return new C.LatLng(I.y,I.x)},bounds:C.bounds([-180,-90],[180,90])},C.Projection.SphericalMercator={R:6378137,MAX_LATITUDE:85.0511287798,project:function(I){var J=Math.PI/180,K=this.MAX_LATITUDE,N=Math.max(Math.min(K,I.lat),-K),P=Math.sin(N*J);return new C.Point(this.R*I.lng*J,this.R*Math.log((1+P)/(1-P))/2)},unproject:function(I){var J=180/Math.PI;return new C.LatLng((2*Math.atan(Math.exp(I.y/this.R))-Math.PI/2)*J,I.x*J/this.R)},bounds:function(){var I=6378137*Math.PI;return C.bounds([-I,-I],[I,I])}()},C.CRS={latLngToPoint:function(I,J){var K=this.projection.project(I),N=this.scale(J);return this.transformation._transform(K,N)},pointToLatLng:function(I,J){var K=this.scale(J),N=this.transformation.untransform(I,K);return this.projection.unproject(N)},project:function(I){return this.projection.project(I)},unproject:function(I){return this.projection.unproject(I)},scale:function(I){return 256*Math.pow(2,I)},zoom:function(I){return Math.log(I/256)/Math.LN2},getProjectedBounds:function(I){if(this.infinite)return null;var J=this.projection.bounds,K=this.scale(I),N=this.transformation.transform(J.min,K),P=this.transformation.transform(J.max,K);return C.bounds(N,P)},infinite:!1,wrapLatLng:function(I){var J=this.wrapLng?C.Util.wrapNum(I.lng,this.wrapLng,!0):I.lng,K=this.wrapLat?C.Util.wrapNum(I.lat,this.wrapLat,!0):I.lat,N=I.alt;return C.latLng(K,J,N)}},C.CRS.Simple=C.extend({},C.CRS,{projection:C.Projection.LonLat,transformation:new C.Transformation(1,0,-1,0),scale:function(I){return Math.pow(2,I)},zoom:function(I){return Math.log(I)/Math.LN2},distance:function(I,J){var K=J.lng-I.lng,N=J.lat-I.lat;return Math.sqrt(K*K+N*N)},infinite:!0}),C.CRS.Earth=C.extend({},C.CRS,{wrapLng:[-180,180],R:6371000,distance:function(I,J){var K=Math.PI/180,N=I.lat*K,P=J.lat*K,Q=Math.sin(N)*Math.sin(P)+Math.cos(N)*Math.cos(P)*Math.cos((J.lng-I.lng)*K);return this.R*Math.acos(Math.min(Q,1))}}),C.CRS.EPSG3857=C.extend({},C.CRS.Earth,{code:"EPSG:3857",projection:C.Projection.SphericalMercator,transformation:function(){var I=0.5/(Math.PI*C.Projection.SphericalMercator.R);return new C.Transformation(I,0.5,-I,0.5)}()}),C.CRS.EPSG900913=C.extend({},C.CRS.EPSG3857,{code:"EPSG:900913"}),C.CRS.EPSG4326=C.extend({},C.CRS.Earth,{code:"EPSG:4326",projection:C.Projection.LonLat,transformation:new C.Transformation(1/180,1,-1/180,0.5)}),C.Map=C.Evented.extend({options:{crs:C.CRS.EPSG3857,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(I,J){J=C.setOptions(this,J),this._initContainer(I),this._initLayout(),this._onResize=C.bind(this._onResize,this),this._initEvents(),J.maxBounds&&this.setMaxBounds(J.maxBounds),J.zoom!==void 0&&(this._zoom=this._limitZoom(J.zoom)),J.center&&J.zoom!==void 0&&this.setView(C.latLng(J.center),J.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this.callInitHooks(),this._addLayers(this.options.layers)},setView:function(I,J){return J=void 0===J?this.getZoom():J,this._resetView(C.latLng(I),J),this},setZoom:function(I,J){return this._loaded?this.setView(this.getCenter(),I,{zoom:J}):(this._zoom=I,this)},zoomIn:function(I,J){return I=I||(C.Browser.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+I,J)},zoomOut:function(I,J){return I=I||(C.Browser.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-I,J)},setZoomAround:function(I,J,K){var N=this.getZoomScale(J),P=this.getSize().divideBy(2),Q=I instanceof C.Point?I:this.latLngToContainerPoint(I),R=Q.subtract(P).multiplyBy(1-1/N),T=this.containerPointToLatLng(P.add(R));return this.setView(T,J,{zoom:K})},_getBoundsCenterZoom:function(I,J){J=J||{},I=I.getBounds?I.getBounds():C.latLngBounds(I);var K=C.point(J.paddingTopLeft||J.padding||[0,0]),N=C.point(J.paddingBottomRight||J.padding||[0,0]),P=this.getBoundsZoom(I,!1,K.add(N));P="number"==typeof J.maxZoom?Math.min(J.maxZoom,P):P;var Q=N.subtract(K).divideBy(2),R=this.project(I.getSouthWest(),P),T=this.project(I.getNorthEast(),P),U=this.unproject(R.add(T).divideBy(2).add(Q),P);return{center:U,zoom:P}},fitBounds:function(I,J){if(I=C.latLngBounds(I),!I.isValid())throw new Error("Bounds are not valid.");var K=this._getBoundsCenterZoom(I,J);return this.setView(K.center,K.zoom,J)},fitWorld:function(I){return this.fitBounds([[-90,-180],[90,180]],I)},panTo:function(I,J){return this.setView(I,this._zoom,{pan:J})},panBy:function(I){return this.fire("movestart"),this._rawPanBy(C.point(I)),this.fire("move"),this.fire("moveend")},setMaxBounds:function(I){return(I=C.latLngBounds(I),!I.isValid())?(this.options.maxBounds=null,this.off("moveend",this._panInsideMaxBounds)):(this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this.options.maxBounds=I,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds))},setMinZoom:function(I){return this.options.minZoom=I,this._loaded&&this.getZoom()<this.options.minZoom?this.setZoom(I):this},setMaxZoom:function(I){return this.options.maxZoom=I,this._loaded&&this.getZoom()>this.options.maxZoom?this.setZoom(I):this},panInsideBounds:function(I,J){this._enforcingBounds=!0;var K=this.getCenter(),N=this._limitCenter(K,this._zoom,C.latLngBounds(I));return K.equals(N)||this.panTo(N,J),this._enforcingBounds=!1,this},invalidateSize:function(I){if(!this._loaded)return this;I=C.extend({animate:!1,pan:!0},!0===I?{animate:!0}:I);var J=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var K=this.getSize(),N=J.divideBy(2).round(),P=K.divideBy(2).round(),Q=N.subtract(P);return Q.x||Q.y?(I.animate&&I.pan?this.panBy(Q):(I.pan&&this._rawPanBy(Q),this.fire("move"),I.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(C.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:J,newSize:K})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},addHandler:function(I,J){if(!J)return this;var K=this[I]=new J(this);return this._handlers.push(K),this.options[I]&&K.enable(),this},remove:function(){if(this._initEvents(!0),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(J){this._container._leaflet_id=void 0,this._containerId=void 0}for(var I in C.DomUtil.remove(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[I].remove();return this},createPane:function(I,J){var K="leaflet-pane"+(I?" leaflet-"+I.replace("Pane","")+"-pane":""),N=C.DomUtil.create("div",K,J||this._mapPane);return I&&(this._panes[I]=N),N},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var I=this.getPixelBounds(),J=this.unproject(I.getBottomLeft()),K=this.unproject(I.getTopRight());return new C.LatLngBounds(J,K)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(I,J,K){I=C.latLngBounds(I),K=C.point(K||[0,0]);var N=this.getZoom()||0,P=this.getMinZoom(),Q=this.getMaxZoom(),R=I.getNorthWest(),T=I.getSouthEast(),U=this.getSize().subtract(K),V=this.project(T,N).subtract(this.project(R,N)),W=C.Browser.any3d?this.options.zoomSnap:1,X=Math.min(U.x/V.x,U.y/V.y);return N=this.getScaleZoom(X,N),W&&(N=Math.round(N/(W/100))*(W/100),N=J?Math.ceil(N/W)*W:Math.floor(N/W)*W),Math.max(P,Math.min(Q,N))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new C.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(I,J){var K=this._getTopLeftPoint(I,J);return new C.Bounds(K,K.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(I){return this.options.crs.getProjectedBounds(I===void 0?this.getZoom():I)},getPane:function(I){return"string"==typeof I?this._panes[I]:I},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(I,J){var K=this.options.crs;return J=void 0===J?this._zoom:J,K.scale(I)/K.scale(J)},getScaleZoom:function(I,J){var K=this.options.crs;J=J===void 0?this._zoom:J;var N=K.zoom(I*K.scale(J));return isNaN(N)?1/0:N},project:function(I,J){return J=void 0===J?this._zoom:J,this.options.crs.latLngToPoint(C.latLng(I),J)},unproject:function(I,J){return J=void 0===J?this._zoom:J,this.options.crs.pointToLatLng(C.point(I),J)},layerPointToLatLng:function(I){var J=C.point(I).add(this.getPixelOrigin());return this.unproject(J)},latLngToLayerPoint:function(I){var J=this.project(C.latLng(I))._round();return J._subtract(this.getPixelOrigin())},wrapLatLng:function(I){return this.options.crs.wrapLatLng(C.latLng(I))},distance:function(I,J){return this.options.crs.distance(C.latLng(I),C.latLng(J))},containerPointToLayerPoint:function(I){return C.point(I).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(I){return C.point(I).add(this._getMapPanePos())},containerPointToLatLng:function(I){var J=this.containerPointToLayerPoint(C.point(I));return this.layerPointToLatLng(J)},latLngToContainerPoint:function(I){return this.layerPointToContainerPoint(this.latLngToLayerPoint(C.latLng(I)))},mouseEventToContainerPoint:function(I){return C.DomEvent.getMousePosition(I,this._container)},mouseEventToLayerPoint:function(I){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(I))},mouseEventToLatLng:function(I){return this.layerPointToLatLng(this.mouseEventToLayerPoint(I))},_initContainer:function(I){var J=this._container=C.DomUtil.get(I);if(!J)throw new Error("Map container not found.");else if(J._leaflet_id)throw new Error("Map container is already initialized.");C.DomEvent.addListener(J,"scroll",this._onScroll,this),this._containerId=C.Util.stamp(J)},_initLayout:function(){var I=this._container;this._fadeAnimated=this.options.fadeAnimation&&C.Browser.any3d,C.DomUtil.addClass(I,"leaflet-container"+(C.Browser.touch?" leaflet-touch":"")+(C.Browser.retina?" leaflet-retina":"")+(C.Browser.ielt9?" leaflet-oldie":"")+(C.Browser.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var J=C.DomUtil.getStyle(I,"position");"absolute"!==J&&"relative"!==J&&"fixed"!==J&&(I.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var I=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),C.DomUtil.setPosition(this._mapPane,new C.Point(0,0)),this.createPane("tilePane"),this.createPane("shadowPane"),this.createPane("overlayPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(C.DomUtil.addClass(I.markerPane,"leaflet-zoom-hide"),C.DomUtil.addClass(I.shadowPane,"leaflet-zoom-hide"))},_resetView:function(I,J){C.DomUtil.setPosition(this._mapPane,new C.Point(0,0));var K=!this._loaded;this._loaded=!0,J=this._limitZoom(J),this.fire("viewprereset");var N=this._zoom!==J;this._moveStart(N)._move(I,J)._moveEnd(N),this.fire("viewreset"),K&&this.fire("load")},_moveStart:function(I){return I&&this.fire("zoomstart"),this.fire("movestart")},_move:function(I,J,K){void 0===J&&(J=this._zoom);var N=this._zoom!==J;return this._zoom=J,this._lastCenter=I,this._pixelOrigin=this._getNewPixelOrigin(I),(N||K&&K.pinch)&&this.fire("zoom",K),this.fire("move",K)},_moveEnd:function(I){return I&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return C.Util.cancelAnimFrame(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(I){C.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(I))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(I){if(C.DomEvent){this._targets={},this._targets[C.stamp(this._container)]=this;var J=I?"off":"on";C.DomEvent[J](this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress",this._handleDOMEvent,this),this.options.trackResize&&C.DomEvent[J](window,"resize",this._onResize,this),C.Browser.any3d&&this.options.transform3DLimit&&this[J]("moveend",this._onMoveEnd)}},_onResize:function(){C.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=C.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var I=this._getMapPanePos();Math.max(Math.abs(I.x),Math.abs(I.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(I,J){for(var N,K=[],P="mouseout"===J||"mouseover"===J,Q=I.target||I.srcElement,R=!1;Q;){if(N=this._targets[C.stamp(Q)],N&&("click"===J||"preclick"===J)&&!I._simulated&&this._draggableMoved(N)){R=!0;break}if(N&&N.listens(J,!0)){if(P&&!C.DomEvent._isExternalTarget(Q,I))break;if(K.push(N),P)break}if(Q===this._container)break;Q=Q.parentNode}return K.length||R||P||!C.DomEvent._isExternalTarget(Q,I)||(K=[this]),K},_handleDOMEvent:function(I){if(this._loaded&&!C.DomEvent._skipped(I)){var J="keypress"===I.type&&13===I.keyCode?"click":I.type;"mousedown"===J&&C.DomUtil.preventOutline(I.target||I.srcElement),this._fireDOMEvent(I,J)}},_fireDOMEvent:function(I,J,K){if("click"===I.type){var N=C.Util.extend({},I);N.type="preclick",this._fireDOMEvent(N,N.type,K)}if(!I._stopped&&(K=(K||[]).concat(this._findEventTargets(I,J)),!!K.length)){var P=K[0];"contextmenu"===J&&P.listens(J,!0)&&C.DomEvent.preventDefault(I);var Q={originalEvent:I};if("keypress"!==I.type){var R=P instanceof C.Marker;Q.containerPoint=R?this.latLngToContainerPoint(P.getLatLng()):this.mouseEventToContainerPoint(I),Q.layerPoint=this.containerPointToLayerPoint(Q.containerPoint),Q.latlng=R?P.getLatLng():this.layerPointToLatLng(Q.layerPoint)}for(var T=0;T<K.length;T++)K[T].fire(J,Q,!0),Q.originalEvent._stopped||K[T].options.nonBubblingEvents&&-1!==C.Util.indexOf(K[T].options.nonBubblingEvents,J)}},_draggableMoved:function(I){return I=I.dragging&&I.dragging.enabled()?I:this,I.dragging&&I.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var I=0,J=this._handlers.length;I<J;I++)this._handlers[I].disable()},whenReady:function(I,J){return this._loaded?I.call(J||this,{target:this}):this.on("load",I,J),this},_getMapPanePos:function(){return C.DomUtil.getPosition(this._mapPane)||new C.Point(0,0)},_moved:function(){var I=this._getMapPanePos();return I&&!I.equals([0,0])},_getTopLeftPoint:function(I,J){var K=I&&J!==void 0?this._getNewPixelOrigin(I,J):this.getPixelOrigin();return K.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(I,J){var K=this.getSize()._divideBy(2);return this.project(I,J)._subtract(K)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(I,J,K){var N=this._getNewPixelOrigin(K,J);return this.project(I,J)._subtract(N)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(I){return this.latLngToLayerPoint(I).subtract(this._getCenterLayerPoint())},_limitCenter:function(I,J,K){if(!K)return I;var N=this.project(I,J),P=this.getSize().divideBy(2),Q=new C.Bounds(N.subtract(P),N.add(P)),R=this._getBoundsOffset(Q,K,J);return R.round().equals([0,0])?I:this.unproject(N.add(R),J)},_limitOffset:function(I,J){if(!J)return I;var K=this.getPixelBounds(),N=new C.Bounds(K.min.add(I),K.max.add(I));return I.add(this._getBoundsOffset(N,J))},_getBoundsOffset:function(I,J,K){var N=C.bounds(this.project(J.getNorthEast(),K),this.project(J.getSouthWest(),K)),P=N.min.subtract(I.min),Q=N.max.subtract(I.max),R=this._rebound(P.x,-Q.x),T=this._rebound(P.y,-Q.y);return new C.Point(R,T)},_rebound:function(I,J){return 0<I+J?Math.round(I-J)/2:Math.max(0,Math.ceil(I))-Math.max(0,Math.floor(J))},_limitZoom:function(I){var J=this.getMinZoom(),K=this.getMaxZoom(),N=C.Browser.any3d?this.options.zoomSnap:1;return N&&(I=Math.round(I/N)*N),Math.max(J,Math.min(K,I))}}),C.map=function(I,J){return new C.Map(I,J)},C.Layer=C.Evented.extend({options:{pane:"overlayPane",nonBubblingEvents:[]},addTo:function(I){return I.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(I){return I&&I.removeLayer(this),this},getPane:function(I){return this._map.getPane(I?this.options[I]||I:this.options.pane)},addInteractiveTarget:function(I){return this._map._targets[C.stamp(I)]=this,this},removeInteractiveTarget:function(I){return delete this._map._targets[C.stamp(I)],this},_layerAdd:function(I){var J=I.target;if(J.hasLayer(this)){if(this._map=J,this._zoomAnimated=J._zoomAnimated,this.getEvents){var K=this.getEvents();J.on(K,this),this.once("remove",function(){J.off(K,this)},this)}this.onAdd(J),this.getAttribution&&this._map.attributionControl&&this._map.attributionControl.addAttribution(this.getAttribution()),this.fire("add"),J.fire("layeradd",{layer:this})}}}),C.Map.include({addLayer:function(I){var J=C.stamp(I);return this._layers[J]?this:(this._layers[J]=I,I._mapToAdd=this,I.beforeAdd&&I.beforeAdd(this),this.whenReady(I._layerAdd,I),this)},removeLayer:function(I){var J=C.stamp(I);return this._layers[J]?(this._loaded&&I.onRemove(this),I.getAttribution&&this.attributionControl&&this.attributionControl.removeAttribution(I.getAttribution()),delete this._layers[J],this._loaded&&(this.fire("layerremove",{layer:I}),I.fire("remove")),I._map=I._mapToAdd=null,this):this},hasLayer:function(I){return!!I&&C.stamp(I)in this._layers},eachLayer:function(I,J){for(var K in this._layers)I.call(J,this._layers[K]);return this},_addLayers:function(I){I=I?C.Util.isArray(I)?I:[I]:[];for(var J=0,K=I.length;J<K;J++)this.addLayer(I[J])},_addZoomLimit:function(I){(isNaN(I.options.maxZoom)||!isNaN(I.options.minZoom))&&(this._zoomBoundLayers[C.stamp(I)]=I,this._updateZoomLevels())},_removeZoomLimit:function(I){var J=C.stamp(I);this._zoomBoundLayers[J]&&(delete this._zoomBoundLayers[J],this._updateZoomLevels())},_updateZoomLevels:function(){var I=1/0,J=-(1/0),K=this._getZoomSpan();for(var N in this._zoomBoundLayers){var P=this._zoomBoundLayers[N].options;I=P.minZoom===void 0?I:Math.min(I,P.minZoom),J=P.maxZoom===void 0?J:Math.max(J,P.maxZoom)}this._layersMaxZoom=J===-(1/0)?void 0:J,this._layersMinZoom=I===1/0?void 0:I,K!==this._getZoomSpan()&&this.fire("zoomlevelschange")}}),C.Projection.Mercator={R:6378137,R_MINOR:6356752.314245179,bounds:C.bounds([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(I){var J=Math.PI/180,K=this.R,N=I.lat*J,P=this.R_MINOR/K,Q=Math.sqrt(1-P*P),R=Q*Math.sin(N),T=Math.tan(Math.PI/4-N/2)/Math.pow((1-R)/(1+R),Q/2);return N=-K*Math.log(Math.max(T,1e-10)),new C.Point(I.lng*J*K,N)},unproject:function(I){var J=180/Math.PI,K=this.R,N=this.R_MINOR/K,P=Math.sqrt(1-N*N),Q=Math.exp(-I.y/K),R=Math.PI/2-2*Math.atan(Q);for(var V,T=0,U=0.1;15>T&&1e-7<Math.abs(U);T++)V=P*Math.sin(R),V=Math.pow((1-V)/(1+V),P/2),U=Math.PI/2-2*Math.atan(Q*V)-R,R+=U;return new C.LatLng(R*J,I.x*J/K)}},C.CRS.EPSG3395=C.extend({},C.CRS.Earth,{code:"EPSG:3395",projection:C.Projection.Mercator,transformation:function(){var I=0.5/(Math.PI*C.Projection.Mercator.R);return new C.Transformation(I,0.5,-I,0.5)}()}),C.GridLayer=C.Layer.extend({options:{tileSize:256,opacity:1,updateWhenIdle:C.Browser.mobile,updateWhenZooming:!0,updateInterval:200,attribution:null,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(I){C.setOptions(this,I)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView(),this._update()},beforeAdd:function(I){I._addZoomLimit(this)},onRemove:function(I){this._removeAllTiles(),C.DomUtil.remove(this._container),I._removeZoomLimit(this),this._container=null,this._tileZoom=null},bringToFront:function(){return this._map&&(C.DomUtil.toFront(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(C.DomUtil.toBack(this._container),this._setAutoZIndex(Math.min)),this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(I){return this.options.opacity=I,this._updateOpacity(),this},setZIndex:function(I){return this.options.zIndex=I,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllTiles(),this._update()),this},getEvents:function(){var I={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(!this._onMove&&(this._onMove=C.Util.throttle(this._onMoveEnd,this.options.updateInterval,this)),I.move=this._onMove),this._zoomAnimated&&(I.zoomanim=this._animateZoom),I},createTile:function(){return document.createElement("div")},getTileSize:function(){var I=this.options.tileSize;return I instanceof C.Point?I:new C.Point(I,I)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(I){var J=this.getPane().children,K=-I(-(1/0),1/0);for(var Q,N=0,P=J.length;N<P;N++)Q=J[N].style.zIndex,J[N]!==this._container&&Q&&(K=I(K,+Q));isFinite(K)&&(this.options.zIndex=K+I(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!C.Browser.ielt9){C.DomUtil.setOpacity(this._container,this.options.opacity);var I=+new Date,J=!1,K=!1;for(var N in this._tiles){var P=this._tiles[N];if(P.current&&P.loaded){var Q=Math.min(1,(I-P.loaded)/200);C.DomUtil.setOpacity(P.el,Q),1>Q?J=!0:(P.active&&(K=!0),P.active=!0)}}K&&!this._noPrune&&this._pruneTiles(),J&&(C.Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=C.Util.requestAnimFrame(this._updateOpacity,this))}},_initContainer:function(){this._container||(this._container=C.DomUtil.create("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),1>this.options.opacity&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var I=this._tileZoom,J=this.options.maxZoom;if(void 0===I)return void 0;for(var K in this._levels)this._levels[K].el.children.length||K===I?this._levels[K].el.style.zIndex=J-Math.abs(I-K):(C.DomUtil.remove(this._levels[K].el),this._removeTilesAtZoom(K),delete this._levels[K]);var N=this._levels[I],P=this._map;return N||(N=this._levels[I]={},N.el=C.DomUtil.create("div","leaflet-tile-container leaflet-zoom-animated",this._container),N.el.style.zIndex=J,N.origin=P.project(P.unproject(P.getPixelOrigin()),I).round(),N.zoom=I,this._setZoomTransform(N,P.getCenter(),P.getZoom()),C.Util.falseFn(N.el.offsetWidth)),this._level=N,N},_pruneTiles:function(){if(this._map){var I,J,K=this._map.getZoom();if(K>this.options.maxZoom||K<this.options.minZoom)return void this._removeAllTiles();for(I in this._tiles)J=this._tiles[I],J.retain=J.current;for(I in this._tiles)if(J=this._tiles[I],J.current&&!J.active){var N=J.coords;this._retainParent(N.x,N.y,N.z,N.z-5)||this._retainChildren(N.x,N.y,N.z,N.z+2)}for(I in this._tiles)this._tiles[I].retain||this._removeTile(I)}},_removeTilesAtZoom:function(I){for(var J in this._tiles)this._tiles[J].coords.z===I&&this._removeTile(J)},_removeAllTiles:function(){for(var I in this._tiles)this._removeTile(I)},_invalidateAll:function(){for(var I in this._levels)C.DomUtil.remove(this._levels[I].el),delete this._levels[I];this._removeAllTiles(),this._tileZoom=null},_retainParent:function(I,J,K,N){var P=Math.floor(I/2),Q=Math.floor(J/2),R=K-1,T=new C.Point(+P,+Q);T.z=+R;var U=this._tileCoordsToKey(T),V=this._tiles[U];return V&&V.active?(V.retain=!0,!0):(V&&V.loaded&&(V.retain=!0),!!(R>N)&&this._retainParent(P,Q,R,N))},_retainChildren:function(I,J,K,N){for(var P=2*I;P<2*I+2;P++)for(var Q=2*J;Q<2*J+2;Q++){var R=new C.Point(P,Q);R.z=K+1;var T=this._tileCoordsToKey(R),U=this._tiles[T];if(U&&U.active){U.retain=!0;continue}else U&&U.loaded&&(U.retain=!0);K+1<N&&this._retainChildren(P,Q,K+1,N)}},_resetView:function(I){var J=I&&(I.pinch||I.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),J,J)},_animateZoom:function(I){this._setView(I.center,I.zoom,!0,I.noUpdate)},_setView:function(I,J,K,N){var P=Math.round(J);(this.options.maxZoom!==void 0&&P>this.options.maxZoom||this.options.minZoom!==void 0&&P<this.options.minZoom)&&(P=void 0);var Q=this.options.updateWhenZooming&&P!==this._tileZoom;(!N||Q)&&(this._tileZoom=P,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),P!==void 0&&this._update(I),!K&&this._pruneTiles(),this._noPrune=!!K),this._setZoomTransforms(I,J)},_setZoomTransforms:function(I,J){for(var K in this._levels)this._setZoomTransform(this._levels[K],I,J)},_setZoomTransform:function(I,J,K){var N=this._map.getZoomScale(K,I.zoom),P=I.origin.multiplyBy(N).subtract(this._map._getNewPixelOrigin(J,K)).round();C.Browser.any3d?C.DomUtil.setTransform(I.el,P,N):C.DomUtil.setPosition(I.el,P)},_resetGrid:function(){var I=this._map,J=I.options.crs,K=this._tileSize=this.getTileSize(),N=this._tileZoom,P=this._map.getPixelWorldBounds(this._tileZoom);P&&(this._globalTileRange=this._pxBoundsToTileRange(P)),this._wrapX=J.wrapLng&&!this.options.noWrap&&[Math.floor(I.project([0,J.wrapLng[0]],N).x/K.x),Math.ceil(I.project([0,J.wrapLng[1]],N).x/K.y)],this._wrapY=J.wrapLat&&!this.options.noWrap&&[Math.floor(I.project([J.wrapLat[0],0],N).y/K.x),Math.ceil(I.project([J.wrapLat[1],0],N).y/K.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(I){var J=this._map,K=J._animatingZoom?Math.max(J._animateToZoom,J.getZoom()):J.getZoom(),N=J.getZoomScale(K,this._tileZoom),P=J.project(I,this._tileZoom).floor(),Q=J.getSize().divideBy(2*N);return new C.Bounds(P.subtract(Q),P.add(Q))},_update:function(I){var J=this._map;if(J){var K=J.getZoom();if(void 0===I&&(I=J.getCenter()),void 0!==this._tileZoom){var N=this._getTiledPixelBounds(I),P=this._pxBoundsToTileRange(N),Q=P.getCenter(),R=[],T=this.options.keepBuffer,U=new C.Bounds(P.getBottomLeft().subtract([T,-T]),P.getTopRight().add([T,-T]));for(var V in this._tiles){var W=this._tiles[V].coords;W.z===this._tileZoom&&U.contains(C.point(W.x,W.y))||(this._tiles[V].current=!1)}if(1<Math.abs(K-this._tileZoom))return void this._setView(I,K);for(var X=P.min.y;X<=P.max.y;X++)for(var Y=P.min.x;Y<=P.max.x;Y++){var Z=new C.Point(Y,X);if(Z.z=this._tileZoom,!!this._isValidTile(Z)){var $=this._tiles[this._tileCoordsToKey(Z)];$?$.current=!0:R.push(Z)}}if(R.sort(function(aa,ba){return aa.distanceTo(Q)-ba.distanceTo(Q)}),0!==R.length){this._loading||(this._loading=!0,this.fire("loading"));var _=document.createDocumentFragment();for(Y=0;Y<R.length;Y++)this._addTile(R[Y],_);this._level.el.appendChild(_)}}}},_isValidTile:function(I){var J=this._map.options.crs;if(!J.infinite){var K=this._globalTileRange;if(!J.wrapLng&&(I.x<K.min.x||I.x>K.max.x)||!J.wrapLat&&(I.y<K.min.y||I.y>K.max.y))return!1}if(!this.options.bounds)return!0;var N=this._tileCoordsToBounds(I);return C.latLngBounds(this.options.bounds).overlaps(N)},_keyToBounds:function(I){return this._tileCoordsToBounds(this._keyToTileCoords(I))},_tileCoordsToBounds:function(I){var J=this._map,K=this.getTileSize(),N=I.scaleBy(K),P=N.add(K),Q=J.unproject(N,I.z),R=J.unproject(P,I.z);return this.options.noWrap||(Q=J.wrapLatLng(Q),R=J.wrapLatLng(R)),new C.LatLngBounds(Q,R)},_tileCoordsToKey:function(I){return I.x+":"+I.y+":"+I.z},_keyToTileCoords:function(I){var J=I.split(":"),K=new C.Point(+J[0],+J[1]);return K.z=+J[2],K},_removeTile:function(I){var J=this._tiles[I];J&&(C.DomUtil.remove(J.el),delete this._tiles[I],this.fire("tileunload",{tile:J.el,coords:this._keyToTileCoords(I)}))},_initTile:function(I){C.DomUtil.addClass(I,"leaflet-tile");var J=this.getTileSize();I.style.width=J.x+"px",I.style.height=J.y+"px",I.onselectstart=C.Util.falseFn,I.onmousemove=C.Util.falseFn,C.Browser.ielt9&&1>this.options.opacity&&C.DomUtil.setOpacity(I,this.options.opacity),C.Browser.android&&!C.Browser.android23&&(I.style.WebkitBackfaceVisibility="hidden")},_addTile:function(I,J){var K=this._getTilePos(I),N=this._tileCoordsToKey(I),P=this.createTile(this._wrapCoords(I),C.bind(this._tileReady,this,I));this._initTile(P),2>this.createTile.length&&C.Util.requestAnimFrame(C.bind(this._tileReady,this,I,null,P)),C.DomUtil.setPosition(P,K),this._tiles[N]={el:P,coords:I,current:!0},J.appendChild(P),this.fire("tileloadstart",{tile:P,coords:I})},_tileReady:function(I,J,K){if(this._map){J&&this.fire("tileerror",{error:J,tile:K,coords:I});var N=this._tileCoordsToKey(I);K=this._tiles[N],K&&(K.loaded=+new Date,this._map._fadeAnimated?(C.DomUtil.setOpacity(K.el,0),C.Util.cancelAnimFrame(this._fadeFrame),this._fadeFrame=C.Util.requestAnimFrame(this._updateOpacity,this)):(K.active=!0,this._pruneTiles()),C.DomUtil.addClass(K.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:K.el,coords:I}),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),C.Browser.ielt9||!this._map._fadeAnimated?C.Util.requestAnimFrame(this._pruneTiles,this):setTimeout(C.bind(this._pruneTiles,this),250)))}},_getTilePos:function(I){return I.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(I){var J=new C.Point(this._wrapX?C.Util.wrapNum(I.x,this._wrapX):I.x,this._wrapY?C.Util.wrapNum(I.y,this._wrapY):I.y);return J.z=I.z,J},_pxBoundsToTileRange:function(I){var J=this.getTileSize();return new C.Bounds(I.min.unscaleBy(J).floor(),I.max.unscaleBy(J).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var I in this._tiles)if(!this._tiles[I].loaded)return!1;return!0}}),C.gridLayer=function(I){return new C.GridLayer(I)},C.TileLayer=C.GridLayer.extend({options:{minZoom:0,maxZoom:18,maxNativeZoom:null,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1},initialize:function(I,J){this._url=I,J=C.setOptions(this,J),J.detectRetina&&C.Browser.retina&&0<J.maxZoom&&(J.tileSize=Math.floor(J.tileSize/2),J.zoomReverse?(J.zoomOffset--,J.minZoom++):(J.zoomOffset++,J.maxZoom--),J.minZoom=Math.max(0,J.minZoom)),"string"==typeof J.subdomains&&(J.subdomains=J.subdomains.split("")),C.Browser.android||this.on("tileunload",this._onTileRemove)},setUrl:function(I,J){return this._url=I,J||this.redraw(),this},createTile:function(I,J){var K=document.createElement("img");return C.DomEvent.on(K,"load",C.bind(this._tileOnLoad,this,J,K)),C.DomEvent.on(K,"error",C.bind(this._tileOnError,this,J,K)),this.options.crossOrigin&&(K.crossOrigin=""),K.alt="",K.src=this.getTileUrl(I),K},getTileUrl:function(I){var J={r:C.Browser.retina?"@2x":"",s:this._getSubdomain(I),x:I.x,y:I.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var K=this._globalTileRange.max.y-I.y;this.options.tms&&(J.y=K),J["-y"]=K}return C.Util.template(this._url,C.extend(J,this.options))},_tileOnLoad:function(I,J){C.Browser.ielt9?setTimeout(C.bind(I,this,null,J),0):I(null,J)},_tileOnError:function(I,J,K){var N=this.options.errorTileUrl;N&&(J.src=N),I(K,J)},getTileSize:function(){var I=this._map,J=C.GridLayer.prototype.getTileSize.call(this),K=this._tileZoom+this.options.zoomOffset,N=this.options.maxNativeZoom;return null!==N&&K>N?J.divideBy(I.getZoomScale(N,K)).round():J},_onTileRemove:function(I){I.tile.onload=null},_getZoomForUrl:function(){var I=this.options,J=this._tileZoom;return I.zoomReverse&&(J=I.maxZoom-J),J+=I.zoomOffset,null===I.maxNativeZoom?J:Math.min(J,I.maxNativeZoom)},_getSubdomain:function(I){var J=Math.abs(I.x+I.y)%this.options.subdomains.length;return this.options.subdomains[J]},_abortLoading:function(){var I,J;for(I in this._tiles)this._tiles[I].coords.z!==this._tileZoom&&(J=this._tiles[I].el,J.onload=C.Util.falseFn,J.onerror=C.Util.falseFn,J.complete||(J.src=C.Util.emptyImageUrl,C.DomUtil.remove(J)))}}),C.tileLayer=function(I,J){return new C.TileLayer(I,J)},C.TileLayer.WMS=C.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(I,J){this._url=I;var K=C.extend({},this.defaultWmsParams);for(var N in J)N in this.options||(K[N]=J[N]);J=C.setOptions(this,J),K.width=K.height=J.tileSize*(J.detectRetina&&C.Browser.retina?2:1),this.wmsParams=K},onAdd:function(I){this._crs=this.options.crs||I.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var J=1.3<=this._wmsVersion?"crs":"srs";this.wmsParams[J]=this._crs.code,C.TileLayer.prototype.onAdd.call(this,I)},getTileUrl:function(I){var J=this._tileCoordsToBounds(I),K=this._crs.project(J.getNorthWest()),N=this._crs.project(J.getSouthEast()),P=(1.3<=this._wmsVersion&&this._crs===C.CRS.EPSG4326?[N.y,K.x,K.y,N.x]:[K.x,N.y,N.x,K.y]).join(","),Q=C.TileLayer.prototype.getTileUrl.call(this,I);return Q+C.Util.getParamString(this.wmsParams,Q,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+P},setParams:function(I,J){return C.extend(this.wmsParams,I),J||this.redraw(),this}}),C.tileLayer.wms=function(I,J){return new C.TileLayer.WMS(I,J)},C.ImageOverlay=C.Layer.extend({options:{opacity:1,alt:"",interactive:!1,attribution:null,crossOrigin:!1},initialize:function(I,J,K){this._url=I,this._bounds=C.latLngBounds(J),C.setOptions(this,K)},onAdd:function(){this._image||(this._initImage(),1>this.options.opacity&&this._updateOpacity()),this.options.interactive&&(C.DomUtil.addClass(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){C.DomUtil.remove(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(I){return this.options.opacity=I,this._image&&this._updateOpacity(),this},setStyle:function(I){return I.opacity&&this.setOpacity(I.opacity),this},bringToFront:function(){return this._map&&C.DomUtil.toFront(this._image),this},bringToBack:function(){return this._map&&C.DomUtil.toBack(this._image),this},setUrl:function(I){return this._url=I,this._image&&(this._image.src=I),this},setBounds:function(I){return this._bounds=I,this._map&&this._reset(),this},getAttribution:function(){return this.options.attribution},getEvents:function(){var I={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(I.zoomanim=this._animateZoom),I},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var I=this._image=C.DomUtil.create("img","leaflet-image-layer "+(this._zoomAnimated?"leaflet-zoom-animated":""));I.onselectstart=C.Util.falseFn,I.onmousemove=C.Util.falseFn,I.onload=C.bind(this.fire,this,"load"),this.options.crossOrigin&&(I.crossOrigin=""),I.src=this._url,I.alt=this.options.alt},_animateZoom:function(I){var J=this._map.getZoomScale(I.zoom),K=this._map._latLngToNewLayerPoint(this._bounds.getNorthWest(),I.zoom,I.center);C.DomUtil.setTransform(this._image,K,J)},_reset:function(){var I=this._image,J=new C.Bounds(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),K=J.getSize();C.DomUtil.setPosition(I,J.min),I.style.width=K.x+"px",I.style.height=K.y+"px"},_updateOpacity:function(){C.DomUtil.setOpacity(this._image,this.options.opacity)}}),C.imageOverlay=function(I,J,K){return new C.ImageOverlay(I,J,K)},C.Icon=C.Class.extend({initialize:function(I){C.setOptions(this,I)},createIcon:function(I){return this._createIcon("icon",I)},createShadow:function(I){return this._createIcon("shadow",I)},_createIcon:function(I,J){var K=this._getIconUrl(I);if(!K){if("icon"===I)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var N=this._createImg(K,J&&"IMG"===J.tagName?J:null);return this._setIconStyles(N,I),N},_setIconStyles:function(I,J){var K=this.options,N=K[J+"Size"];"number"==typeof N&&(N=[N,N]);var P=C.point(N),Q=C.point("shadow"===J&&K.shadowAnchor||K.iconAnchor||P&&P.divideBy(2,!0));I.className="leaflet-marker-"+J+" "+(K.className||""),Q&&(I.style.marginLeft=-Q.x+"px",I.style.marginTop=-Q.y+"px"),P&&(I.style.width=P.x+"px",I.style.height=P.y+"px")},_createImg:function(I,J){return J=J||document.createElement("img"),J.src=I,J},_getIconUrl:function(I){return C.Browser.retina&&this.options[I+"RetinaUrl"]||this.options[I+"Url"]}}),C.icon=function(I){return new C.Icon(I)},C.Icon.Default=C.Icon.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(I){return C.Icon.Default.imagePath||(C.Icon.Default.imagePath=this._detectIconPath()),(this.options.imagePath||C.Icon.Default.imagePath)+C.Icon.prototype._getIconUrl.call(this,I)},_detectIconPath:function(){var I=C.DomUtil.create("div","leaflet-default-icon-path",document.body),J=C.DomUtil.getStyle(I,"background-image")||C.DomUtil.getStyle(I,"backgroundImage");return document.body.removeChild(I),0===J.indexOf("url")?J.replace(/^url\([\"\']?/,"").replace(/[\"\']?\)$/,""):""}}),C.Marker=C.Layer.extend({options:{icon:new C.Icon.Default,interactive:!0,draggable:!1,keyboard:!0,title:"",alt:"",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",nonBubblingEvents:["click","dblclick","mouseover","mouseout","contextmenu"]},initialize:function(I,J){C.setOptions(this,J),this._latlng=C.latLng(I)},onAdd:function(I){this._zoomAnimated=this._zoomAnimated&&I.options.markerZoomAnimation,this._zoomAnimated&&I.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(I){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),this._zoomAnimated&&I.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(I){var J=this._latlng;return this._latlng=C.latLng(I),this.update(),this.fire("move",{oldLatLng:J,latlng:this._latlng})},setZIndexOffset:function(I){return this.options.zIndexOffset=I,this.update()},setIcon:function(I){return this.options.icon=I,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon){var I=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(I)}return this},_initIcon:function(){var I=this.options,J="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),K=I.icon.createIcon(this._icon),N=!1;K!==this._icon&&(this._icon&&this._removeIcon(),N=!0,I.title&&(K.title=I.title),I.alt&&(K.alt=I.alt)),C.DomUtil.addClass(K,J),I.keyboard&&(K.tabIndex="0"),this._icon=K,I.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex});var P=I.icon.createShadow(this._shadow),Q=!1;P!==this._shadow&&(this._removeShadow(),Q=!0),P&&C.DomUtil.addClass(P,J),this._shadow=P,1>I.opacity&&this._updateOpacity(),N&&this.getPane().appendChild(this._icon),this._initInteraction(),P&&Q&&this.getPane("shadowPane").appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),C.DomUtil.remove(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&C.DomUtil.remove(this._shadow),this._shadow=null},_setPos:function(I){C.DomUtil.setPosition(this._icon,I),this._shadow&&C.DomUtil.setPosition(this._shadow,I),this._zIndex=I.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(I){this._icon.style.zIndex=this._zIndex+I},_animateZoom:function(I){var J=this._map._latLngToNewLayerPoint(this._latlng,I.zoom,I.center).round();this._setPos(J)},_initInteraction:function(){if(this.options.interactive&&(C.DomUtil.addClass(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),C.Handler.MarkerDrag)){var I=this.options.draggable;this.dragging&&(I=this.dragging.enabled(),this.dragging.disable()),this.dragging=new C.Handler.MarkerDrag(this),I&&this.dragging.enable()}},setOpacity:function(I){return this.options.opacity=I,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var I=this.options.opacity;C.DomUtil.setOpacity(this._icon,I),this._shadow&&C.DomUtil.setOpacity(this._shadow,I)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}}),C.marker=function(I,J){return new C.Marker(I,J)},C.DivIcon=C.Icon.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(I){var J=I&&"DIV"===I.tagName?I:document.createElement("div"),K=this.options;if(J.innerHTML=!1===K.html?"":K.html,K.bgPos){var N=C.point(K.bgPos);J.style.backgroundPosition=-N.x+"px "+-N.y+"px"}return this._setIconStyles(J,"icon"),J},createShadow:function(){return null}}),C.divIcon=function(I){return new C.DivIcon(I)},C.DivOverlay=C.Layer.extend({options:{offset:[0,7],className:"",pane:"popupPane"},initialize:function(I,J){C.setOptions(this,I),this._source=J},onAdd:function(I){this._zoomAnimated=I._zoomAnimated,this._container||this._initLayout(),I._fadeAnimated&&C.DomUtil.setOpacity(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),I._fadeAnimated&&C.DomUtil.setOpacity(this._container,1),this.bringToFront()},onRemove:function(I){I._fadeAnimated?(C.DomUtil.setOpacity(this._container,0),this._removeTimeout=setTimeout(C.bind(C.DomUtil.remove,C.DomUtil,this._container),200)):C.DomUtil.remove(this._container)},getLatLng:function(){return this._latlng},setLatLng:function(I){return this._latlng=C.latLng(I),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(I){return this._content=I,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var I={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(I.zoomanim=this._animateZoom),I},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&C.DomUtil.toFront(this._container),this},bringToBack:function(){return this._map&&C.DomUtil.toBack(this._container),this},_updateContent:function(){if(this._content){var I=this._contentNode,J="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof J)I.innerHTML=J;else{for(;I.hasChildNodes();)I.removeChild(I.firstChild);I.appendChild(J)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var I=this._map.latLngToLayerPoint(this._latlng),J=C.point(this.options.offset),K=this._getAnchor();this._zoomAnimated?C.DomUtil.setPosition(this._container,I.add(K)):J=J.add(I).add(K);var N=this._containerBottom=-J.y,P=this._containerLeft=-Math.round(this._containerWidth/2)+J.x;this._container.style.bottom=N+"px",this._container.style.left=P+"px"}},_getAnchor:function(){return[0,0]}}),C.Popup=C.DivOverlay.extend({options:{maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,className:""},openOn:function(I){return I.openPopup(this),this},onAdd:function(I){C.DivOverlay.prototype.onAdd.call(this,I),I.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),!(this._source instanceof C.Path)&&this._source.on("preclick",C.DomEvent.stopPropagation))},onRemove:function(I){C.DivOverlay.prototype.onRemove.call(this,I),I.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),!(this._source instanceof C.Path)&&this._source.off("preclick",C.DomEvent.stopPropagation))},getEvents:function(){var I=C.DivOverlay.prototype.getEvents.call(this);return("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(I.preclick=this._close),this.options.keepInView&&(I.moveend=this._adjustPan),I},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var I="leaflet-popup",J=this._container=C.DomUtil.create("div",I+" "+(this.options.className||"")+" leaflet-zoom-animated");if(this.options.closeButton){var K=this._closeButton=C.DomUtil.create("a",I+"-close-button",J);K.href="#close",K.innerHTML="&#215;",C.DomEvent.on(K,"click",this._onCloseButtonClick,this)}var N=this._wrapper=C.DomUtil.create("div",I+"-content-wrapper",J);this._contentNode=C.DomUtil.create("div",I+"-content",N),C.DomEvent.disableClickPropagation(N).disableScrollPropagation(this._contentNode).on(N,"contextmenu",C.DomEvent.stopPropagation),this._tipContainer=C.DomUtil.create("div",I+"-tip-container",J),this._tip=C.DomUtil.create("div",I+"-tip",this._tipContainer)},_updateLayout:function(){var I=this._contentNode,J=I.style;J.width="",J.whiteSpace="nowrap";var K=I.offsetWidth;K=Math.min(K,this.options.maxWidth),K=Math.max(K,this.options.minWidth),J.width=K+1+"px",J.whiteSpace="",J.height="";var N=I.offsetHeight,P=this.options.maxHeight,Q="leaflet-popup-scrolled";P&&N>P?(J.height=P+"px",C.DomUtil.addClass(I,Q)):C.DomUtil.removeClass(I,Q),this._containerWidth=this._container.offsetWidth},_animateZoom:function(I){var J=this._map._latLngToNewLayerPoint(this._latlng,I.zoom,I.center),K=this._getAnchor();C.DomUtil.setPosition(this._container,J.add(K))},_adjustPan:function(){if(!(!this.options.autoPan||this._map._panAnim&&this._map._panAnim._inProgress)){var I=this._map,J=parseInt(C.DomUtil.getStyle(this._container,"marginBottom"),10)||0,K=this._container.offsetHeight+J,N=this._containerWidth,P=new C.Point(this._containerLeft,-K-this._containerBottom);P._add(C.DomUtil.getPosition(this._container));var Q=I.layerPointToContainerPoint(P),R=C.point(this.options.autoPanPadding),T=C.point(this.options.autoPanPaddingTopLeft||R),U=C.point(this.options.autoPanPaddingBottomRight||R),V=I.getSize(),W=0,X=0;Q.x+N+U.x>V.x&&(W=Q.x+N-V.x+U.x),0>Q.x-W-T.x&&(W=Q.x-T.x),Q.y+K+U.y>V.y&&(X=Q.y+K-V.y+U.y),0>Q.y-X-T.y&&(X=Q.y-T.y),(W||X)&&I.fire("autopanstart").panBy([W,X])}},_onCloseButtonClick:function(I){this._close(),C.DomEvent.stop(I)},_getAnchor:function(){return C.point(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),C.popup=function(I,J){return new C.Popup(I,J)},C.Map.mergeOptions({closePopupOnClick:!0}),C.Map.include({openPopup:function(I,J,K){return(I instanceof C.Popup||(I=new C.Popup(K).setContent(I)),J&&I.setLatLng(J),this.hasLayer(I))?this:(this._popup&&this._popup.options.autoClose&&this.closePopup(),this._popup=I,this.addLayer(I))},closePopup:function(I){return I&&I!==this._popup||(I=this._popup,this._popup=null),I&&this.removeLayer(I),this}}),C.Layer.include({bindPopup:function(I,J){return I instanceof C.Popup?(C.setOptions(I,J),this._popup=I,I._source=this):((!this._popup||J)&&(this._popup=new C.Popup(J,this)),this._popup.setContent(I)),this._popupHandlersAdded||(this.on({click:this._openPopup,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(I,J){if(I instanceof C.Layer||(J=I,I=this),I instanceof C.FeatureGroup)for(var K in this._layers){I=this._layers[K];break}return J||(J=I.getCenter?I.getCenter():I.getLatLng()),this._popup&&this._map&&(this._popup._source=I,this._popup.update(),this._map.openPopup(this._popup,J)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(I){return this._popup&&(this._popup._map?this.closePopup():this.openPopup(I)),this},isPopupOpen:function(){return this._popup.isOpen()},setPopupContent:function(I){return this._popup&&this._popup.setContent(I),this},getPopup:function(){return this._popup},_openPopup:function(I){var J=I.layer||I.target;if(this._popup)return this._map?(C.DomEvent.stop(I),J instanceof C.Path?void this.openPopup(I.layer||I.target,I.latlng):void(this._map.hasLayer(this._popup)&&this._popup._source===J?this.closePopup():this.openPopup(J,I.latlng))):void 0},_movePopup:function(I){this._popup.setLatLng(I.latlng)}}),C.Marker.include({_getPopupAnchor:function(){return this.options.icon.options.popupAnchor||[0,0]}}),C.Tooltip=C.DivOverlay.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,interactive:!1,opacity:0.9},onAdd:function(I){C.DivOverlay.prototype.onAdd.call(this,I),this.setOpacity(this.options.opacity),I.fire("tooltipopen",{tooltip:this}),this._source&&this._source.fire("tooltipopen",{tooltip:this},!0)},onRemove:function(I){C.DivOverlay.prototype.onRemove.call(this,I),I.fire("tooltipclose",{tooltip:this}),this._source&&this._source.fire("tooltipclose",{tooltip:this},!0)},getEvents:function(){var I=C.DivOverlay.prototype.getEvents.call(this);return C.Browser.touch&&!this.options.permanent&&(I.preclick=this._close),I},_close:function(){this._map&&this._map.closeTooltip(this)},_initLayout:function(){var I="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=C.DomUtil.create("div",I)},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(I){var J=this._map,K=this._container,N=J.latLngToContainerPoint(J.getCenter()),P=J.layerPointToContainerPoint(I),Q=this.options.direction,R=K.offsetWidth,T=K.offsetHeight,U=C.point(this.options.offset),V=this._getAnchor();"top"===Q?I=I.add(C.point(-R/2+U.x,-T+U.y+V.y)):"bottom"===Q?I=I.subtract(C.point(R/2-U.x,-U.y)):"center"===Q?I=I.subtract(C.point(R/2+U.x,T/2-V.y+U.y)):"right"===Q||"auto"===Q&&P.x<N.x?(Q="right",I=I.add([U.x+V.x,V.y-T/2+U.y])):(Q="left",I=I.subtract(C.point(R+V.x-U.x,T/2-V.y-U.y))),C.DomUtil.removeClass(K,"leaflet-tooltip-right"),C.DomUtil.removeClass(K,"leaflet-tooltip-left"),C.DomUtil.removeClass(K,"leaflet-tooltip-top"),C.DomUtil.removeClass(K,"leaflet-tooltip-bottom"),C.DomUtil.addClass(K,"leaflet-tooltip-"+Q),C.DomUtil.setPosition(K,I)},_updatePosition:function(){var I=this._map.latLngToLayerPoint(this._latlng);this._setPosition(I)},setOpacity:function(I){this.options.opacity=I,this._container&&C.DomUtil.setOpacity(this._container,I)},_animateZoom:function(I){var J=this._map._latLngToNewLayerPoint(this._latlng,I.zoom,I.center);this._setPosition(J)},_getAnchor:function(){return C.point(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),C.tooltip=function(I,J){return new C.Tooltip(I,J)},C.Map.include({openTooltip:function(I,J,K){return I instanceof C.Tooltip||(I=new C.Tooltip(K).setContent(I)),J&&I.setLatLng(J),this.hasLayer(I)?this:this.addLayer(I)},closeTooltip:function(I){return I&&this.removeLayer(I),this}}),C.Layer.include({bindTooltip:function(I,J){return I instanceof C.Tooltip?(C.setOptions(I,J),this._tooltip=I,I._source=this):((!this._tooltip||J)&&(this._tooltip=C.tooltip(J,this)),this._tooltip.setContent(I)),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(I){if(I||!this._tooltipHandlersAdded){var J=I?"off":"on",K={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?K.add=this._openTooltip:(K.mouseover=this._openTooltip,K.mouseout=this.closeTooltip,this._tooltip.options.sticky&&(K.mousemove=this._moveTooltip),C.Browser.touch&&(K.click=this._openTooltip)),this[J](K),this._tooltipHandlersAdded=!I}},openTooltip:function(I,J){if(I instanceof C.Layer||(J=I,I=this),I instanceof C.FeatureGroup)for(var K in this._layers){I=this._layers[K];break}return J||(J=I.getCenter?I.getCenter():I.getLatLng()),this._tooltip&&this._map&&(this._tooltip._source=I,this._tooltip.update(),this._map.openTooltip(this._tooltip,J),this._tooltip.options.interactive&&this._tooltip._container&&(C.DomUtil.addClass(this._tooltip._container,"leaflet-clickable"),this.addInteractiveTarget(this._tooltip._container))),this},closeTooltip:function(){return this._tooltip&&(this._tooltip._close(),this._tooltip.options.interactive&&this._tooltip._container&&(C.DomUtil.removeClass(this._tooltip._container,"leaflet-clickable"),this.removeInteractiveTarget(this._tooltip._container))),this},toggleTooltip:function(I){return this._tooltip&&(this._tooltip._map?this.closeTooltip():this.openTooltip(I)),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(I){return this._tooltip&&this._tooltip.setContent(I),this},getTooltip:function(){return this._tooltip},_openTooltip:function(I){var J=I.layer||I.target;this._tooltip&&this._map&&this.openTooltip(J,this._tooltip.options.sticky?I.latlng:void 0)},_moveTooltip:function(I){var K,N,J=I.latlng;this._tooltip.options.sticky&&I.originalEvent&&(K=this._map.mouseEventToContainerPoint(I.originalEvent),N=this._map.containerPointToLayerPoint(K),J=this._map.layerPointToLatLng(N)),this._tooltip.setLatLng(J)}}),C.Marker.include({_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor||[0,0]}}),C.LayerGroup=C.Layer.extend({initialize:function(I){this._layers={};var J,K;if(I)for(J=0,K=I.length;J<K;J++)this.addLayer(I[J])},addLayer:function(I){var J=this.getLayerId(I);return this._layers[J]=I,this._map&&this._map.addLayer(I),this},removeLayer:function(I){var J=I in this._layers?I:this.getLayerId(I);return this._map&&this._layers[J]&&this._map.removeLayer(this._layers[J]),delete this._layers[J],this},hasLayer:function(I){return!!I&&(I in this._layers||this.getLayerId(I)in this._layers)},clearLayers:function(){for(var I in this._layers)this.removeLayer(this._layers[I]);return this},invoke:function(I){var K,N,J=Array.prototype.slice.call(arguments,1);for(K in this._layers)N=this._layers[K],N[I]&&N[I].apply(N,J);return this},onAdd:function(I){for(var J in this._layers)I.addLayer(this._layers[J])},onRemove:function(I){for(var J in this._layers)I.removeLayer(this._layers[J])},eachLayer:function(I,J){for(var K in this._layers)I.call(J,this._layers[K]);return this},getLayer:function(I){return this._layers[I]},getLayers:function(){var I=[];for(var J in this._layers)I.push(this._layers[J]);return I},setZIndex:function(I){return this.invoke("setZIndex",I)},getLayerId:function(I){return C.stamp(I)}}),C.layerGroup=function(I){return new C.LayerGroup(I)},C.FeatureGroup=C.LayerGroup.extend({addLayer:function(I){return this.hasLayer(I)?this:(I.addEventParent(this),C.LayerGroup.prototype.addLayer.call(this,I),this.fire("layeradd",{layer:I}))},removeLayer:function(I){return this.hasLayer(I)?(I in this._layers&&(I=this._layers[I]),I.removeEventParent(this),C.LayerGroup.prototype.removeLayer.call(this,I),this.fire("layerremove",{layer:I})):this},setStyle:function(I){return this.invoke("setStyle",I)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var I=new C.LatLngBounds;for(var J in this._layers){var K=this._layers[J];I.extend(K.getBounds?K.getBounds():K.getLatLng())}return I}}),C.featureGroup=function(I){return new C.FeatureGroup(I)},C.Renderer=C.Layer.extend({options:{padding:0.1},initialize:function(I){C.setOptions(this,I),C.stamp(this)},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&C.DomUtil.addClass(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update()},onRemove:function(){C.DomUtil.remove(this._container)},getEvents:function(){var I={viewreset:this._reset,zoom:this._onZoom,moveend:this._update};return this._zoomAnimated&&(I.zoomanim=this._onAnimZoom),I},_onAnimZoom:function(I){this._updateTransform(I.center,I.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(I,J){var K=this._map.getZoomScale(J,this._zoom),N=C.DomUtil.getPosition(this._container),P=this._map.getSize().multiplyBy(0.5+this.options.padding),Q=this._map.project(this._center,J),R=this._map.project(I,J),T=R.subtract(Q),U=P.multiplyBy(-K).add(N).add(P).subtract(T);C.Browser.any3d?C.DomUtil.setTransform(this._container,U,K):C.DomUtil.setPosition(this._container,U)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom)},_update:function(){var I=this.options.padding,J=this._map.getSize(),K=this._map.containerPointToLayerPoint(J.multiplyBy(-I)).round();this._bounds=new C.Bounds(K,K.add(J.multiplyBy(1+2*I)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),C.Map.include({getRenderer:function(I){var J=I.options.renderer||this._getPaneRenderer(I.options.pane)||this.options.renderer||this._renderer;return J||(J=this._renderer=this.options.preferCanvas&&C.canvas()||C.svg()),this.hasLayer(J)||this.addLayer(J),J},_getPaneRenderer:function(I){if("overlayPane"===I||void 0===I)return!1;var J=this._paneRenderers[I];return void 0===J&&(J=C.SVG&&C.svg({pane:I})||C.Canvas&&C.canvas({pane:I}),this._paneRenderers[I]=J),J}}),C.Path=C.Layer.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:0.2,fillRule:"evenodd",interactive:!0},beforeAdd:function(I){this._renderer=I.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this),this._renderer.on("update",this._update,this)},onRemove:function(){this._renderer._removePath(this),this._renderer.off("update",this._update,this)},getEvents:function(){return{zoomend:this._project,viewreset:this._reset}},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(I){return C.setOptions(this,I),this._renderer&&this._renderer._updateStyle(this),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(C.Browser.touch?10:0)}}),C.LineUtil={simplify:function(I,J){if(!J||!I.length)return I.slice();var K=J*J;return I=this._reducePoints(I,K),I=this._simplifyDP(I,K),I},pointToSegmentDistance:function(I,J,K){return Math.sqrt(this._sqClosestPointOnSegment(I,J,K,!0))},closestPointOnSegment:function(I,J,K){return this._sqClosestPointOnSegment(I,J,K)},_simplifyDP:function(I,J){var K=I.length,N=typeof Uint8Array==void 0+""?Array:Uint8Array,P=new N(K);P[0]=P[K-1]=1,this._simplifyDPStep(I,P,J,0,K-1);var Q,R=[];for(Q=0;Q<K;Q++)P[Q]&&R.push(I[Q]);return R},_simplifyDPStep:function(I,J,K,N,P){var R,T,U,Q=0;for(T=N+1;T<=P-1;T++)U=this._sqClosestPointOnSegment(I[T],I[N],I[P],!0),U>Q&&(R=T,Q=U);Q>K&&(J[R]=1,this._simplifyDPStep(I,J,K,N,R),this._simplifyDPStep(I,J,K,R,P))},_reducePoints:function(I,J){var K=[I[0]];for(var N=1,P=0,Q=I.length;N<Q;N++)this._sqDist(I[N],I[P])>J&&(K.push(I[N]),P=N);return P<Q-1&&K.push(I[Q-1]),K},clipSegment:function(I,J,K,N,P){var T,U,V,Q=N?this._lastCode:this._getBitCode(I,K),R=this._getBitCode(J,K);for(this._lastCode=R;!0;){if(!(Q|R))return[I,J];if(Q&R)return!1;T=Q||R,U=this._getEdgeIntersection(I,J,T,K,P),V=this._getBitCode(U,K),T===Q?(I=U,Q=V):(J=U,R=V)}},_getEdgeIntersection:function(I,J,K,N,P){var V,W,Q=J.x-I.x,R=J.y-I.y,T=N.min,U=N.max;return 8&K?(V=I.x+Q*(U.y-I.y)/R,W=U.y):4&K?(V=I.x+Q*(T.y-I.y)/R,W=T.y):2&K?(V=U.x,W=I.y+R*(U.x-I.x)/Q):1&K&&(V=T.x,W=I.y+R*(T.x-I.x)/Q),new C.Point(V,W,P)},_getBitCode:function(I,J){var K=0;return I.x<J.min.x?K|=1:I.x>J.max.x&&(K|=2),I.y<J.min.y?K|=4:I.y>J.max.y&&(K|=8),K},_sqDist:function(I,J){var K=J.x-I.x,N=J.y-I.y;return K*K+N*N},_sqClosestPointOnSegment:function(I,J,K,N){var V,P=J.x,Q=J.y,R=K.x-P,T=K.y-Q,U=R*R+T*T;return 0<U&&(V=((I.x-P)*R+(I.y-Q)*T)/U,1<V?(P=K.x,Q=K.y):0<V&&(P+=R*V,Q+=T*V)),R=I.x-P,T=I.y-Q,N?R*R+T*T:new C.Point(P,Q)}},C.Polyline=C.Path.extend({options:{smoothFactor:1,noClip:!1},initialize:function(I,J){C.setOptions(this,J),this._setLatLngs(I)},getLatLngs:function(){return this._latlngs},setLatLngs:function(I){return this._setLatLngs(I),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(I){var P,Q,J=1/0,K=null,N=C.LineUtil._sqClosestPointOnSegment;for(var R=0,T=this._parts.length;R<T;R++){var U=this._parts[R];for(var V=1,W=U.length;V<W;V++){P=U[V-1],Q=U[V];var X=N(I,P,Q,!0);X<J&&(J=X,K=N(I,P,Q))}}return K&&(K.distance=Math.sqrt(J)),K},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var I,J,K,N,P,Q,R,T=this._rings[0],U=T.length;if(!U)return null;for(I=0,J=0;I<U-1;I++)J+=T[I].distanceTo(T[I+1])/2;if(0===J)return this._map.layerPointToLatLng(T[0]);for(I=0,N=0;I<U-1;I++)if(P=T[I],Q=T[I+1],K=P.distanceTo(Q),N+=K,N>J)return R=(N-J)/K,this._map.layerPointToLatLng([Q.x-R*(Q.x-P.x),Q.y-R*(Q.y-P.y)])},getBounds:function(){return this._bounds},addLatLng:function(I,J){return J=J||this._defaultShape(),I=C.latLng(I),J.push(I),this._bounds.extend(I),this.redraw()},_setLatLngs:function(I){this._bounds=new C.LatLngBounds,this._latlngs=this._convertLatLngs(I)},_defaultShape:function(){return C.Polyline._flat(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(I){var J=[],K=C.Polyline._flat(I);for(var N=0,P=I.length;N<P;N++)K?(J[N]=C.latLng(I[N]),this._bounds.extend(J[N])):J[N]=this._convertLatLngs(I[N]);return J},_project:function(){var I=new C.Bounds;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,I);var J=this._clickTolerance(),K=new C.Point(J,J);this._bounds.isValid()&&I.isValid()&&(I.min._subtract(K),I.max._add(K),this._pxBounds=I)},_projectLatlngs:function(I,J,K){var Q,R,N=I[0]instanceof C.LatLng,P=I.length;if(N){for(R=[],Q=0;Q<P;Q++)R[Q]=this._map.latLngToLayerPoint(I[Q]),K.extend(R[Q]);J.push(R)}else for(Q=0;Q<P;Q++)this._projectLatlngs(I[Q],J,K)},_clipPoints:function(){var I=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(I)){if(this.options.noClip)return void(this._parts=this._rings);var K,N,P,Q,R,T,U,J=this._parts;for(K=0,P=0,Q=this._rings.length;K<Q;K++)for(U=this._rings[K],N=0,R=U.length;N<R-1;N++)(T=C.LineUtil.clipSegment(U[N],U[N+1],I,N,!0),!!T)&&(J[P]=J[P]||[],J[P].push(T[0]),(T[1]!==U[N+1]||N===R-2)&&(J[P].push(T[1]),P++))}},_simplifyPoints:function(){var I=this._parts,J=this.options.smoothFactor;for(var K=0,N=I.length;K<N;K++)I[K]=C.LineUtil.simplify(I[K],J)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)}}),C.polyline=function(I,J){return new C.Polyline(I,J)},C.Polyline._flat=function(I){return!C.Util.isArray(I[0])||"object"!=typeof I[0][0]&&"undefined"!=typeof I[0][0]},C.PolyUtil={},C.PolyUtil.clipPolygon=function(I,J,K){var N,Q,R,T,U,V,W,X,Y,P=[1,4,2,8],Z=C.LineUtil;for(Q=0,W=I.length;Q<W;Q++)I[Q]._code=Z._getBitCode(I[Q],J);for(T=0;4>T;T++){for(X=P[T],N=[],(Q=0,W=I.length,R=W-1);Q<W;R=Q++)U=I[Q],V=I[R],U._code&X?!(V._code&X)&&(Y=Z._getEdgeIntersection(V,U,X,J,K),Y._code=Z._getBitCode(Y,J),N.push(Y)):(V._code&X&&(Y=Z._getEdgeIntersection(V,U,X,J,K),Y._code=Z._getBitCode(Y,J),N.push(Y)),N.push(U));I=N}return I},C.Polygon=C.Polyline.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var I,J,K,N,P,Q,R,T,U,V=this._rings[0],W=V.length;if(!W)return null;for(Q=R=T=0,I=0,J=W-1;I<W;J=I++)K=V[I],N=V[J],P=K.y*N.x-N.y*K.x,R+=(K.x+N.x)*P,T+=(K.y+N.y)*P,Q+=3*P;return U=0===Q?V[0]:[R/Q,T/Q],this._map.layerPointToLatLng(U)},_convertLatLngs:function(I){var J=C.Polyline.prototype._convertLatLngs.call(this,I),K=J.length;return 2<=K&&J[0]instanceof C.LatLng&&J[0].equals(J[K-1])&&J.pop(),J},_setLatLngs:function(I){C.Polyline.prototype._setLatLngs.call(this,I),C.Polyline._flat(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return C.Polyline._flat(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var I=this._renderer._bounds,J=this.options.weight,K=new C.Point(J,J);if(I=new C.Bounds(I.min.subtract(K),I.max.add(K)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(I)){if(this.options.noClip)return void(this._parts=this._rings);for(var Q,N=0,P=this._rings.length;N<P;N++)Q=C.PolyUtil.clipPolygon(this._rings[N],I,!0),Q.length&&this._parts.push(Q)}},_updatePath:function(){this._renderer._updatePoly(this,!0)}}),C.polygon=function(I,J){return new C.Polygon(I,J)},C.Rectangle=C.Polygon.extend({initialize:function(I,J){C.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(I),J)},setBounds:function(I){return this.setLatLngs(this._boundsToLatLngs(I))},_boundsToLatLngs:function(I){return I=C.latLngBounds(I),[I.getSouthWest(),I.getNorthWest(),I.getNorthEast(),I.getSouthEast()]}}),C.rectangle=function(I,J){return new C.Rectangle(I,J)},C.CircleMarker=C.Path.extend({options:{fill:!0,radius:10},initialize:function(I,J){C.setOptions(this,J),this._latlng=C.latLng(I),this._radius=this.options.radius},setLatLng:function(I){return this._latlng=C.latLng(I),this.redraw(),this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(I){return this.options.radius=this._radius=I,this.redraw()},getRadius:function(){return this._radius},setStyle:function(I){var J=I&&I.radius||this._radius;return C.Path.prototype.setStyle.call(this,I),this.setRadius(J),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var I=this._radius,J=this._radiusY||I,K=this._clickTolerance(),N=[I+K,J+K];this._pxBounds=new C.Bounds(this._point.subtract(N),this._point.add(N))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)}}),C.circleMarker=function(I,J){return new C.CircleMarker(I,J)},C.Circle=C.CircleMarker.extend({initialize:function(I,J,K){if("number"==typeof J&&(J=C.extend({},K,{radius:J})),C.setOptions(this,J),this._latlng=C.latLng(I),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(I){return this._mRadius=I,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var I=[this._radius,this._radiusY||this._radius];return new C.LatLngBounds(this._map.layerPointToLatLng(this._point.subtract(I)),this._map.layerPointToLatLng(this._point.add(I)))},setStyle:C.Path.prototype.setStyle,_project:function(){var I=this._latlng.lng,J=this._latlng.lat,K=this._map,N=K.options.crs;if(N.distance===C.CRS.Earth.distance){var P=Math.PI/180,Q=this._mRadius/C.CRS.Earth.R/P,R=K.project([J+Q,I]),T=K.project([J-Q,I]),U=R.add(T).divideBy(2),V=K.unproject(U).lat,W=Math.acos((Math.cos(Q*P)-Math.sin(J*P)*Math.sin(V*P))/(Math.cos(J*P)*Math.cos(V*P)))/P;(isNaN(W)||0==W)&&(W=Q/Math.cos(Math.PI/180*J)),this._point=U.subtract(K.getPixelOrigin()),this._radius=isNaN(W)?0:Math.max(Math.round(U.x-K.project([V,I-W]).x),1),this._radiusY=Math.max(Math.round(U.y-R.y),1)}else{var X=N.unproject(N.project(this._latlng).subtract([this._mRadius,0]));this._point=K.latLngToLayerPoint(this._latlng),this._radius=this._point.x-K.latLngToLayerPoint(X).x}this._updateBounds()}}),C.circle=function(I,J,K){return new C.Circle(I,J,K)},C.SVG=C.Renderer.extend({getEvents:function(){var I=C.Renderer.prototype.getEvents.call(this);return I.zoomstart=this._onZoomStart,I},_initContainer:function(){this._container=C.SVG.create("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=C.SVG.create("g"),this._container.appendChild(this._rootGroup)},_onZoomStart:function(){this._update()},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){C.Renderer.prototype._update.call(this);var I=this._bounds,J=I.getSize(),K=this._container;this._svgSize&&this._svgSize.equals(J)||(this._svgSize=J,K.setAttribute("width",J.x),K.setAttribute("height",J.y)),C.DomUtil.setPosition(K,I.min),K.setAttribute("viewBox",[I.min.x,I.min.y,J.x,J.y].join(" ")),this.fire("update")}},_initPath:function(I){var J=I._path=C.SVG.create("path");I.options.className&&C.DomUtil.addClass(J,I.options.className),I.options.interactive&&C.DomUtil.addClass(J,"leaflet-interactive"),this._updateStyle(I)},_addPath:function(I){this._rootGroup.appendChild(I._path),I.addInteractiveTarget(I._path)},_removePath:function(I){C.DomUtil.remove(I._path),I.removeInteractiveTarget(I._path)},_updatePath:function(I){I._project(),I._update()},_updateStyle:function(I){var J=I._path,K=I.options;J&&(K.stroke?(J.setAttribute("stroke",K.color),J.setAttribute("stroke-opacity",K.opacity),J.setAttribute("stroke-width",K.weight),J.setAttribute("stroke-linecap",K.lineCap),J.setAttribute("stroke-linejoin",K.lineJoin),K.dashArray?J.setAttribute("stroke-dasharray",K.dashArray):J.removeAttribute("stroke-dasharray"),K.dashOffset?J.setAttribute("stroke-dashoffset",K.dashOffset):J.removeAttribute("stroke-dashoffset")):J.setAttribute("stroke","none"),K.fill?(J.setAttribute("fill",K.fillColor||K.color),J.setAttribute("fill-opacity",K.fillOpacity),J.setAttribute("fill-rule",K.fillRule||"evenodd")):J.setAttribute("fill","none"))},_updatePoly:function(I,J){this._setPath(I,C.SVG.pointsToPath(I._parts,J))},_updateCircle:function(I){var J=I._point,K=I._radius,N=I._radiusY||K,P="a"+K+","+N+" 0 1,0 ",Q=I._empty()?"M0 0":"M"+(J.x-K)+","+J.y+P+2*K+",0 "+P+2*-K+",0 ";this._setPath(I,Q)},_setPath:function(I,J){I._path.setAttribute("d",J)},_bringToFront:function(I){C.DomUtil.toFront(I._path)},_bringToBack:function(I){C.DomUtil.toBack(I._path)}}),C.extend(C.SVG,{create:function(I){return document.createElementNS("http://www.w3.org/2000/svg",I)},pointsToPath:function(I,J){var N,P,Q,R,T,U,K="";for(N=0,Q=I.length;N<Q;N++){for(T=I[N],P=0,R=T.length;P<R;P++)U=T[P],K+=(P?"L":"M")+U.x+" "+U.y;K+=J?C.Browser.svg?"z":"x":""}return K||"M0 0"}}),C.Browser.svg=!!(document.createElementNS&&C.SVG.create("svg").createSVGRect),C.svg=function(I){return C.Browser.svg||C.Browser.vml?new C.SVG(I):null},C.Browser.vml=!C.Browser.svg&&function(){try{var I=document.createElement("div");I.innerHTML="<v:shape adj=\"1\"/>";var J=I.firstChild;return J.style.behavior="url(#default#VML)",J&&"object"==typeof J.adj}catch(K){return!1}}(),C.SVG.include(C.Browser.vml?{_initContainer:function(){this._container=C.DomUtil.create("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||C.Renderer.prototype._update.call(this)},_initPath:function(I){var J=I._container=C.SVG.create("shape");C.DomUtil.addClass(J,"leaflet-vml-shape "+(this.options.className||"")),J.coordsize="1 1",I._path=C.SVG.create("path"),J.appendChild(I._path),this._updateStyle(I)},_addPath:function(I){var J=I._container;this._container.appendChild(J),I.options.interactive&&I.addInteractiveTarget(J)},_removePath:function(I){var J=I._container;C.DomUtil.remove(J),I.removeInteractiveTarget(J)},_updateStyle:function(I){var J=I._stroke,K=I._fill,N=I.options,P=I._container;P.stroked=!!N.stroke,P.filled=!!N.fill,N.stroke?(!J&&(J=I._stroke=C.SVG.create("stroke")),P.appendChild(J),J.weight=N.weight+"px",J.color=N.color,J.opacity=N.opacity,J.dashStyle=N.dashArray?C.Util.isArray(N.dashArray)?N.dashArray.join(" "):N.dashArray.replace(/( *, *)/g," "):"",J.endcap=N.lineCap.replace("butt","flat"),J.joinstyle=N.lineJoin):J&&(P.removeChild(J),I._stroke=null),N.fill?(!K&&(K=I._fill=C.SVG.create("fill")),P.appendChild(K),K.color=N.fillColor||N.color,K.opacity=N.fillOpacity):K&&(P.removeChild(K),I._fill=null)},_updateCircle:function(I){var J=I._point.round(),K=Math.round(I._radius),N=Math.round(I._radiusY||K);this._setPath(I,I._empty()?"M0 0":"AL "+J.x+","+J.y+" "+K+","+N+" 0,"+23592600)},_setPath:function(I,J){I._path.v=J},_bringToFront:function(I){C.DomUtil.toFront(I._container)},_bringToBack:function(I){C.DomUtil.toBack(I._container)}}:{}),C.Browser.vml&&(C.SVG.create=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(I){return document.createElement("<lvml:"+I+" class=\"lvml\">")}}catch(I){return function(J){return document.createElement("<"+J+" xmlns=\"urn:schemas-microsoft.com:vml\" class=\"lvml\">")}}}()),C.Canvas=C.Renderer.extend({onAdd:function(){C.Renderer.prototype.onAdd.call(this),this._layers=this._layers||{},this._draw()},_initContainer:function(){var I=this._container=document.createElement("canvas");C.DomEvent.on(I,"mousemove",C.Util.throttle(this._onMouseMove,32,this),this).on(I,"click dblclick mousedown mouseup contextmenu",this._onClick,this).on(I,"mouseout",this._handleMouseOut,this),this._ctx=I.getContext("2d")},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){this._drawnLayers={},C.Renderer.prototype._update.call(this);var I=this._bounds,J=this._container,K=I.getSize(),N=C.Browser.retina?2:1;C.DomUtil.setPosition(J,I.min),J.width=N*K.x,J.height=N*K.y,J.style.width=K.x+"px",J.style.height=K.y+"px",C.Browser.retina&&this._ctx.scale(2,2),this._ctx.translate(-I.min.x,-I.min.y),this.fire("update")}},_initPath:function(I){this._updateDashArray(I),this._layers[C.stamp(I)]=I},_addPath:C.Util.falseFn,_removePath:function(I){I._removed=!0,this._requestRedraw(I)},_updatePath:function(I){this._redrawBounds=I._pxBounds,this._draw(!0),I._project(),I._update(),this._draw(),this._redrawBounds=null},_updateStyle:function(I){this._updateDashArray(I),this._requestRedraw(I)},_updateDashArray:function(I){if(I.options.dashArray){var N,J=I.options.dashArray.split(","),K=[];for(N=0;N<J.length;N++)K.push(+J[N]);I.options._dashArray=K}},_requestRedraw:function(I){if(this._map){var J=(I.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new C.Bounds,this._redrawBounds.extend(I._pxBounds.min.subtract([J,J])),this._redrawBounds.extend(I._pxBounds.max.add([J,J])),this._redrawRequest=this._redrawRequest||C.Util.requestAnimFrame(this._redraw,this)}},_redraw:function(){this._redrawRequest=null,this._draw(!0),this._draw(),this._redrawBounds=null},_draw:function(I){this._clear=I;var J,K=this._redrawBounds;for(var N in this._ctx.save(),K&&(this._ctx.beginPath(),this._ctx.rect(K.min.x,K.min.y,K.max.x-K.min.x,K.max.y-K.min.y),this._ctx.clip()),this._layers)J=this._layers[N],(!K||J._pxBounds&&J._pxBounds.intersects(K))&&J._updatePath(),I&&J._removed&&(delete J._removed,delete this._layers[N]);this._ctx.restore()},_updatePoly:function(I,J){var K,N,P,Q,R=I._parts,T=R.length,U=this._ctx;if(T){for(this._drawnLayers[I._leaflet_id]=I,U.beginPath(),U.setLineDash&&U.setLineDash(I.options&&I.options._dashArray||[]),K=0;K<T;K++){for(N=0,P=R[K].length;N<P;N++)Q=R[K][N],U[N?"lineTo":"moveTo"](Q.x,Q.y);J&&U.closePath()}this._fillStroke(U,I)}},_updateCircle:function(I){if(!I._empty()){var J=I._point,K=this._ctx,N=I._radius,P=(I._radiusY||N)/N;this._drawnLayers[I._leaflet_id]=I,1!=P&&(K.save(),K.scale(1,P)),K.beginPath(),K.arc(J.x,J.y/P,N,0,2*Math.PI,!1),1!=P&&K.restore(),this._fillStroke(K,I)}},_fillStroke:function(I,J){var K=this._clear,N=J.options;I.globalCompositeOperation=K?"destination-out":"source-over",N.fill&&(I.globalAlpha=K?1:N.fillOpacity,I.fillStyle=N.fillColor||N.color,I.fill(N.fillRule||"evenodd")),N.stroke&&0!==N.weight&&(I.globalAlpha=K?1:N.opacity,J._prevWeight=I.lineWidth=K?J._prevWeight+1:N.weight,I.strokeStyle=N.color,I.lineCap=N.lineCap,I.lineJoin=N.lineJoin,I.stroke())},_onClick:function(I){var N,J=this._map.mouseEventToLayerPoint(I),K=[];for(var P in this._layers)N=this._layers[P],N.options.interactive&&N._containsPoint(J)&&!this._map._draggableMoved(N)&&(C.DomEvent._fakeStop(I),K.push(N));K.length&&this._fireEvent(K,I)},_onMouseMove:function(I){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var J=this._map.mouseEventToLayerPoint(I);this._handleMouseOut(I,J),this._handleMouseHover(I,J)}},_handleMouseOut:function(I,J){var K=this._hoveredLayer;K&&("mouseout"===I.type||!K._containsPoint(J))&&(C.DomUtil.removeClass(this._container,"leaflet-interactive"),this._fireEvent([K],I,"mouseout"),this._hoveredLayer=null)},_handleMouseHover:function(I,J){var K,N;for(K in this._drawnLayers)N=this._drawnLayers[K],N.options.interactive&&N._containsPoint(J)&&(C.DomUtil.addClass(this._container,"leaflet-interactive"),this._fireEvent([N],I,"mouseover"),this._hoveredLayer=N);this._hoveredLayer&&this._fireEvent([this._hoveredLayer],I)},_fireEvent:function(I,J,K){this._map._fireDOMEvent(J,K||J.type,I)},_bringToFront:C.Util.falseFn,_bringToBack:C.Util.falseFn}),C.Browser.canvas=function(){return!!document.createElement("canvas").getContext}(),C.canvas=function(I){return C.Browser.canvas?new C.Canvas(I):null},C.Polyline.prototype._containsPoint=function(I,J){var K,N,P,Q,R,T,U=this._clickTolerance();if(!this._pxBounds.contains(I))return!1;for(K=0,Q=this._parts.length;K<Q;K++)for(T=this._parts[K],N=0,R=T.length,P=R-1;N<R;P=N++)if((J||0!==N)&&C.LineUtil.pointToSegmentDistance(I,T[P],T[N])<=U)return!0;return!1},C.Polygon.prototype._containsPoint=function(I){var K,N,P,Q,R,T,U,V,J=!1;if(!this._pxBounds.contains(I))return!1;for(Q=0,U=this._parts.length;Q<U;Q++)for(K=this._parts[Q],R=0,V=K.length,T=V-1;R<V;T=R++)N=K[R],P=K[T],N.y>I.y!=P.y>I.y&&I.x<(P.x-N.x)*(I.y-N.y)/(P.y-N.y)+N.x&&(J=!J);return J||C.Polyline.prototype._containsPoint.call(this,I,!0)},C.CircleMarker.prototype._containsPoint=function(I){return I.distanceTo(this._point)<=this._radius+this._clickTolerance()},C.GeoJSON=C.FeatureGroup.extend({initialize:function(I,J){C.setOptions(this,J),this._layers={},I&&this.addData(I)},addData:function(I){var K,N,P,J=C.Util.isArray(I)?I:I.features;if(J){for(K=0,N=J.length;K<N;K++)P=J[K],(P.geometries||P.geometry||P.features||P.coordinates)&&this.addData(P);return this}var Q=this.options;if(Q.filter&&!Q.filter(I))return this;var R=C.GeoJSON.geometryToLayer(I,Q);return R?(R.feature=C.GeoJSON.asFeature(I),R.defaultOptions=R.options,this.resetStyle(R),Q.onEachFeature&&Q.onEachFeature(I,R),this.addLayer(R)):this},resetStyle:function(I){return I.options=C.Util.extend({},I.defaultOptions),this._setLayerStyle(I,this.options.style),this},setStyle:function(I){return this.eachLayer(function(J){this._setLayerStyle(J,I)},this)},_setLayerStyle:function(I,J){"function"==typeof J&&(J=J(I.feature)),I.setStyle&&I.setStyle(J)}}),C.extend(C.GeoJSON,{geometryToLayer:function(I,J){var T,U,V,W,K="Feature"===I.type?I.geometry:I,N=K?K.coordinates:null,P=[],Q=J&&J.pointToLayer,R=J&&J.coordsToLatLng||this.coordsToLatLng;if(!N&&!K)return null;switch(K.type){case"Point":return T=R(N),Q?Q(I,T):new C.Marker(T);case"MultiPoint":for(V=0,W=N.length;V<W;V++)T=R(N[V]),P.push(Q?Q(I,T):new C.Marker(T));return new C.FeatureGroup(P);case"LineString":case"MultiLineString":return U=this.coordsToLatLngs(N,"LineString"===K.type?0:1,R),new C.Polyline(U,J);case"Polygon":case"MultiPolygon":return U=this.coordsToLatLngs(N,"Polygon"===K.type?1:2,R),new C.Polygon(U,J);case"GeometryCollection":for(V=0,W=K.geometries.length;V<W;V++){var X=this.geometryToLayer({geometry:K.geometries[V],type:"Feature",properties:I.properties},J);X&&P.push(X)}return new C.FeatureGroup(P);default:throw new Error("Invalid GeoJSON object.");}},coordsToLatLng:function(I){return new C.LatLng(I[1],I[0],I[2])},coordsToLatLngs:function(I,J,K){var N=[];for(var R,P=0,Q=I.length;P<Q;P++)R=J?this.coordsToLatLngs(I[P],J-1,K):(K||this.coordsToLatLng)(I[P]),N.push(R);return N},latLngToCoords:function(I){return I.alt===void 0?[I.lng,I.lat]:[I.lng,I.lat,I.alt]},latLngsToCoords:function(I,J,K){var N=[];for(var P=0,Q=I.length;P<Q;P++)N.push(J?C.GeoJSON.latLngsToCoords(I[P],J-1,K):C.GeoJSON.latLngToCoords(I[P]));return!J&&K&&N.push(N[0]),N},getFeature:function(I,J){return I.feature?C.extend({},I.feature,{geometry:J}):C.GeoJSON.asFeature(J)},asFeature:function(I){return"Feature"===I.type?I:{type:"Feature",properties:{},geometry:I}}});var E={toGeoJSON:function(){return C.GeoJSON.getFeature(this,{type:"Point",coordinates:C.GeoJSON.latLngToCoords(this.getLatLng())})}};C.Marker.include(E),C.Circle.include(E),C.CircleMarker.include(E),C.Polyline.prototype.toGeoJSON=function(){var I=!C.Polyline._flat(this._latlngs),J=C.GeoJSON.latLngsToCoords(this._latlngs,I?1:0);return C.GeoJSON.getFeature(this,{type:(I?"Multi":"")+"LineString",coordinates:J})},C.Polygon.prototype.toGeoJSON=function(){var I=!C.Polyline._flat(this._latlngs),J=I&&!C.Polyline._flat(this._latlngs[0]),K=C.GeoJSON.latLngsToCoords(this._latlngs,J?2:I?1:0,!0);return I||(K=[K]),C.GeoJSON.getFeature(this,{type:(J?"Multi":"")+"Polygon",coordinates:K})},C.LayerGroup.include({toMultiPoint:function(){var I=[];return this.eachLayer(function(J){I.push(J.toGeoJSON().geometry.coordinates)}),C.GeoJSON.getFeature(this,{type:"MultiPoint",coordinates:I})},toGeoJSON:function(){var I=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===I)return this.toMultiPoint();var J="GeometryCollection"===I,K=[];return this.eachLayer(function(N){if(N.toGeoJSON){var P=N.toGeoJSON();K.push(J?P.geometry:C.GeoJSON.asFeature(P))}}),J?C.GeoJSON.getFeature(this,{geometries:K,type:"GeometryCollection"}):{type:"FeatureCollection",features:K}}}),C.geoJSON=function(I,J){return new C.GeoJSON(I,J)},C.geoJson=C.geoJSON;var G="_leaflet_events";C.DomEvent={on:function(I,J,K,N){if("object"==typeof J)for(var P in J)this._on(I,P,J[P],K);else{J=C.Util.splitWords(J);for(var Q=0,R=J.length;Q<R;Q++)this._on(I,J[Q],K,N)}return this},off:function(I,J,K,N){if("object"==typeof J)for(var P in J)this._off(I,P,J[P],K);else{J=C.Util.splitWords(J);for(var Q=0,R=J.length;Q<R;Q++)this._off(I,J[Q],K,N)}return this},_on:function(I,J,K,N){var P=J+C.stamp(K)+(N?"_"+C.stamp(N):"");if(I[G]&&I[G][P])return this;var Q=function(T){return K.call(N||I,T||window.event)},R=Q;return C.Browser.pointer&&0===J.indexOf("touch")?this.addPointerListener(I,J,Q,P):C.Browser.touch&&"dblclick"===J&&this.addDoubleTapListener?this.addDoubleTapListener(I,Q,P):"addEventListener"in I?"mousewheel"===J?I.addEventListener("onwheel"in I?"wheel":"mousewheel",Q,!1):"mouseenter"===J||"mouseleave"===J?(Q=function(T){T=T||window.event,C.DomEvent._isExternalTarget(I,T)&&R(T)},I.addEventListener("mouseenter"===J?"mouseover":"mouseout",Q,!1)):("click"==J&&C.Browser.android&&(Q=function(T){return C.DomEvent._filterClick(T,R)}),I.addEventListener(J,Q,!1)):"attachEvent"in I&&I.attachEvent("on"+J,Q),I[G]=I[G]||{},I[G][P]=Q,this},_off:function(I,J,K,N){var P=J+C.stamp(K)+(N?"_"+C.stamp(N):""),Q=I[G]&&I[G][P];return Q?(C.Browser.pointer&&0===J.indexOf("touch")?this.removePointerListener(I,J,P):C.Browser.touch&&"dblclick"===J&&this.removeDoubleTapListener?this.removeDoubleTapListener(I,P):"removeEventListener"in I?"mousewheel"===J?I.removeEventListener("onwheel"in I?"wheel":"mousewheel",Q,!1):I.removeEventListener("mouseenter"===J?"mouseover":"mouseleave"===J?"mouseout":J,Q,!1):"detachEvent"in I&&I.detachEvent("on"+J,Q),I[G][P]=null,this):this},stopPropagation:function(I){return I.stopPropagation?I.stopPropagation():I.originalEvent?I.originalEvent._stopped=!0:I.cancelBubble=!0,C.DomEvent._skipped(I),this},disableScrollPropagation:function(I){return C.DomEvent.on(I,"mousewheel",C.DomEvent.stopPropagation)},disableClickPropagation:function(I){var J=C.DomEvent.stopPropagation;return C.DomEvent.on(I,C.Draggable.START.join(" "),J),C.DomEvent.on(I,{click:C.DomEvent._fakeStop,dblclick:J})},preventDefault:function(I){return I.preventDefault?I.preventDefault():I.returnValue=!1,this},stop:function(I){return C.DomEvent.preventDefault(I).stopPropagation(I)},getMousePosition:function(I,J){if(!J)return new C.Point(I.clientX,I.clientY);var K=J.getBoundingClientRect();return new C.Point(I.clientX-K.left-J.clientLeft,I.clientY-K.top-J.clientTop)},_wheelPxFactor:C.Browser.win&&C.Browser.chrome?2:C.Browser.gecko?window.devicePixelRatio:1,getWheelDelta:function(I){return C.Browser.edge?I.wheelDeltaY/2:I.deltaY&&0===I.deltaMode?-I.deltaY/C.DomEvent._wheelPxFactor:I.deltaY&&1===I.deltaMode?20*-I.deltaY:I.deltaY&&2===I.deltaMode?60*-I.deltaY:I.deltaX||I.deltaZ?0:I.wheelDelta?(I.wheelDeltaY||I.wheelDelta)/2:I.detail&&32765>Math.abs(I.detail)?20*-I.detail:I.detail?60*(I.detail/-32765):0},_skipEvents:{},_fakeStop:function(I){C.DomEvent._skipEvents[I.type]=!0},_skipped:function(I){var J=this._skipEvents[I.type];return this._skipEvents[I.type]=!1,J},_isExternalTarget:function(I,J){var K=J.relatedTarget;if(!K)return!0;try{for(;K&&K!==I;)K=K.parentNode}catch(N){return!1}return K!==I},_filterClick:function(I,J){var K=I.timeStamp||I.originalEvent&&I.originalEvent.timeStamp,N=C.DomEvent._lastClick&&K-C.DomEvent._lastClick;return N&&100<N&&500>N||I.target._simulatedClick&&!I._simulated?void C.DomEvent.stop(I):void(C.DomEvent._lastClick=K,J(I))}},C.DomEvent.addListener=C.DomEvent.on,C.DomEvent.removeListener=C.DomEvent.off,C.Draggable=C.Evented.extend({options:{clickTolerance:3},statics:{START:C.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(I,J,K){this._element=I,this._dragStartTarget=J||I,this._preventOutline=K},enable:function(){this._enabled||(C.DomEvent.on(this._dragStartTarget,C.Draggable.START.join(" "),this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(C.DomEvent.off(this._dragStartTarget,C.Draggable.START.join(" "),this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(I){if(!I._simulated&&this._enabled&&(this._moved=!1,!C.DomUtil.hasClass(this._element,"leaflet-zoom-anim"))&&!C.Draggable._dragging&&!I.shiftKey&&(1===I.which||1===I.button||I.touches)&&this._enabled&&(C.Draggable._dragging=!0,this._preventOutline&&C.DomUtil.preventOutline(this._element),C.DomUtil.disableImageDrag(),C.DomUtil.disableTextSelection(),!this._moving)){this.fire("down");var J=I.touches?I.touches[0]:I;this._startPoint=new C.Point(J.clientX,J.clientY),C.DomEvent.on(document,C.Draggable.MOVE[I.type],this._onMove,this).on(document,C.Draggable.END[I.type],this._onUp,this)}},_onMove:function(I){if(!I._simulated&&this._enabled){if(I.touches&&1<I.touches.length)return void(this._moved=!0);var J=I.touches&&1===I.touches.length?I.touches[0]:I,K=new C.Point(J.clientX,J.clientY),N=K.subtract(this._startPoint);(N.x||N.y)&&!(Math.abs(N.x)+Math.abs(N.y)<this.options.clickTolerance)&&(C.DomEvent.preventDefault(I),!this._moved&&(this.fire("dragstart"),this._moved=!0,this._startPos=C.DomUtil.getPosition(this._element).subtract(N),C.DomUtil.addClass(document.body,"leaflet-dragging"),this._lastTarget=I.target||I.srcElement,window.SVGElementInstance&&this._lastTarget instanceof SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),C.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(N),this._moving=!0,C.Util.cancelAnimFrame(this._animRequest),this._lastEvent=I,this._animRequest=C.Util.requestAnimFrame(this._updatePosition,this,!0))}},_updatePosition:function(){var I={originalEvent:this._lastEvent};this.fire("predrag",I),C.DomUtil.setPosition(this._element,this._newPos),this.fire("drag",I)},_onUp:function(I){if(!I._simulated&&this._enabled){for(var J in C.DomUtil.removeClass(document.body,"leaflet-dragging"),this._lastTarget&&(C.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),C.Draggable.MOVE)C.DomEvent.off(document,C.Draggable.MOVE[J],this._onMove,this).off(document,C.Draggable.END[J],this._onUp,this);C.DomUtil.enableImageDrag(),C.DomUtil.enableTextSelection(),this._moved&&this._moving&&(C.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1,C.Draggable._dragging=!1}}}),C.Handler=C.Class.extend({initialize:function(I){this._map=I},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}}),C.Map.mergeOptions({dragging:!0,inertia:!C.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:0.2,worldCopyJump:!1,maxBoundsViscosity:0}),C.Map.Drag=C.Handler.extend({addHooks:function(){if(!this._draggable){var I=this._map;this._draggable=new C.Draggable(I._mapPane,I._container),this._draggable.on({down:this._onDown,dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),I.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),I.on("zoomend",this._onZoomEnd,this),I.whenReady(this._onZoomEnd,this))}C.DomUtil.addClass(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){C.DomUtil.removeClass(this._map._container,"leaflet-grab"),C.DomUtil.removeClass(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDown:function(){this._map._stop()},_onDragStart:function(){var I=this._map;if(this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var J=C.latLngBounds(this._map.options.maxBounds);this._offsetLimit=C.bounds(this._map.latLngToContainerPoint(J.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(J.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;I.fire("movestart").fire("dragstart"),I.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(I){if(this._map.options.inertia){var J=this._lastTime=+new Date,K=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(K),this._times.push(J),50<J-this._times[0]&&(this._positions.shift(),this._times.shift())}this._map.fire("move",I).fire("drag",I)},_onZoomEnd:function(){var I=this._map.getSize().divideBy(2),J=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=J.subtract(I).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(I,J){return I-(I-J)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var I=this._draggable._newPos.subtract(this._draggable._startPos),J=this._offsetLimit;I.x<J.min.x&&(I.x=this._viscousLimit(I.x,J.min.x)),I.y<J.min.y&&(I.y=this._viscousLimit(I.y,J.min.y)),I.x>J.max.x&&(I.x=this._viscousLimit(I.x,J.max.x)),I.y>J.max.y&&(I.y=this._viscousLimit(I.y,J.max.y)),this._draggable._newPos=this._draggable._startPos.add(I)}},_onPreDragWrap:function(){var I=this._worldWidth,J=Math.round(I/2),K=this._initialWorldOffset,N=this._draggable._newPos.x,P=(N-J+K)%I+J-K,Q=(N+J+K)%I-J-K,R=Math.abs(P+K)<Math.abs(Q+K)?P:Q;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=R},_onDragEnd:function(I){var J=this._map,K=J.options,N=!K.inertia||2>this._times.length;if(J.fire("dragend",I),N)J.fire("moveend");else{var P=this._lastPos.subtract(this._positions[0]),Q=(this._lastTime-this._times[0])/1000,R=K.easeLinearity,T=P.multiplyBy(R/Q),U=T.distanceTo([0,0]),V=Math.min(K.inertiaMaxSpeed,U),W=T.multiplyBy(V/U),X=V/(K.inertiaDeceleration*R),Y=W.multiplyBy(-X/2).round();Y.x||Y.y?(Y=J._limitOffset(Y,J.options.maxBounds),C.Util.requestAnimFrame(function(){J.panBy(Y,{duration:X,easeLinearity:R,noMoveStart:!0,animate:!0})})):J.fire("moveend")}}}),C.Map.addInitHook("addHandler","dragging",C.Map.Drag),C.Map.mergeOptions({doubleClickZoom:!0}),C.Map.DoubleClickZoom=C.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(I){var J=this._map,K=J.getZoom(),N=J.options.zoomDelta,P=I.originalEvent.shiftKey?K-N:K+N;"center"===J.options.doubleClickZoom?J.setZoom(P):J.setZoomAround(I.containerPoint,P)}}),C.Map.addInitHook("addHandler","doubleClickZoom",C.Map.DoubleClickZoom),C.Map.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60}),C.Map.ScrollWheelZoom=C.Handler.extend({addHooks:function(){C.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){C.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll,this)},_onWheelScroll:function(I){var J=C.DomEvent.getWheelDelta(I),K=this._map.options.wheelDebounceTime;this._delta+=J,this._lastMousePos=this._map.mouseEventToContainerPoint(I),this._startTime||(this._startTime=+new Date);var N=Math.max(K-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(C.bind(this._performZoom,this),N),C.DomEvent.stop(I)},_performZoom:function(){var I=this._map,J=I.getZoom(),K=this._map.options.zoomSnap||0;I._stop();var N=this._delta/(4*this._map.options.wheelPxPerZoomLevel),P=4*Math.log(2/(1+Math.exp(-Math.abs(N))))/Math.LN2,Q=K?Math.ceil(P/K)*K:P,R=I._limitZoom(J+(0<this._delta?Q:-Q))-J;this._delta=0,this._startTime=null;R&&("center"===I.options.scrollWheelZoom?I.setZoom(J+R):I.setZoomAround(this._lastMousePos,J+R))}}),C.Map.addInitHook("addHandler","scrollWheelZoom",C.Map.ScrollWheelZoom),C.extend(C.DomEvent,{_touchstart:C.Browser.msPointer?"MSPointerDown":C.Browser.pointer?"pointerdown":"touchstart",_touchend:C.Browser.msPointer?"MSPointerUp":C.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(I,J,K){function N(X){var Y;if(Y=C.Browser.pointer?C.DomEvent._pointersCount:X.touches.length,!(1<Y)){var Z=Date.now(),$=Z-(Q||Z);R=X.touches?X.touches[0]:X,T=0<$&&250>=$,Q=Z}}function P(){if(T&&!R.cancelBubble){if(C.Browser.pointer){var Y,Z,X={};for(Z in R)Y=R[Z],X[Z]=Y&&Y.bind?Y.bind(R):Y;R=X}R.type="dblclick",J(R),Q=null}}var Q,R,T=!1,U="_leaflet_",V=this._touchstart,W=this._touchend;return I[U+V+K]=N,I[U+W+K]=P,I[U+"dblclick"+K]=J,I.addEventListener(V,N,!1),I.addEventListener(W,P,!1),C.Browser.edge||I.addEventListener("dblclick",J,!1),this},removeDoubleTapListener:function(I,J){var K="_leaflet_",N=I[K+this._touchstart+J],P=I[K+this._touchend+J],Q=I[K+"dblclick"+J];return I.removeEventListener(this._touchstart,N,!1),I.removeEventListener(this._touchend,P,!1),C.Browser.edge||I.removeEventListener("dblclick",Q,!1),this}}),C.extend(C.DomEvent,{POINTER_DOWN:C.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:C.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:C.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:C.Browser.msPointer?"MSPointerCancel":"pointercancel",TAG_WHITE_LIST:["INPUT","SELECT","OPTION"],_pointers:{},_pointersCount:0,addPointerListener:function(I,J,K,N){return"touchstart"===J?this._addPointerStart(I,K,N):"touchmove"===J?this._addPointerMove(I,K,N):"touchend"==J&&this._addPointerEnd(I,K,N),this},removePointerListener:function(I,J,K){var N=I["_leaflet_"+J+K];return"touchstart"===J?I.removeEventListener(this.POINTER_DOWN,N,!1):"touchmove"===J?I.removeEventListener(this.POINTER_MOVE,N,!1):"touchend"==J&&(I.removeEventListener(this.POINTER_UP,N,!1),I.removeEventListener(this.POINTER_CANCEL,N,!1)),this},_addPointerStart:function(I,J,K){var N=C.bind(function(Q){if("mouse"!==Q.pointerType&&Q.pointerType!==Q.MSPOINTER_TYPE_MOUSE)if(0>this.TAG_WHITE_LIST.indexOf(Q.target.tagName))C.DomEvent.preventDefault(Q);else return;this._handlePointer(Q,J)},this);if(I["_leaflet_touchstart"+K]=N,I.addEventListener(this.POINTER_DOWN,N,!1),!this._pointerDocListener){var P=C.bind(this._globalPointerUp,this);document.documentElement.addEventListener(this.POINTER_DOWN,C.bind(this._globalPointerDown,this),!0),document.documentElement.addEventListener(this.POINTER_MOVE,C.bind(this._globalPointerMove,this),!0),document.documentElement.addEventListener(this.POINTER_UP,P,!0),document.documentElement.addEventListener(this.POINTER_CANCEL,P,!0),this._pointerDocListener=!0}},_globalPointerDown:function(I){this._pointers[I.pointerId]=I,this._pointersCount++},_globalPointerMove:function(I){this._pointers[I.pointerId]&&(this._pointers[I.pointerId]=I)},_globalPointerUp:function(I){delete this._pointers[I.pointerId],this._pointersCount--},_handlePointer:function(I,J){for(var K in I.touches=[],this._pointers)I.touches.push(this._pointers[K]);I.changedTouches=[I],J(I)},_addPointerMove:function(I,J,K){var N=C.bind(function(P){(P.pointerType===P.MSPOINTER_TYPE_MOUSE||"mouse"===P.pointerType)&&0===P.buttons||this._handlePointer(P,J)},this);I["_leaflet_touchmove"+K]=N,I.addEventListener(this.POINTER_MOVE,N,!1)},_addPointerEnd:function(I,J,K){var N=C.bind(function(P){this._handlePointer(P,J)},this);I["_leaflet_touchend"+K]=N,I.addEventListener(this.POINTER_UP,N,!1),I.addEventListener(this.POINTER_CANCEL,N,!1)}}),C.Map.mergeOptions({touchZoom:C.Browser.touch&&!C.Browser.android23,bounceAtZoomLimits:!0}),C.Map.TouchZoom=C.Handler.extend({addHooks:function(){C.DomUtil.addClass(this._map._container,"leaflet-touch-zoom"),C.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){C.DomUtil.removeClass(this._map._container,"leaflet-touch-zoom"),C.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(I){var J=this._map;if(!(!I.touches||2!==I.touches.length||J._animatingZoom||this._zooming)){var K=J.mouseEventToContainerPoint(I.touches[0]),N=J.mouseEventToContainerPoint(I.touches[1]);this._centerPoint=J.getSize()._divideBy(2),this._startLatLng=J.containerPointToLatLng(this._centerPoint),"center"!==J.options.touchZoom&&(this._pinchStartLatLng=J.containerPointToLatLng(K.add(N)._divideBy(2))),this._startDist=K.distanceTo(N),this._startZoom=J.getZoom(),this._moved=!1,this._zooming=!0,J._stop(),C.DomEvent.on(document,"touchmove",this._onTouchMove,this).on(document,"touchend",this._onTouchEnd,this),C.DomEvent.preventDefault(I)}},_onTouchMove:function(I){if(I.touches&&2===I.touches.length&&this._zooming){var J=this._map,K=J.mouseEventToContainerPoint(I.touches[0]),N=J.mouseEventToContainerPoint(I.touches[1]),P=K.distanceTo(N)/this._startDist;if(this._zoom=J.getScaleZoom(P,this._startZoom),!J.options.bounceAtZoomLimits&&(this._zoom<J.getMinZoom()&&1>P||this._zoom>J.getMaxZoom()&&1<P)&&(this._zoom=J._limitZoom(this._zoom)),"center"!==J.options.touchZoom){var Q=K._add(N)._divideBy(2)._subtract(this._centerPoint);if(1==P&&0===Q.x&&0===Q.y)return;this._center=J.unproject(J.project(this._pinchStartLatLng,this._zoom).subtract(Q),this._zoom)}else if(this._center=this._startLatLng,1==P)return;this._moved||(J._moveStart(!0),this._moved=!0),C.Util.cancelAnimFrame(this._animRequest);var R=C.bind(J._move,J,this._center,this._zoom,{pinch:!0,round:!1});this._animRequest=C.Util.requestAnimFrame(R,this,!0),C.DomEvent.preventDefault(I)}},_onTouchEnd:function(){return this._moved&&this._zooming?void(this._zooming=!1,C.Util.cancelAnimFrame(this._animRequest),C.DomEvent.off(document,"touchmove",this._onTouchMove).off(document,"touchend",this._onTouchEnd),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):void(this._zooming=!1)}}),C.Map.addInitHook("addHandler","touchZoom",C.Map.TouchZoom),C.Map.mergeOptions({tap:!0,tapTolerance:15}),C.Map.Tap=C.Handler.extend({addHooks:function(){C.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){C.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(I){if(I.touches){if(C.DomEvent.preventDefault(I),this._fireClick=!0,1<I.touches.length)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var J=I.touches[0],K=J.target;this._startPos=this._newPos=new C.Point(J.clientX,J.clientY),K.tagName&&"a"===K.tagName.toLowerCase()&&C.DomUtil.addClass(K,"leaflet-active"),this._holdTimeout=setTimeout(C.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",J))},this),1000),this._simulateEvent("mousedown",J),C.DomEvent.on(document,{touchmove:this._onMove,touchend:this._onUp},this)}},_onUp:function(I){if(clearTimeout(this._holdTimeout),C.DomEvent.off(document,{touchmove:this._onMove,touchend:this._onUp},this),this._fireClick&&I&&I.changedTouches){var J=I.changedTouches[0],K=J.target;K&&K.tagName&&"a"===K.tagName.toLowerCase()&&C.DomUtil.removeClass(K,"leaflet-active"),this._simulateEvent("mouseup",J),this._isTapValid()&&this._simulateEvent("click",J)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(I){var J=I.touches[0];this._newPos=new C.Point(J.clientX,J.clientY),this._simulateEvent("mousemove",J)},_simulateEvent:function(I,J){var K=document.createEvent("MouseEvents");K._simulated=!0,J.target._simulatedClick=!0,K.initMouseEvent(I,!0,!0,window,1,J.screenX,J.screenY,J.clientX,J.clientY,!1,!1,!1,!1,0,null),J.target.dispatchEvent(K)}}),C.Browser.touch&&!C.Browser.pointer&&C.Map.addInitHook("addHandler","tap",C.Map.Tap),C.Map.mergeOptions({boxZoom:!0}),C.Map.BoxZoom=C.Handler.extend({initialize:function(I){this._map=I,this._container=I._container,this._pane=I._panes.overlayPane},addHooks:function(){C.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){C.DomEvent.off(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_resetState:function(){this._moved=!1},_onMouseDown:function(I){return I.shiftKey&&(1===I.which||1===I.button)&&void(this._resetState(),C.DomUtil.disableTextSelection(),C.DomUtil.disableImageDrag(),this._startPoint=this._map.mouseEventToContainerPoint(I),C.DomEvent.on(document,{contextmenu:C.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this))},_onMouseMove:function(I){this._moved||(this._moved=!0,this._box=C.DomUtil.create("div","leaflet-zoom-box",this._container),C.DomUtil.addClass(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(I);var J=new C.Bounds(this._point,this._startPoint),K=J.getSize();C.DomUtil.setPosition(this._box,J.min),this._box.style.width=K.x+"px",this._box.style.height=K.y+"px"},_finish:function(){this._moved&&(C.DomUtil.remove(this._box),C.DomUtil.removeClass(this._container,"leaflet-crosshair")),C.DomUtil.enableTextSelection(),C.DomUtil.enableImageDrag(),C.DomEvent.off(document,{contextmenu:C.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(I){if((1===I.which||1===I.button)&&(this._finish(),!!this._moved)){setTimeout(C.bind(this._resetState,this),0);var J=new C.LatLngBounds(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(J).fire("boxzoomend",{boxZoomBounds:J})}},_onKeyDown:function(I){27===I.keyCode&&this._finish()}}),C.Map.addInitHook("addHandler","boxZoom",C.Map.BoxZoom),C.Map.mergeOptions({keyboard:!0,keyboardPanDelta:80}),C.Map.Keyboard=C.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(I){this._map=I,this._setPanDelta(I.options.keyboardPanDelta),this._setZoomDelta(I.options.zoomDelta)},addHooks:function(){var I=this._map._container;0>=I.tabIndex&&(I.tabIndex="0"),C.DomEvent.on(I,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),C.DomEvent.off(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var I=document.body,J=document.documentElement,K=I.scrollTop||J.scrollTop,N=I.scrollLeft||J.scrollLeft;this._map._container.focus(),window.scrollTo(N,K)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(I){var N,P,J=this._panKeys={},K=this.keyCodes;for(N=0,P=K.left.length;N<P;N++)J[K.left[N]]=[-1*I,0];for(N=0,P=K.right.length;N<P;N++)J[K.right[N]]=[I,0];for(N=0,P=K.down.length;N<P;N++)J[K.down[N]]=[0,I];for(N=0,P=K.up.length;N<P;N++)J[K.up[N]]=[0,-1*I]},_setZoomDelta:function(I){var N,P,J=this._zoomKeys={},K=this.keyCodes;for(N=0,P=K.zoomIn.length;N<P;N++)J[K.zoomIn[N]]=I;for(N=0,P=K.zoomOut.length;N<P;N++)J[K.zoomOut[N]]=-I},_addHooks:function(){C.DomEvent.on(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){C.DomEvent.off(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(I){if(!(I.altKey||I.ctrlKey||I.metaKey)){var N,J=I.keyCode,K=this._map;if(J in this._panKeys){if(K._panAnim&&K._panAnim._inProgress)return;N=this._panKeys[J],I.shiftKey&&(N=C.point(N).multiplyBy(3)),K.panBy(N),K.options.maxBounds&&K.panInsideBounds(K.options.maxBounds)}else if(J in this._zoomKeys)K.setZoom(K.getZoom()+(I.shiftKey?3:1)*this._zoomKeys[J]);else if(27===J)K.closePopup();else return;C.DomEvent.stop(I)}}}),C.Map.addInitHook("addHandler","keyboard",C.Map.Keyboard),C.Handler.MarkerDrag=C.Handler.extend({initialize:function(I){this._marker=I},addHooks:function(){var I=this._marker._icon;this._draggable||(this._draggable=new C.Draggable(I,I,!0)),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),C.DomUtil.addClass(I,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&C.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(I){var J=this._marker,K=J._shadow,N=C.DomUtil.getPosition(J._icon),P=J._map.layerPointToLatLng(N);K&&C.DomUtil.setPosition(K,N),J._latlng=P,I.latlng=P,I.oldLatLng=this._oldLatLng,J.fire("move",I).fire("drag",I)},_onDragEnd:function(I){delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",I)}}),C.Control=C.Class.extend({options:{position:"topright"},initialize:function(I){C.setOptions(this,I)},getPosition:function(){return this.options.position},setPosition:function(I){var J=this._map;return J&&J.removeControl(this),this.options.position=I,J&&J.addControl(this),this},getContainer:function(){return this._container},addTo:function(I){this.remove(),this._map=I;var J=this._container=this.onAdd(I),K=this.getPosition(),N=I._controlCorners[K];return C.DomUtil.addClass(J,"leaflet-control"),-1===K.indexOf("bottom")?N.appendChild(J):N.insertBefore(J,N.firstChild),this},remove:function(){return this._map?(C.DomUtil.remove(this._container),this.onRemove&&this.onRemove(this._map),this._map=null,this):this},_refocusOnMap:function(I){this._map&&I&&0<I.screenX&&0<I.screenY&&this._map.getContainer().focus()}}),C.control=function(I){return new C.Control(I)},C.Map.include({addControl:function(I){return I.addTo(this),this},removeControl:function(I){return I.remove(),this},_initControlPos:function(){function I(P,Q){J[P+Q]=C.DomUtil.create("div",K+P+" "+K+Q,N)}var J=this._controlCorners={},K="leaflet-",N=this._controlContainer=C.DomUtil.create("div",K+"control-container",this._container);I("top","left"),I("top","right"),I("bottom","left"),I("bottom","right")},_clearControlPos:function(){C.DomUtil.remove(this._controlContainer)}}),C.Control.Zoom=C.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(I){var J="leaflet-control-zoom",K=C.DomUtil.create("div",J+" leaflet-bar"),N=this.options;return this._zoomInButton=this._createButton(N.zoomInText,N.zoomInTitle,J+"-in",K,this._zoomIn),this._zoomOutButton=this._createButton(N.zoomOutText,N.zoomOutTitle,J+"-out",K,this._zoomOut),this._updateDisabled(),I.on("zoomend zoomlevelschange",this._updateDisabled,this),K},onRemove:function(I){I.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(I){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(I.shiftKey?3:1))},_zoomOut:function(I){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(I.shiftKey?3:1))},_createButton:function(I,J,K,N,P){var Q=C.DomUtil.create("a",K,N);return Q.innerHTML=I,Q.href="#",Q.title=J,C.DomEvent.on(Q,"mousedown dblclick",C.DomEvent.stopPropagation).on(Q,"click",C.DomEvent.stop).on(Q,"click",P,this).on(Q,"click",this._refocusOnMap,this),Q},_updateDisabled:function(){var I=this._map,J="leaflet-disabled";C.DomUtil.removeClass(this._zoomInButton,J),C.DomUtil.removeClass(this._zoomOutButton,J),(this._disabled||I._zoom===I.getMinZoom())&&C.DomUtil.addClass(this._zoomOutButton,J),(this._disabled||I._zoom===I.getMaxZoom())&&C.DomUtil.addClass(this._zoomInButton,J)}}),C.Map.mergeOptions({zoomControl:!0}),C.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new C.Control.Zoom,this.addControl(this.zoomControl))}),C.control.zoom=function(I){return new C.Control.Zoom(I)},C.Control.Attribution=C.Control.extend({options:{position:"bottomright",prefix:"<a href=\"http://leafletjs.com\" title=\"A JS library for interactive maps\">Leaflet</a>"},initialize:function(I){C.setOptions(this,I),this._attributions={}},onAdd:function(I){for(var J in I.attributionControl=this,this._container=C.DomUtil.create("div","leaflet-control-attribution"),C.DomEvent&&C.DomEvent.disableClickPropagation(this._container),I._layers)I._layers[J].getAttribution&&this.addAttribution(I._layers[J].getAttribution());return this._update(),this._container},setPrefix:function(I){return this.options.prefix=I,this._update(),this},addAttribution:function(I){return I?(this._attributions[I]||(this._attributions[I]=0),this._attributions[I]++,this._update(),this):this},removeAttribution:function(I){return I?(this._attributions[I]&&(this._attributions[I]--,this._update()),this):this},_update:function(){if(this._map){var I=[];for(var J in this._attributions)this._attributions[J]&&I.push(J);var K=[];this.options.prefix&&K.push(this.options.prefix),I.length&&K.push(I.join(", ")),this._container.innerHTML=K.join(" | ")}}}),C.Map.mergeOptions({attributionControl:!0}),C.Map.addInitHook(function(){this.options.attributionControl&&new C.Control.Attribution().addTo(this)}),C.control.attribution=function(I){return new C.Control.Attribution(I)},C.Control.Scale=C.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(I){var J="leaflet-control-scale",K=C.DomUtil.create("div",J),N=this.options;return this._addScales(N,J+"-line",K),I.on(N.updateWhenIdle?"moveend":"move",this._update,this),I.whenReady(this._update,this),K},onRemove:function(I){I.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(I,J,K){I.metric&&(this._mScale=C.DomUtil.create("div",J,K)),I.imperial&&(this._iScale=C.DomUtil.create("div",J,K))},_update:function(){var I=this._map,J=I.getSize().y/2,K=I.distance(I.containerPointToLatLng([0,J]),I.containerPointToLatLng([this.options.maxWidth,J]));this._updateScales(K)},_updateScales:function(I){this.options.metric&&I&&this._updateMetric(I),this.options.imperial&&I&&this._updateImperial(I)},_updateMetric:function(I){var J=this._getRoundNum(I),K=1000>J?J+" m":J/1000+" km";this._updateScale(this._mScale,K,J/I)},_updateImperial:function(I){var K,N,P,J=3.2808399*I;5280<J?(K=J/5280,N=this._getRoundNum(K),this._updateScale(this._iScale,N+" mi",N/K)):(P=this._getRoundNum(J),this._updateScale(this._iScale,P+" ft",P/J))},_updateScale:function(I,J,K){I.style.width=Math.round(this.options.maxWidth*K)+"px",I.innerHTML=J},_getRoundNum:function(I){var J=Math.pow(10,(Math.floor(I)+"").length-1),K=I/J;return K=10<=K?10:5<=K?5:3<=K?3:2<=K?2:1,J*K}}),C.control.scale=function(I){return new C.Control.Scale(I)},C.Control.Layers=C.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1},initialize:function(I,J,K){for(var N in C.setOptions(this,K),this._layers=[],this._lastZIndex=0,this._handlingClick=!1,I)this._addLayer(I[N],N);for(N in J)this._addLayer(J[N],N,!0)},onAdd:function(I){return this._initLayout(),this._update(),this._map=I,I.on("zoomend",this._checkDisabledLayers,this),this._container},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var I=0;I<this._layers.length;I++)this._layers[I].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(I,J){return this._addLayer(I,J),this._map?this._update():this},addOverlay:function(I,J){return this._addLayer(I,J,!0),this._map?this._update():this},removeLayer:function(I){I.off("add remove",this._onLayerChange,this);var J=this._getLayer(C.stamp(I));return J&&this._layers.splice(this._layers.indexOf(J),1),this._map?this._update():this},expand:function(){C.DomUtil.addClass(this._container,"leaflet-control-layers-expanded"),this._form.style.height=null;var I=this._map.getSize().y-(this._container.offsetTop+50);return I<this._form.clientHeight?(C.DomUtil.addClass(this._form,"leaflet-control-layers-scrollbar"),this._form.style.height=I+"px"):C.DomUtil.removeClass(this._form,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return C.DomUtil.removeClass(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var I="leaflet-control-layers",J=this._container=C.DomUtil.create("div",I);J.setAttribute("aria-haspopup",!0),C.DomEvent.disableClickPropagation(J),C.Browser.touch||C.DomEvent.disableScrollPropagation(J);var K=this._form=C.DomUtil.create("form",I+"-list");if(this.options.collapsed){C.Browser.android||C.DomEvent.on(J,{mouseenter:this.expand,mouseleave:this.collapse},this);var N=this._layersLink=C.DomUtil.create("a",I+"-toggle",J);N.href="#",N.title="Layers",C.Browser.touch?C.DomEvent.on(N,"click",C.DomEvent.stop).on(N,"click",this.expand,this):C.DomEvent.on(N,"focus",this.expand,this),C.DomEvent.on(K,"click",function(){setTimeout(C.bind(this._onInputClick,this),0)},this),this._map.on("click",this.collapse,this)}else this.expand();this._baseLayersList=C.DomUtil.create("div",I+"-base",K),this._separator=C.DomUtil.create("div",I+"-separator",K),this._overlaysList=C.DomUtil.create("div",I+"-overlays",K),J.appendChild(K)},_getLayer:function(I){for(var J=0;J<this._layers.length;J++)if(this._layers[J]&&C.stamp(this._layers[J].layer)===I)return this._layers[J]},_addLayer:function(I,J,K){I.on("add remove",this._onLayerChange,this),this._layers.push({layer:I,name:J,overlay:K}),this.options.autoZIndex&&I.setZIndex&&(this._lastZIndex++,I.setZIndex(this._lastZIndex))},_update:function(){if(!this._container)return this;C.DomUtil.empty(this._baseLayersList),C.DomUtil.empty(this._overlaysList);var I,J,K,N,P=0;for(K=0;K<this._layers.length;K++)N=this._layers[K],this._addItem(N),J=J||N.overlay,I=I||!N.overlay,P+=N.overlay?0:1;return this.options.hideSingleBase&&(I=I&&1<P,this._baseLayersList.style.display=I?"":"none"),this._separator.style.display=J&&I?"":"none",this},_onLayerChange:function(I){this._handlingClick||this._update();var J=this._getLayer(C.stamp(I.target)),K=J.overlay?"add"===I.type?"overlayadd":"overlayremove":"add"===I.type?"baselayerchange":null;K&&this._map.fire(K,J)},_createRadioElement:function(I,J){var K="<input type=\"radio\" class=\"leaflet-control-layers-selector\" name=\""+I+"\""+(J?" checked=\"checked\"":"")+"/>",N=document.createElement("div");return N.innerHTML=K,N.firstChild},_addItem:function(I){var N,J=document.createElement("label"),K=this._map.hasLayer(I.layer);I.overlay?(N=document.createElement("input"),N.type="checkbox",N.className="leaflet-control-layers-selector",N.defaultChecked=K):N=this._createRadioElement("leaflet-base-layers",K),N.layerId=C.stamp(I.layer),C.DomEvent.on(N,"click",this._onInputClick,this);var P=document.createElement("span");P.innerHTML=" "+I.name;var Q=document.createElement("div");J.appendChild(Q),Q.appendChild(N),Q.appendChild(P);var R=I.overlay?this._overlaysList:this._baseLayersList;return R.appendChild(J),this._checkDisabledLayers(),J},_onInputClick:function(){var J,K,N,I=this._form.getElementsByTagName("input"),P=[],Q=[];this._handlingClick=!0;for(var R=I.length-1;0<=R;R--)J=I[R],K=this._getLayer(J.layerId).layer,N=this._map.hasLayer(K),J.checked&&!N?P.push(K):!J.checked&&N&&Q.push(K);for(R=0;R<Q.length;R++)this._map.removeLayer(Q[R]);for(R=0;R<P.length;R++)this._map.addLayer(P[R]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){var J,K,I=this._form.getElementsByTagName("input"),N=this._map.getZoom();for(var P=I.length-1;0<=P;P--)J=I[P],K=this._getLayer(J.layerId).layer,J.disabled=void 0!==K.options.minZoom&&N<K.options.minZoom||void 0!==K.options.maxZoom&&N>K.options.maxZoom},_expand:function(){return this.expand()},_collapse:function(){return this.collapse()}}),C.control.layers=function(I,J,K){return new C.Control.Layers(I,J,K)},C.PosAnimation=C.Evented.extend({run:function(I,J,K,N){this.stop(),this._el=I,this._inProgress=!0,this._duration=K||0.25,this._easeOutPower=1/Math.max(N||0.5,0.2),this._startPos=C.DomUtil.getPosition(I),this._offset=J.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=C.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(I){var J=+new Date-this._startTime,K=1000*this._duration;J<K?this._runFrame(this._easeOut(J/K),I):(this._runFrame(1),this._complete())},_runFrame:function(I,J){var K=this._startPos.add(this._offset.multiplyBy(I));J&&K._round(),C.DomUtil.setPosition(this._el,K),this.fire("step")},_complete:function(){C.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(I){return 1-Math.pow(1-I,this._easeOutPower)}}),C.Map.include({setView:function(I,J,K){if(J=void 0===J?this._zoom:this._limitZoom(J),I=this._limitCenter(C.latLng(I),J,this.options.maxBounds),K=K||{},this._stop(),this._loaded&&!K.reset&&!0!==K){void 0!==K.animate&&(K.zoom=C.extend({animate:K.animate},K.zoom),K.pan=C.extend({animate:K.animate,duration:K.duration},K.pan));var N=this._zoom===J?this._tryAnimatedPan(I,K.pan):this._tryAnimatedZoom&&this._tryAnimatedZoom(I,J,K.zoom);if(N)return clearTimeout(this._sizeTimer),this}return this._resetView(I,J),this},panBy:function(I,J){if(I=C.point(I).round(),J=J||{},!I.x&&!I.y)return this.fire("moveend");if(!0!==J.animate&&!this.getSize().contains(I))return this._resetView(this.unproject(this.project(this.getCenter()).add(I)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new C.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),J.noMoveStart||this.fire("movestart"),!1!==J.animate){C.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var K=this._getMapPanePos().subtract(I).round();this._panAnim.run(this._mapPane,K,J.duration||0.25,J.easeLinearity)}else this._rawPanBy(I),this.fire("move").fire("moveend");return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){C.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(I,J){var K=this._getCenterOffset(I)._floor();return(!0===(J&&J.animate)||this.getSize().contains(K))&&(this.panBy(K,J),!0)}}),C.Map.mergeOptions({zoomAnimation:!0,zoomAnimationThreshold:4});var H=C.DomUtil.TRANSITION&&C.Browser.any3d&&!C.Browser.mobileOpera;H&&C.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),C.DomEvent.on(this._proxy,C.DomUtil.TRANSITION_END,this._catchTransitionEnd,this))}),C.Map.include(H?{_createAnimProxy:function(){var I=this._proxy=C.DomUtil.create("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(I),this.on("zoomanim",function(J){var K=C.DomUtil.TRANSFORM,N=I.style[K];C.DomUtil.setTransform(I,this.project(J.center,J.zoom),this.getZoomScale(J.zoom,1)),N===I.style[K]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",function(){var J=this.getCenter(),K=this.getZoom();C.DomUtil.setTransform(I,this.project(J,K),this.getZoomScale(K,1))},this)},_catchTransitionEnd:function(I){this._animatingZoom&&0<=I.propertyName.indexOf("transform")&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(I,J,K){if(this._animatingZoom)return!0;if(K=K||{},!this._zoomAnimated||!1===K.animate||this._nothingToAnimate()||Math.abs(J-this._zoom)>this.options.zoomAnimationThreshold)return!1;var N=this.getZoomScale(J),P=this._getCenterOffset(I)._divideBy(1-1/N);return(!0===K.animate||this.getSize().contains(P))&&(C.Util.requestAnimFrame(function(){this._moveStart(!0)._animateZoom(I,J,!0)},this),!0)},_animateZoom:function(I,J,K,N){K&&(this._animatingZoom=!0,this._animateToCenter=I,this._animateToZoom=J,C.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:I,zoom:J,noUpdate:N}),setTimeout(C.bind(this._onZoomTransitionEnd,this),250)},_onZoomTransitionEnd:function(){this._animatingZoom&&(C.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom),C.Util.requestAnimFrame(function(){this._moveEnd(!0)},this))}}:{}),C.Map.include({flyTo:function(I,J,K){function N(ia){var ja=ia?-1:1,ka=ia?aa:_,la=(aa*aa-_*_+ja*da*da*ba*ba)/(2*ka*da*ba),ma=Math.sqrt(la*la+1)-la,na=1e-9>ma?-18:Math.log(ma);return na}function P(ia){return(Math.exp(ia)-Math.exp(-ia))/2}function Q(ia){return(Math.exp(ia)+Math.exp(-ia))/2}function R(ia){return P(ia)/Q(ia)}function T(ia){return _*(Q(ea)/Q(ea+ca*ia))}function U(ia){return _*(Q(ea)*R(ea+ca*ia)-P(ea))/da}function V(ia){return 1-Math.pow(1-ia,1.5)}function W(){var ia=(Date.now()-fa)/ha,ja=V(ia)*ga;1>=ia?(this._flyToFrame=C.Util.requestAnimFrame(W,this),this._move(this.unproject(X.add(Y.subtract(X).multiplyBy(U(ja)/ba)),$),this.getScaleZoom(_/T(ja),$),{flyTo:!0})):this._move(I,J)._moveEnd(!0)}if(K=K||{},!1===K.animate||!C.Browser.any3d)return this.setView(I,J,K);this._stop();var X=this.project(this.getCenter()),Y=this.project(I),Z=this.getSize(),$=this._zoom;I=C.latLng(I),J=void 0===J?$:J;var _=Math.max(Z.x,Z.y),aa=_*this.getZoomScale($,J),ba=Y.distanceTo(X)||1,ca=1.42,da=ca*ca,ea=N(0),fa=Date.now(),ga=(N(1)-ea)/ca,ha=K.duration?1000*K.duration:0.8*(1000*ga);return this._moveStart(!0),W.call(this),this},flyToBounds:function(I,J){var K=this._getBoundsCenterZoom(I,J);return this.flyTo(K.center,K.zoom,J)}}),C.Map.include({_defaultLocateOptions:{timeout:10000,watch:!1},locate:function(I){if(I=this._locateOptions=C.extend({},this._defaultLocateOptions,I),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var J=C.bind(this._handleGeolocationResponse,this),K=C.bind(this._handleGeolocationError,this);return I.watch?this._locationWatchId=navigator.geolocation.watchPosition(J,K,I):navigator.geolocation.getCurrentPosition(J,K,I),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(I){var J=I.code,K=I.message||(1===J?"permission denied":2===J?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:J,message:"Geolocation error: "+K+"."})},_handleGeolocationResponse:function(I){var J=I.coords.latitude,K=I.coords.longitude,N=new C.LatLng(J,K),P=N.toBounds(I.coords.accuracy),Q=this._locateOptions;if(Q.setView){var R=this.getBoundsZoom(P);this.setView(N,Q.maxZoom?Math.min(R,Q.maxZoom):R)}var T={latlng:N,bounds:P,timestamp:I.timestamp};for(var U in I.coords)"number"==typeof I.coords[U]&&(T[U]=I.coords[U]);this.fire("locationfound",T)}}),q.default=C}),define("muc/component",["exports","muc/observable","muc/parser3","muc/render-node"],function(g,q,B,C){Object.defineProperty(g,"__esModule",{value:!0}),g.components=g.RoutableComponent=g.Component=void 0;class D extends q.O{constructor(){super(),this.template="<span>This is the default component template</span>"}get __parsedTemplate__(){return this.__proto__.__parsedTemplate||(this.__proto__.__parsedTemplate={}),this.__proto__.__parsedTemplate[this.template]||(console.log("compiling template",this.__oid__),this.__proto__.__parsedTemplate[this.template]=this.template?(0,B.parse)(this.template):[]),this.__proto__.__parsedTemplate[this.template]}init(){super.init(),Object.defineProperty(this,"renderNode",{enumerable:!1,writable:!0,value:this.renderNode}),this.renderNode&&this.renderNode.node.attributes&&this.renderNode.node.attributes.forEach(E=>{if("Literal"===E.value.type)this[E.name]=E.value.value;else{const G={};this.renderNode.evalExpression(E.value,G),(0,q.convertComputed)(this,E.name,{get:()=>{return this.renderNode.evalExpression(E.value,{})},set:null,keys:Object.keys(G).map(H=>`renderNode.${H}`)})}})}dispose(){}didInsertElement(){}willRemoveElement(){}render(){"undefined"==typeof this.tagName&&(this.tagName=this.renderNode.node.name);let E;E=this.tagName?{type:"Tag",name:this.tagName,attributes:(this.attributeBindings||[]).map(G=>{let[H,I]=G.split(":");return I=I||H,{name:H,value:{type:"Identifier",value:`block.ctx.${I}`}}}),content:this.__parsedTemplate__}:{type:"Block",block:this.__parsedTemplate__},this.renderNode.children=q.A.from([C.RenderNode.create({node:E,doc:this.renderNode.doc,parentNode:this.renderNode,block:q.O.create({ctx:this}),parentElement:this.renderNode.parentElement,owner:this.renderNode.owner})]);for(let G=0,H=this.renderNode.children.length;G<H;G++)this.renderNode.children[G].render();this.didInsertElement()}unrender(){this.renderNode.elements&&(this.renderNode.elements.forEach(E=>E.remove()),this.renderNode.elements=null),this.renderNode.children.forEach(E=>E.dispose()),this.renderNode.children=null}}g.Component=D,g.RoutableComponent=class extends D{init(){if(super.init(),this.queryParamsx){const G=location.search.substr(1),H=G.split("&");for(let I=0,J=H.length;I<J;I++){const K=H[I],N=K.substr(0,K.indexOf("="));if(N in this.queryParams){const P=K.slice(N.length+1);(0,q.convertComputed)(this,N,{keys:[],get:null,set(Q){console.log("init transition",Q)}}),this[N]=P}}}}modelHook(){}redirect(){}error(){}loading(){}didEnter(){console.log("didEnter",this.__name)}didLeave(){console.log("didLeave",this.__name)}willTransition(){console.log("willTransition",this.__name)}transitionTo(G){this.getOwner().router.transitionTo(G)}},g.components={"delegate-component":class extends D{init(){super.init();const E=[];this.renderNode.node.attributes.forEach(G=>E.push(`${G.name}={{${G.name}}}`)),this.template=`
                <${this.component} ${E.join(" ")}>
                    <yield-block />
                </${this.component}>
            `}},"link-to":class extends D{constructor(){super(),this.tagName="a",this.attributeBindings=["href:_href","class:_class"],this._href=(0,q.computed)("renderNode.block.href",function(){return`${window.location.pathname}#/${this.href}`}),this._class=(0,q.computed)("owner.router.currentRoute","href",function(){return this.getOwner().router.currentRoute===this.href?`${this.class} active`:this.class}),this.template="<yield-block/>"}},"yield-block":class extends D{render(){function E(K,N,P){for(let Q of K)if(Q[N]===P)return Q;return null}for(var G=this.renderNode.parentNode;!G.component;)G=G.parentNode;const H=q.O.create({__yield:this.renderNode.block});if(G.block.computedProps.length)throw new Error("Cannot clone blocks with computed props");Object.assign(H,G.block);let I=[],J=[];try{if(J=G.node.params,I=E(this.renderNode.node.attributes,"name","params"),I){if(I="Invocation"===I.value.type?I.value.value:[I.value],I.length!==J.length)throw console.log(I,J),new Error("Yield block and params have different args");J.forEach((K,N)=>{if("Literal"===I[N].type)H[K]=I[N].value;else{const P=I[N].value;(0,q.convertComputed)(H,K,{get:()=>{return this.renderNode.getPath(P)},set:null,keys:[`__yield.${P.replace(/^block./,"")}`]})}})}}catch(K){console.log(`Caught ${K}`)}this.renderNode.children=[C.RenderNode.create({node:{type:"Block",block:G.node.content},doc:this.renderNode.doc,parentNode:this.renderNode,block:H,parentElement:this.renderNode.parentElement,owner:this.renderNode.owner})];for(let K of this.renderNode.children)K.render()}}}}),define("muc/helper",["exports"],function(g){function q(K){const N=`action${K.type}`,P=K.currentTarget.dataset[N];if(P){const{action:Q,args:R}=this.actions[`${K.type}-${P}`],T=this.block.ctx,U=T.renderNode.evalExpression(Q,{}),V=T.actions&&T.actions[U];if(!V)throw new Error(`There is no action ${U} on ${T.__oid__}`);V.apply(T,R.map(W=>this.evalExpression(W,{})).concat([K]))}}Object.defineProperty(g,"__esModule",{value:!0}),g.daysToMonths=function(N){return 4800*N/146097},g.monthsToDays=function(N){return 146097*N/4800};class B{constructor(K){this.fn=K}}g.Helper=B;class C{constructor(K){this.expand=!0,this.fn=K}}g.HelperExpandArgs=C;class D{constructor(K){this.expr=!0,this.fn=K}}g.HelperExpression=D;class E{constructor(K){this.content=K}}g.HTML=E;const G=/(?=^(?:[1-9]\d{3}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1\d|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[1-9]\d(?:0[48]|[2468][048]|[13579][26])|(?:[2468][048]|[13579][26])00)-02-29)T(?:[01]\d|2[0-3]):[0-5]\d:[0-5]\d(?:[,.]\d+)?(?:Z|[+-][01]\d:[0-5]\d)?$)(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:[,.]\d+)?)(.*)/,H=K=>{const N=K.toString();return 2>N.length?`0${N}`:N},I={s:45,m:45,h:22,d:26,M:11};class J{constructor(K){if("string"==typeof K)this.d=new Date(K),this.o=G.exec(K);else if(K instanceof J)this.d=new Date(K.d);else if(!K){this.d=new Date;const N=this.d.getTimezoneOffset(),P=`${0>N?"+":"-"}${Math.abs(N)/60>>0}:${Math.abs(N)%60}`;this.o=G.exec(`${this.d.toISOString().slice(0,-1)}${P}`)}else console.assert(!1,`Bad moment initialization: ${K}`);this.dddd=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],this.ddd=this.dddd.map(N=>N.slice(0,3)),this.dd=this.dddd.map(N=>N.slice(0,2)),this.MMMM=["January","Februray","March","April","May","June","July","August","September","October","November","December"],this.MMM=this.MMMM.map(N=>N.slice(0,3))}clone(){return new J(this)}monthDays(K,N){return new Date(K,N,0).getDate()}get year(){return this.d.getFullYear()}set year(K){this.d.setFullYear(K)}get month(){return this.d.getMonth()+1}set month(K){const N=this.monthDays(this.year,K);this.date>N&&(this.date=N),this.d.setMonth(K-1)}get date(){return this.d.getDate()}set date(K){this.d.setDate(K)}get hour(){return this.d.getHours()}set hour(K){this.d.setHours(K)}get minute(){return this.d.getMinutes()}set minute(K){this.d.setMinutes(K)}get second(){return this.d.getSeconds()}set second(K){this.d.setSeconds(K)}get millisecond(){return this.d.getMilliseconds()}set millisecond(K){this.d.setMilliseconds(K)}get weekday(){return this.d.getDay()}set weekday(K){const N=K-this.weekday;this.date=this.date+N}add(K,N){return"week"===N&&(K*=7,N="date"),this[N]=this[N]+K,this}startOf(K){switch(K){case"year":this.month=1;case"month":this.date=1;case"week":case"date":this.hour=0;case"hour":this.minute=0;case"minute":this.second=0;case"second":this.millisecond=0;}return"week"===K&&(this.weekday=0),this}endOf(K){return this.startOf(K).add(1,K).add(-1,"millisecond")}format(K){K=K||"YYYY-MM-DDTHH:mm:ssZ";const N={MMMM:()=>this.MMMM[this.month-1],MMM:()=>this.MMM[this.month-1],MM:()=>H(this.month),M:()=>this.month,DD:()=>H(this.date),D:()=>this.date,dddd:()=>this.dddd[this.weekday],ddd:()=>this.ddd[this.weekday],dd:()=>this.dd[this.weekday],d:()=>this.weekday,YYYY:()=>this.year,YY:()=>this.year%100,HH:()=>H(this.hour),H:()=>this.hour,hh:()=>H(this.hour%12),h:()=>this.hour%12,mm:()=>H(this.minute),m:()=>this.minute,ss:()=>H(this.second),s:()=>this.second,LL:()=>`${this.MMMM[this.month-1]} ${this.date} ${this.year}`,LT:()=>`${H(this.hour)}:${H(this.minute)}`,Z:()=>{const Q=this.d.getTimezoneOffset();return`${0>Q?"+":"-"}${H(Math.abs(Q)/60>>0)}:${H(Math.abs(Q)%60)}`}},P=new RegExp(`${Object.keys(N).join("|")}|.`,"g");return K.replace(P,Q=>{return N[Q]?N[Q]():Q})}valueOf(){return this.d.valueOf()}}g.Moment=J,g.helpers={action:new B(function([[K,...N]]){const P=N.filter(V=>"on"===V.name)[0],Q=N.filter(V=>"capture"===V.name)[0],R=P?P.value:"click";N=N.filter(V=>"on"!==V.name&&"capture"!==V.name);const T=this.getOwner().actions.id++,U=this.actions||(this.actions={});return U[`${R}-${T}`]={action:K,args:N},this.handleEvent=this.getOwner().asyncEvent(q),this.elements[0].addEventListener(R,this,!!Q),{name:`data-action${R}`,value:T}}),"classic-action":new B(function([K,...N]){const P=N.filter(U=>"on"===U.name)[0];N=N.filter(U=>"on"!==U.name);const Q=this.block.ctx;console.log("registering action for",this.elements[0]);const R=P?P.value:"click",T=this.getOwner().addAction(R,Q,K,N);return{name:`data-action${R}`,value:T}}),findCondition:new B(function([K],N){for(let P=0,Q=K.length;P<Q;P++){const R=K[P];if(!R)return P;if(this.evalExpression(R,N))return P}return-1}),curry:new B(function(K){return(...N)=>{return N=N.map(P=>{return{type:"Literal",value:P}}),this.evalExpression({type:"Expression",value:K[0][0].value.concat(N)},{})}}),fn:new C(function(K){return(...N)=>{return K[0].apply(this.block.ctx,K.slice(1).concat(N))}}),set:new B(function(K){return this.setPath(K[0][0].value,K[1])}),concat:new C(K=>{return K.join("")}),"if":new D(K=>{const N=K[0],P=K[1],Q=K[2];return`${N} ? ${P} : ${Q}`}),"if":new C(K=>{const N=K[0],P=K[1],Q=K[2];return N?P:Q}),"is-equal":new D(K=>`${K[0]} === ${K[1]}`),"is-equal":new C(K=>K[0]===K[1]),"is-greater":new D(K=>`${K[0]} > ${K[1]}`),"is-greater":new C(K=>K[0]>K[1]),upper:new D(K=>"undefined"==typeof K?"":`${K}.toUpperCase()`),upper:new C(K=>`${K}`.toUpperCase()),not:new C(K=>!K[0]),increment:new C(K=>K+1),"print-relatime":new C(K=>{return K[0]}),"format-timedelta":new C(K=>{if(null===K)return"";K=K>>0;const N=K/3600>>0;K=K%3600;const P=K/60>>0;return(K=K%60,N)?`${N}h ${H(P)}m ${H(K)}s`:P?`${P}m ${H(K)}s`:`${K}s`}),"format-datetime":new C((K,N)=>{return N="YYYY-MM-DD HH:mm:ss",K[0]?new J(K[0]).format(N||"YYYY-MM-DD hh:mmm:ss"):""}),"format-float":new C((K,N)=>{N="number"==typeof N?N:2;const P=Math.pow(10,N);return(K*P>>0)/P}),"format-icon":new C(K=>{return new E(`<span class="glyphicon glyphicon-${K.icon} ${K.classes}"
                 data-toggle="tooltip"
                 data-placement="top"
                 title="${K.title}">
            </span>`)}),"format-link":new C(K=>{K=K[0]||{};const N=K.external?" target=_blank":"",P=K.href,Q=K.title;return new E(`<a href="${P}" ${N}>${Q}</a>`)}),"format-pill":new C(K=>{return new E(`<span class="badge">${K}</span>`)}),"format-route":new C(K=>{return K=K[0]||{},K.route=K.route||"",new E(`<a href="${window.location.pathname}#/${K.route.replace(".","/")}/${K.id}">${K.title}</a>`)}),"format-filesize":new C(K=>{if(0===K[0])return"0.00 B";const N=Math.floor(Math.log(K[0])/Math.log(1024));return(K[0]/Math.pow(1024,N)).toFixed(2)+" "+" KMGTP".charAt(N)+"B"}),"format-string":new C(K=>K),"format-int":new C(K=>K)}}),define("muc/m",["exports","muc/helper","muc/observable","muc/render-node","muc/component","muc/router"],function(g,q,B,C,D,E){Object.defineProperty(g,"__esModule",{value:!0}),g.M=void 0,"object"!=typeof document&&(global.document={}),Object.values||(Object.values=function(I){return Object.keys(I).map(function(J){return I[J]})}),Object.entries||(Object.entries=function(I){return Object.keys(I).map(function(J){return[J,I[J]]})});class G extends B.O{constructor(){super(),this.id=1,this.components=D.components,this.helpers=q.helpers,this.singletons={},this.rootElement="body",this.actions={id:0},this.loops=[]}documentReady(){const H=document.querySelector(this.rootElement)||document.body;this.router=E.Router.create({owner:this,routes:this.routes}),this.rootNode=C.RenderNode.create({node:{type:"Block",block:[{type:"Component",name:"application-route",attributes:[],content:[]}]},doc:document,parentNode:null,block:B.O.create({}),parentElement:H,owner:this}),console.time("rootNode::render"),this.rootNode.render(),console.timeEnd("rootNode::render"),this.singletons["application-route"]=this.rootNode.children[0].component,this.rootNode.children[0].component.modelHook(),this.router.updateFromLocation(),window.onpopstate=()=>this.router.updateFromLocation()}lookup(H){if(!this.singletons[H]){let I=this.components[H];this.singletons[H]=I?I.create({__name:H,owner:this}):D.RoutableComponent.create({__name:H,owner:this,template:`
                        Autogenerated routable component ${H}
                        <div class="${H}">{{outlet}}</div>
                    `})}return this.singletons[H]}init(){if(~["interactive","complete"].indexOf(document.readyState))setTimeout(()=>this.documentReady(),0);else{const H=document.onreadystatechange;document.onreadystatechange=()=>{H&&H(),~["interactive","complete"].indexOf(document.readyState)&&(document.onreadystatechange=H,this.documentReady())}}}asyncEvent(H){const I=this;return function(J){H.call(this,J),I.loops.length||I.loops.push(setTimeout(()=>{I.update()},0))}}update(){console.log("M::update #########"),this.loops.pop(),this.rootNode.update()}ajax(H){if(H.method=H.method||"GET",H.data&&"GET"===H.method){const I=[];for(let[J,K]of Object.entries(H.data))I.push(`${J}=${encodeURIComponent(K)}`);H.url=`${H.url}?${I.join("&")}`}return new Promise((I,J)=>{const K=new XMLHttpRequest;H.sync?K.open(H.method,H.url,!1):(K.open(H.method,H.url),K.responseType="json");let N=3;const P=this;K.onprogress=this.asyncEvent(Q=>{N=N+(100-N)/2,this.xhrProgress=N}),K.onloadend=this.asyncEvent(Q=>{this.xhrProgress=0}),K.onload=function(){200<=this.status&&300>this.status?(P.ajaxError=null,I(K.response)):(P.ajaxError=K.statusText,J({status:this.status,statusText:K.statusText}))},K.onerror=function(){P.ajaxError=K.statusText,J({status:this.status,statusText:K.statusText})},"GET"!==H.method&&H.data?(K.setRequestHeader("Content-Type","application/json;charset=UTF-8"),K.send(JSON.stringify(H.data))):K.send()})}}g.M=G}),define("muc/observable",["exports"],function(g){function q(T){return T instanceof R||T instanceof P}function B(T,U,V,W){const X=+U;isNaN(X)||(U="@each");const Y=T[H.watched],Z=Y[U];if(Z)for(let $ in Z){const _=Z[$];_.subtree._hasLeaf&&("@each"===U&&isNaN(X)?(V.forEach(da=>{q(da)&&D(da,_.origin,_.subtree,$)}),W.forEach(da=>{q(da)&&C(da,_.origin,_.subtree,$)})):(q(V)&&D(V,_.origin,_.subtree,$),q(W)&&C(W,_.origin,_.subtree,$)));const aa=_.origin.target,ba=_.origin.property,ca=aa[H.watchers][ba];ca.cached&&(ca.cached=!1,B(aa,ba))}}function C(T,U,V,W){const X=T[H.watched];for(let Y in V){const Z=V[Y],$=`${W}.${Y}`;if(X[Y]||(X[Y]={}),X[Y][$]={origin:U,subtree:Z},!!Z._hasLeaf)if("@each"==Y)for(let _=0,aa=T.length;_<aa;_++){const ba=T[_];q(ba)&&C(ba,U,Z,$+`[${_}]`)}else{const _=T[H.watchers][Y];if(!_||_.cached){const aa=T[Y];q(aa)&&C(aa,U,Z,$)}}}}function D(T,U,V,W){const X=T[H.watched];for(let Y in V){const Z=V[Y],$=`${W}.${Y}`;if(delete X[Y][$],!!Z._hasLeaf)if("@each"==Y)for(let _=0,aa=T.length;_<aa;_++){const ba=T[_];q(ba)&&D(ba,U,Z,$+`[${_}]`)}else{const _=T[H.watchers][Y];if(!_||_.cached){const aa=T[Y];q(aa)&&D(aa,U,Z,$)}}}}function E(T){const U=T.join("");if(!K[U]){const V={};T.forEach(W=>{const X=W.split(".");let Y=V;for(let Z=0,$=X.length;Z<$;Z++){const _=X[Z];Y._hasLeaf=!0,Y[_]||(Y[_]={},Object.defineProperty(Y[_],"_hasLeaf",{value:!1,enumerable:!1,writable:!0})),Y=Y[_]}}),K[U]=V}return K[U]}function G(T,U,V){T[H.watchers][U]={keys:V.keys,value:null,cached:!1};const W=T[H.watchers][U];T[H.computed].push(U),Object.defineProperty(T,U,{get(){if(!W.cached){const X=W.value;W.value=V.get.apply(T),B(T,U,X,W.value),W.cached=!0}return W.value},set(X){V.set&&V.set.apply(this,arguments);const Y=this[H.watchers][U];Y.cached=!0,Y.value=X}}),V.keys.length&&C(T,{target:T,property:U},E(V.keys),`${T[H.uuid]}.${U}:`),T[H.watched][U]&&B(T,U,"","")}Object.defineProperty(g,"__esModule",{value:!0}),g.computed=function(...U){let V=U.pop(),W=null;return"object"==typeof V&&(W=V.set,V=V.get),new J(U,V,W)},g.convertComputed=G,g.updateComputed=function(U,V,W){const X=U[H.watchers][V];if(W.length!==X.keys.length||W.some(Y=>!~X.keys.indexOf(Y))){const Y={target:U,property:V};X.keys.length&&D(U,Y,E(X.keys),`${U[H.uuid]}.${V}`),W.length&&C(U,Y,E(W),`${U[H.uuid]}:${V}`),U[H.watchers][V].keys=W}};const H={uuid:"__uuid__",watchers:"__watchers__",watched:"__watched__",computed:Symbol("computed")};let I=0;class J{constructor(T,U,V=null){this.keys=T,this.get=U,this.set=V}}g.Computed=J;const K={},N={set(T,U,V){const W=T[U];return!(W!==V)||(B(T,U,W,V),T[U]=V,!0)},get(T,U){if(T instanceof P){if("instance"===U)return T;if("splice"===U)return function(V,W,...X){const Y=T.splice.apply(T,arguments);return B(T,"@each",Y,X),X.length!==Y.length&&B(T,"length"),Y};if("push"===U)return function(V){return this.splice(this.length,0,V)};if("pop"===U)return function(){return this.splice(this.length-1,1)};if("unshift"===U)return function(V){return this.splice(0,0,V)};if("shift"===U)return function(){return this.splice(0,1)}}return T[U]}};class P extends Array{constructor(){super(),Object.defineProperties(this,{[H.watchers]:{enumerable:!1,value:{}},[H.watched]:{enumerable:!1,value:{}},[H.uuid]:{enumerable:!1,value:I++},[H.computed]:{enumerable:!1,value:[]}})}static create(T){const U=T instanceof Array?P.from(T):new P;return new Proxy(U,N)}}g.A=P;const Q={get(T,U){return"instance"===U?T:T[U]},set(T,U,V){if(T[H.watched][U]){const W=T[U];if(W===V)return!0;B(T,U,W,V)}return T[U]=V,!0}};class R{constructor(){Object.defineProperties(this,{[H.watchers]:{enumerable:!1,value:{}},[H.watched]:{enumerable:!1,value:{}},[H.uuid]:{enumerable:!1,value:I++},[H.computed]:{enumerable:!1,value:[]}})}static create(T){const U=new this;for(let W in Object.assign(U,T),U){const X=U[W];X instanceof J&&G(U,W,X)}const V=new Proxy(U,Q);return V.init(),V}init(){}dispose(){}get __oid__(){return`${this.constructor.name}(${this[H.uuid]})`}get computedProps(){return this[H.computed]}get watcherProps(){return this[H.watchers]}get watchedProps(){return this[H.watched]}getOwner(){return this.owner}}g.O=R}),define("muc/parser3",["exports"],function(g){Object.defineProperty(g,"__esModule",{value:!0}),g.parse=function(I){return new G({input:I}).build()};const q=H=>/[A-Za-z]/.test(H),B=H=>/[0-9]/.test(H),C=H=>/[0-9A-Za-z]/.test(H),D=H=>/[\t\n\f ]/.test(H),E={data(){const H=this.consume();"&"===H?(this.returnState="data",this.state="cref"):"<"===H?this.state="tagOpen":"{"===H?(this.returnState="data",this.state="mustacheOpen"):this.emit({type:"Literal",value:H})},tagOpen(){const H=this.consume();if("/"===H)this.state="endTagOpen";else if(q(H))this.token={type:"StartTag",name:"",attrs:[]},this.state="tagName",this.pos--;else if("!"===H)this.state="commentStart";else throw new Error("Tagname expected?")},endTagOpen(){const H=this.consume();if(q(H))this.token={type:"EndTag",name:"",attrs:[]},this.state="tagName",this.pos--;else if(">"===H)throw new Error("No tagname in closing tag")},tagName(){const H=this.consume();D(H)?this.state="beforeAttributeName":"/"===H?this.state="selfClosingStartTag":">"===H?(this.state="data",this.emit(this.token)):this.token.name+=H},beforeAttributeName(){const H=this.consume();if(D(H));else if("/"===H||">"===H)this.pos--,this.state="afterAttributeName";else if("="===H)throw new Error("Tagname cannot start with =");else"{"===H?(this.attr={name:"",value:[]},this.token.attrs.push(this.attr),this.returnState="beforeAttributeName",this.state="attributeMustacheOpen"):(this.attr={name:"",value:[]},this.token.attrs.push(this.attr),this.pos--,this.state="attributeName")},attributeName(){const H=this.consume();D(H)||"/"===H||">"===H?(this.pos--,this.state="afterAttributeName"):"="===H?this.state="beforeAttributeValue":this.attr.name+=H},afterAttributeName(){const H=this.consume();if(D(H));else if("/"===H)this.state="selfClosingStartTag";else if("="===H)this.state="beforeAttributeValue";else if(">"===H)this.state="data",this.emit(this.token);else if("{"===H)throw this.attr={name:"",value:[]},this.token.attrs.push(this.attr),this.returnState="afterAttributeName",this.state="attributeMustacheOpen",new Error("TODO: Check what triggers this");else this.attr={name:"",value:[]},this.token.attrs.push(this.attr),this.pos--,this.state="attributeName"},beforeAttributeValue(){const H=this.consume();if(D(H));else if("\""===H||"'"===H)this.q=H,this.state="attributeValueQ";else if(">"===H)throw new Error("Expected attribute value");else this.pos--,this.state="attributeValueU"},attributeValueQ(){const H=this.consume();if(H===this.q)this.state="afterAttributeValueQ";else if("&"===H)this.returnState="attributeValueQ",this.state="cref";else if("{"===H)this.returnState="attributeValueQ",this.state="attributeValueMustacheOpen";else{const I=this.attr.value.slice(-1)[0];I&&"Literal"===I.type?I.value+=H:this.attr.value.push({type:"Literal",value:H})}},attributeValueU(){const H=this.consume();if(D(H))this.state="beforeAttributeName";else if("&"===H)this.returnState="attributeValueU",this.state="cref";else if(">"===H)this.state="data",this.emit(this.token);else if("{"===H)this.returnState="attributeValueU",this.state="attributeValueMustacheOpen";else{const I=this.attr.value.slice(-1)[0];I&&"Literal"===I.type?I.value+=H:this.attr.value.push({type:"Literal",value:H})}},afterAttributeValueQ(){const H=this.consume();if(D(H))this.state="beforeAttributeName";else if("/"===H)this.state="selfClosingStartTag";else if(">"===H)this.state="data",this.emit(this.token);else throw new Error("Unexpected token after attribute")},selfClosingStartTag(){const H=this.consume();if(">"===H)this.token.selfClosing=!0,this.state="data",this.emit(this.token);else throw new Error("Unexpected token / in self closing")},commentStart(){const H=this.consume();if("-"===H)this.state="commentStartDash";else if(">"===H)throw new Error("Unexpected token");else this.pos--,this.state="comment"},commentStartDash(){const H=this.consume();if("-"===H)this.state="commentEnd";else if(">"===H)throw new Error("Unexpected token");else this.commentToken=H,this.pos--,this.state="comment"},comment(){const H=this.consume();"<"===H?(this.commentToken+=H,this.state="commentLessThanSign"):"-"===H?this.state="commentEndDash":this.commentToken+=H},commentLessThanSign(){const H=this.consume();"!"===H?(this.commentToken+=H,this.state="commentLessThanSignBang"):"<"===H?this.commentToken+=H:(this.pos--,this.state="comment")},commentLessThanSignBang(){const H=this.consume();"-"===H?this.state="commentLessThanSignBangDash":(this.pos--,this.state="comment")},commentLessThanSignBangDash(){const H=this.consume();"-"===H?this.state="commentLessThanSignBangDashDash":(this.pos--,this.state="commentEndDash")},commentLessThanSignBangDashDash(){const H=this.consume();if(">"===H)this.pos--,this.state="comment";else throw new Error("Unexpected token")},commentEndDash(){const H=this.consume();"-"===H?this.state="commentEnd":(this.commentToken+="-",this.pos--,this.state="comment")},commentEnd(){const H=this.consume();">"===H?(this.state="data",this.emit({type:"comment",value:this.commentToken})):"!"===H?this.state="commentEndBang":"-"===H?this.commentToken+=H:(this.commentToken+="--",this.pos--,this.state="comment")},commentEndBang(){const H=this.consume();if("-"===H)this.commentToken+="--!",this.state="commentEndDash";else if(">"===H)throw new Error("Unexpected token");else this.commentToken+="--!",this.pos--,this.state="comment"},cref(){const H={nbsp:"\xA0",times:"\xD7",laquo:"\xAB",raquo:"\xBB"};this.t="&";const I=this.consume();if(D(I)||"<"===I||"&"===I)this.pos--,this.state="characterReferenceEnd";else if("#"===I)this.t+=I,this.state="numericCharacterReference";else{this.t+=I;for(let J=Object.keys(H).filter(P=>P[0]===I);J.length;)this.t+=this.consume(),J=J.filter(P=>P[this.t.length-2]===this.t.slice(-1));const K=this.t.slice(1,-1),N=this.t.slice(-1);if(!(K in H)){if(/^[a-zA-Z0-9]+$/.test(K)&&";"===N)throw new Error(`"${K}" is not a named entity`);else this.pos-=this.t.length-1,this.t="&",this.state="characterReferenceEnd";}else if(("attributeValueQ"===this.returnState||"attributeValueU"===this.returnState)&&("="===N||q(N)))this.state="characterReferenceEnd";else if(";"!==N)throw new Error(`Character reference &${K} not terminated with ";"`);else this.t=H[K],this.state="characterReferenceEnd"}},numericCharacterReference(){this.v=0;const H=this.consume();"x"===H||"X"===H?(this.t+=H,this.state="hexadecimalCharacterReferenceStart"):(this.pos--,this.state="decimalCharacterReferenceStart")},hexadecimalCharacterReferenceStart(){const H=this.consume();if(C(H))this.pos--,this.state="hexadecimalCharacterReference";else throw new Error("Hex digit expected")},decimalCharacterReferenceStart(){const H=this.consume();if(B(H))this.pos--,this.state="decimalCharacterReference";else throw new Error("Digit expected")},hexadecimalCharacterReference(){const H=this.consume();if(C(H))this.v*=16,this.v+=parseInt(H,16);else if(";"===H)this.state="numericCharacterReferenceEnd";else throw new Error(`Hex digit or ; expected. Got ${H} instead`)},decimalCharacterReference(){const H=this.consume();if(B(H))this.v*=10,this.v+=parseInt(H,10);else if(";"===H)this.state="numericCharacterReferenceEnd";else throw new Error("Hex digit or ; expected")},numericCharacterReferenceEnd(){this.t=String.fromCharCode(this.v),this.state="characterReferenceEnd"},characterReferenceEnd(){if("attributeValueQ"===this.returnState||"attributeValueU"===this.returnState){const H=this.attr.value.slice(-1)[0];H&&"Literal"===H.type?H.value+=this.t:this.attr.value.push({type:"Literal",value:this.t})}else this.emit({type:"Literal",value:this.t});this.state=this.returnState},mustacheOpen(){const H=this.consume();"{"===H?this.state="mustache":(this.emit({type:"Literal",value:"{"}),this.pos--,this.state=this.returnState)},attributeMustacheOpen(){const H=this.consume();"{"===H?this.state="mustache":(this.pos-=2,this.state="attributeName")},attributeValueMustacheOpen(){const H=this.consume();if("{"===H)this.state="mustache";else throw new Error("Need to back track if not double { in attr value")},mustache(){const H=this.consume();"!"===H?(this.mtoken={type:"MustacheComment",value:""},this.state="mustacheComment"):(this.mtoken={type:"MustacheContent",value:[]},this.mstack=[this.mtoken.value],this.pos--,this.state="mustacheContent")},mustacheComment(){const H=this.consume();"}"===H?this.state="mustacheCommentEnd":this.mtoken.value+=H},mustacheCommentEnd(){const H=this.consume();if("}"===H){if("data"===this.returnState)this.emit(this.mtoken);else throw new Error("Cannot emit mustache comment inside tag");this.state=this.returnState}else this.mtoken.value+="}",this.mtoken.value+=H,this.state="mustacheComment"},mustacheContent(){const H=this.consume();if("#"===H)this.mstack.slice(-1)[0].push({type:"BlockOpen",value:""}),this.state="mustacheBlockOpen";else if("/"===H)this.mstack.slice(-1)[0].push({type:"BlockClose",value:""}),this.state="mustacheBlockClose";else if("|"===H)this.mstack.slice(-1)[0].push({type:"BlockParams",value:""}),this.state="mustacheBlockParams";else if("\""===H)this.mstack.slice(-1)[0].push({type:"Literal",value:""}),this.state="mustacheLiteral";else if(B(H))this.mstack.slice(-1)[0].push({type:"Literal",value:+H}),this.state="mustacheLiteralNumber";else if("("===H){const I={type:"Expression",value:[]};this.mstack.slice(-1)[0].push(I),this.mstack.push(I.value)}else if(")"===H){if(1===this.mstack.length)throw new Error("Stray \")\" in mustache found");this.mstack.pop()}else if(q(H))this.mstack.slice(-1)[0].push({type:"Identifier",value:H}),this.state="mustacheIdentifier";else if(D(H));else if("}"===H)this.state="mustacheEndOrFail";else throw new Error(`Mustache content broken "${H}"`)},mustacheBlockOpen(){const H=this.consume();if(D(H))this.state="mustacheContent";else if("}"===H)this.state="mustacheEndOrFail";else if(q(H))this.mstack.slice(-1)[0].slice(-1)[0].value+=H;else throw new Error("Unexpected token '}'")},mustacheBlockClose(){const H=this.consume();if("}"===H)this.state="mustacheEndOrFail";else if(q(H))this.mstack.slice(-1)[0].slice(-1)[0].value+=H;else throw new Error(`Unexpected token \'${H}\'`)},mustacheBlockParams(){const H=this.consume();"|"===H?this.state="mustacheContent":this.mstack.slice(-1)[0].slice(-1)[0].value+=H},mustacheLiteral(){const H=this.consume();"\""===H?this.state="mustacheContent":this.mstack.slice(-1)[0].slice(-1)[0].value+=H},mustacheLiteralNumber(){const H=this.consume();if(B(H))this.mstack.slice(-1)[0].slice(-1)[0].value*=10,this.mstack.slice(-1)[0].slice(-1)[0].value+=+H;else if(D(H)||")"===H)this.pos--,this.state="mustacheContent";else if("}"===H)this.state="mustacheEndOrFail";else throw new Error(`Cannot parse digit ${H}`)},mustacheIdentifier(){const H=this.consume(),I=["undefined","null","true","false"];if(D(H)||")"===H){this.pos--;const J=this.mstack.slice(-1)[0].slice(-1)[0];if(~I.indexOf(J.value)){J.type="Literal";const K=J.value[0];J.value="u"===K?void 0:"n"===K?null:!("t"!==K)}this.state="mustacheContent"}else if("}"===H){const J=this.mstack.slice(-1)[0].slice(-1)[0];if(~I.indexOf(J.value)){J.type="Literal";const K=J.value[0];J.value="u"===K?void 0:"n"===K?null:!("t"!==K)}this.state="mustacheEndOrFail"}else if("="===H){const J=this.mstack.slice(-1)[0].slice(-1)[0];J.type="Key",this.state="mustacheContent"}else if(q(H)||"-"===H||"."===H||"_"===H)this.mstack.slice(-1)[0].slice(-1)[0].value+=H;else throw new Error(`Unexpected token "${H}"`)},mustacheEndOrFail(){const H=this.consume();if("}"===H){if(1!==this.mstack.length)throw new Error("Not all expressions closed");"data"===this.returnState?this.emit(this.mtoken):this.attr.value.push(this.mtoken),this.state=this.returnState}else throw new Error(`Unexpected token "${H}" after "}"`)}};class G{constructor({input:H}){this.input=H,this.pos=0,this.state="data"}consume(){return this.input[this.pos++]}emit(H){if("EndTag"===H.type)if(H.selfClosing)throw new Error("EndTags cannot be self-closing");else if(H.attrs.length)throw new Error("EndTags cannot have attrs");this.tokens.push(H)}tokenize(){for(this.tokens=[];this.pos<this.input.length;)E[this.state].call(this);return this.tokens}build(){const H=["br","img","input"],I=[{name:"root",content:[],params:[]}],J=N=>{return~I.reduce((P,Q)=>P.concat(Q.params),[]).indexOf(N.split(".")[0])},K=N=>{if("Identifier"===N.type)return{type:"Identifier",value:`block.${J(N.value)?"":"ctx."}${N.value}`};return"Expression"===N.type||"Invocation"===N.type?{type:N.type,value:N.value.map(K).reduce((P,Q)=>{const R=P.slice(-1)[0];return R&&"Key"===R.type?(R.name=R.value,R.type=Q.type,R.value=Q.value,P):P.concat([Q])},[])}:N};try{this.tokenize()}catch(N){const P=this.input.split("\n");for(let Q=this.pos,R=0;Q>P[R].length;)Q-=P[R].length+1,R++;throw new Error(`
                Line content: ${P[R]}
                Parser error at line: ${R+1} col: ${Q} abs: ${this.pos}
                ${N.message}
            `)}for(let N of this.tokens)if("Literal"===N.type){const P=I.slice(-1)[0].content.slice(-1)[0];P&&"Literal"===P.type?P.value+=N.value:I.slice(-1)[0].content.push(N)}else if("StartTag"===N.type){let P=N.attrs.map(T=>{return"as"===T.name?T:(T.value=T.value.map(U=>{return"MustacheContent"===U.type&&(1<U.value.length?U.type="Invocation":1===U.value.length&&(U=U.value[0])),U}),1<T.value.length?T.value=K({type:"Expression",value:[{type:"Literal",value:"concat"}].concat(T.value)}):1===T.value.length&&(T.value=K(T.value[0])),T)});const Q=P.filter(T=>"as"===T.name),R={type:/-/.test(N.name)?"Component":"Tag",name:N.name,attributes:P.filter(T=>"as"!==T.name),params:Q.length?Q[0].value[0].value.split(" "):[],content:[]};I.slice(-1)[0].content.push(R),~H.indexOf(N.name)||N.selfClosing||I.push({name:N.name,content:R.content,params:R.params})}else if("EndTag"===N.type){if(N.name!==I.slice(-1)[0].name)throw new Error(`Unexpected end tag ${N.name}`);else I.pop();}else if("MustacheComment"===N.type||"comment"===N.type);else if("MustacheContent"===N.type){const[P,...Q]=N.value;if("Identifier"===P.type||"Expression"===P.type){if("else"===P.value){const R=I.slice(-1)[0];if("each"===R.name){if(Q.length)throw new Error("Malformed else on each");const T=I.slice(-2)[0].content.slice(-1)[0];T.catchempty=[],R.content=T.catchempty}else if("if"===R.name){Q.length&&"if"===Q[0].value&&Q.shift();const T=I.slice(-2)[0].content.slice(-1)[0],U=Q[0]?K(Q[0]):null;T.branches.push({condition:U,content:[]}),R.content=T.branches.slice(-1)[0].content}else throw new Error(`Mustache else out of scope ${R.name}`)}else Q.length?I.slice(-1)[0].content.push(K({type:"Invocation",value:N.value})):I.slice(-1)[0].content.push(K(P));}else if("BlockOpen"===P.type){let R;"each"===P.value?(R={type:"Loop",list:K(Q[0]),params:Q[2].value.split(" "),content:[]},I.slice(-1)[0].content.push(R),I.push({name:P.value,content:R.content,params:Q[2].value.split(" ")})):"if"===P.value?(R={type:"Condition",branches:[{condition:K(Q[0]),content:[]}]},I.slice(-1)[0].content.push(R),I.push({name:P.value,content:R.branches[0].content})):(R={type:"Block",name:P.value,attributes:Q.map(K),content:[]},I.slice(-1)[0].content.push(R),I.push({name:P.value,content:R.content}))}else if(!("BlockClose"===P.type))throw new Error(`Do not know ${P.type}`);else if(P.value!==I.slice(-1)[0].name)throw new Error(`Unexpected end tag ${P.value}`);else I.pop()}else throw new Error(`Unknown type ${N.type}`);if(1!==I.length)throw new Error(`Unclosed element ${I[1].name}`);return I[0].content}}g.ASTBuilder=G}),define("muc/render-node",["exports","muc/observable","muc/helper"],function(g,q,B){Object.defineProperty(g,"__esModule",{value:!0}),g.RenderNode=void 0;const C={};class D extends q.O{constructor(E){super(E),this.dynamicChildren=[]}addDynamic(E){this.computedProps.length||this.component||!this.parentNode?(this.dynamicChildren.push(E),delete this.updateFn):this.parentNode.addDynamic(E)}removeDynamic(E){this.computedProps.length||this.component||!this.parentNode?(this.dynamicChildren.splice(this.dynamicChildren.indexOf(E),1),delete this.updateFn):this.parentNode.removeDynamic(E)}init(){Object.defineProperty(this,"parentNode",{enumerable:!1,value:this.parentNode})}getPath(E){if(!C[E]){console.assert("block."===E.substr(0,6),`Path should start with block., ${E}`);const G=E.split(".");let H=["obj = obj.block;"];for(let I=1,J=G.length-1;I<J;I++)H.push(`
                    if (typeof obj === 'object') {
                        obj = obj.${G[I]};
                    } else {
                        return '';
                    }
                `);H.push(`return obj ? obj.${G[G.length-1]} : '';`),C[E]=new Function("obj",H.join("\n"))}return C[E](this)}setPath(E,G){const H=E.split(".");let I=this;for(let J=0,K=H.length-1;J<K;J++)if(I=I[H[J]],"object"!=typeof I)throw new Error(`Cannot set path ${E} to ${G}`);I[H[H.length-1]]=G}getHelper(E){const G=this.getOwner().helpers[E];if(!G)throw new Error(`Helper ${E} does not exist.`);return G}evaluate(E,G,H,I){if("Literal"===E.type)return~G.indexOf(E.value)||G.push(E.value),`__lit[${G.indexOf(E.value)}]`;if("Identifier"===E.type)return~H.indexOf(E.value)||H.push(E.value),`__ide[${H.indexOf(E.value)}]`;if("Expression"===E.type||"Invocation"===E.type){if("noexpand"===E.value[0].value)return G.push(E.value.slice(1)),`__lit[${G.length-1}]`;const J=this.evaluate(E.value[0],G,H,I),K=`obj.getHelper(${J})`;~I.indexOf(K)||I.push(K);const N=`__con${I.indexOf(K)}`,P=E.value.slice(1).map(Q=>this.evaluate(Q,G,H,I));return`(${N}.expr ? ${N}.fn.call(obj, ${P}) : ${N}.fn.call(obj, [${P}], triggers))`}throw new Error(`${E.type} is no good`)}evalExpression(E,G){if("Literal"===E.type)return E.value;if("Identifier"===E.type)return G[E.value]=!0,this.getPath(E.value);if(!E.fn){const H=[],I=[],J=[],K=this.evaluate(E,H,I,J),N=[];for(let P in I)N.push(`triggers["${I[P]}"] = true;`);for(let P=0;P<J.length;P++)N.push(`const __con${P} = ${J[P]};`);N.push(`return ${K};`),E.fn=new Function("obj","triggers","__lit","__ide",N.join("\n")),E.__lit=H,E.__ide=I}return E.fn(this,G,E.__lit,E.__ide.map(H=>this.getPath(H)))}createUpdater(E,G,H){(0,q.convertComputed)(this,E,{get(){let I={};const J=this.evalExpression(G,I);if("Loop"===this.node.type){const K=`${Object.keys(I)[0]}.@each`;I={},I[K]=!0}H.apply(this,[J]),(0,q.updateComputed)(this,E,Object.keys(I))},set:null,keys:[]}),this[E]}render(){const E=this.node,G=this.instance;if("Block"===E.type){G.children=[];for(let I=0,J=E.block.length;I<J;I++)G.children.push(D.create({node:E.block[I],doc:G.doc,parentNode:this,block:G.block,parentElement:G.parentElement,owner:G.owner}));for(let I=0,J=G.children.length;I<J;I++)G.children[I].render()}else if("Tag"===E.type){const I=G.doc.createElement(E.name);G.parentElement.appendChild(I),G.elements=[I];for(let K=0,N=E.attributes.length;K<N;K++){const P=E.attributes[K];if(P.name)"Literal"===P.value.type?I.setAttribute(P.name,P.value.value):this.createUpdater(`watch-${P.name}`,P.value,Q=>{"undefined"!=typeof Q&&!1!==Q?I.setAttribute(P.name,Q):I.removeAttribute(P.name)});else{let Q=null;this.createUpdater(`watch-${Math.random()}`,P.value,R=>{R?(Q=R.name,I.setAttribute(Q,R.value)):Q&&(I.removeAttribute(Q),Q=null)})}}const J=q.A.from(E.content.map(K=>{return D.create({node:K,doc:G.doc,parentNode:this,block:G.block,parentElement:I,owner:G.owner})}));for(let K=0,N=J.length;K<N;K++)J[K].render();G.children=J}else if("Literal"===E.type){const I=G.doc.createTextNode(E.value);G.parentElement.appendChild(I),G.elements=[I]}else if("Identifier"===E.type&&"block.ctx.outlet"===E.value){for(var H=this;H&&!H.component;)H=H.parentNode;H.outlet=this,this.createUpdater("watch-outlet",E,I=>{if(this.component&&this.component.unrender(),I){I.renderNode=this,I.render();const J=this.getNextElement();this.getElements().forEach(K=>this.parentElement.insertBefore(K,J))}this.component=I,delete this.updateFn})}else if("Identifier"===E.type||"Expression"===E.type){const I=this.doc.createTextNode("");this.parentElement.appendChild(I),this.elements=[I],this.createUpdater("watch-content",E,J=>{"undefined"==typeof J&&(J="");const K=this.elements;if(J instanceof B.HTML){const N=this.doc.createElement("div");N.innerHTML=J.content,this.elements=Array.from(N.children),this.elements.forEach(P=>this.parentElement.insertBefore(P,K[0])),K.forEach(P=>P.remove())}else{const N=this.doc.createTextNode(J);this.elements=[N],this.parentElement.insertBefore(N,K[0]),K.forEach(P=>P.remove())}})}else if("Invocation"===E.type)throw new Error("do not use invocation");else if("Condition"===E.type)E.expr||(E.expr={type:"Expression",value:[{type:"Literal",value:"findCondition"},{type:"Literal",value:E.branches.map(I=>I.condition)}]}),this.createUpdater("watch-condition",E.expr,I=>{if(G.branch!==I){G.children&&(G.children.forEach(K=>K.dispose()),G.children=void 0),G.branch=I;const J=E.branches[I];if(J){G.children=q.A.from(J.content.map(N=>{return D.create({node:N,doc:G.doc,parentNode:this,block:G.block,parentElement:G.parentElement,owner:G.owner})}));for(let N=0,P=G.children.length;N<P;N++)G.children[N].render();const K=this.getNextElement();G.getElements().forEach(N=>G.parentElement.insertBefore(N,K))}delete this.updateFn}});else if("Loop"===E.type)this.createUpdater("watch-loop",E.list,I=>{if(I&&I.length){G.children||(G.children=q.A.create());for(let K=I.length,N=G.children.length;K<N;K++)G.children[K].dispose();G.children.splice(I.length,G.children.length-I.length);for(let K=0,N=I.length;K<N;K++)if(K>=G.children.length){100<I.length&&0==K&&(console.time("loop create"),console.log("start")),100<I.length&&K==I.length-1&&(console.timeEnd("loop create"),console.log("stop")),100<I.length&&0==K%100&&console.log(K);const P=q.O.create({});Object.assign(P,G.block),E.params[0]&&(P[E.params[0]]=I[K]),E.params[1]&&(P[E.params[1]]=K),G.children.push(D.create({node:{type:"Block",block:E.content},doc:G.doc,parentNode:this,block:P,parentElement:G.parentElement,owner:G.owner})),G.children[K].render()}else if(G.children[K].node.block!=E.content){console.log("readd",K);const P=q.O.create({});Object.assign(P,G.block),E.params[0]&&(P[E.params[0]]=I[K]),E.params[1]&&(P[E.params[1]]=K),G.children[K].dispose(),G.children[K]=D.create({node:{type:"Block",block:E.content},doc:G.doc,parentNode:this,block:P,parentElement:G.parentElement,owner:G.owner}),G.children[K].render()}else G.children[K].block[E.params[0]]=I[K]}else if(E.catchempty){G.children&&(G.children.forEach(K=>K.dispose()),G.children=void 0),G.children=q.A.create([D.create({node:{type:"Block",block:E.catchempty},doc:G.doc,parentNode:this,block:G.block,parentElement:G.parentElement,owner:G.owner})]);for(let K=0,N=G.children.length;K<N;K++)G.children[K].render()}else G.children&&(G.children.forEach(K=>K.dispose()),G.children=void 0);const J=G.getNextElement();G.getElements().forEach(K=>G.parentElement.insertBefore(K,J)),delete this.updateFn});else if("Component"===E.type){const I=G.getOwner().components[E.name];if(!I)throw new Error(`Component ${E.name} does not exist`);G.component=I.create({renderNode:this,owner:G.owner}),G.component.render()}else throw new Error(`AST node ${E.type} is not known`);this.parentNode&&(this.computedProps.length||this.component)&&this.parentNode.addDynamic(this)}dispose(){this.component&&this.component.dispose(),this.children&&this.children.forEach(E=>E.dispose()),this.elements&&this.elements.forEach(E=>E.remove()),this.parentNode&&(this.computedProps.length||this.component)&&this.parentNode.removeDynamic(this),super.dispose()}getElements(){return this.elements||this.children&&this.children.reduce((E,G)=>E.concat(G.getElements()),[])||[]}getNextElement(){if(!this.parentNode)return null;const E=this.parentNode.children;if(!E){if(this.parentNode.elements)return null;return this.parentNode.getNextElement()}let G=-1;E.forEach((I,J)=>{I.node===this.node&&(G=J)});const H=E.slice(G+1).reduce((I,J)=>I.concat(J.getElements()),[]);if(H.length)return H[0];return this.parentNode.elements?null:this.parentNode.getNextElement()}update(){if(!this.updateFn){const E=[],G=this.computedProps;G.forEach(H=>E.push(`this['${H}'];`)),this.dynamicChildren.length&&(E.push("if (!this.updateFn) { return this.update(); }"),E.push("const children = this.dynamicChildren;"),this.dynamicChildren.forEach((H,I)=>E.push(`children[${I}].update();`))),this.updateFn=new Function(E.join("\n"))}return this.updateFn()}}g.RenderNode=D}),define("muc/router",["exports","muc/observable"],function(g,q){Object.defineProperty(g,"__esModule",{value:!0}),g.Router=void 0;class B extends q.O{init(){super.init(),this.stack=[],this.currentTransition=null,this.currentRoute=null}locationToPath(){if("object"!=typeof window)return{query:null,path:null};const C={},D=window.location.search.substr(1).split("&").filter(G=>G);for(let G=0,H=D.length;G<H;G++){const I=D[G],J=I.substr(0,I.indexOf("=")),K=I.slice(J.length+1);C[J]=K}let E=window.location.hash;return"#"===E[0]&&(E=E.slice(1)),{query:C,path:E}}updateFromLocation(){this.performTransition(this.pathToStack(this.locationToPath()))}stackToLocation(C){const D=[];for(let G of Object.entries(C[0].query))D.push(`${G[0]}=${G[1].replace(/&/,"%26")}`);let E="";return D.length&&(E+=`?${D.join("&")}`),E+"#/"+C.map(G=>{return"undefined"==typeof G.route.path?G.route.name:G.route.path}).filter(G=>G).join("/")}transitionTo({route:C,models:D,query:E}){C=C||this.currentRoute,D=D||[],E=Object.assign(this.locationToPath().query,E),console.assert(!D.length,"Model passing not implemented yet");const G=[];for(let H of C.split("."))G.push({route:(0===G.length?this.routes:G.slice(-1)[0].route.routes).filter(I=>I.name===H)[0],dynamics:{},query:E});this.performTransition(G),history.pushState(null,null,this.stackToLocation(G))}pathToStack({path:C,query:D}){const E=C.split("/").filter(I=>!!I.length),G=(I,J)=>{const K=J.map(N=>{const P=I.slice(0),Q=("string"==typeof N.path?N.path:N.name).split("/"),R={};let T=0;for(let V=0,W=Q.length;V<W;V++){let X=Q[V];if(""!==X){if(T*=10,"*"===X[0])return T+=3,T*=Math.pow(10,I.length-1),R[X.slice(1)]=P.join("/"),{score:T,stack:[{route:N,dynamics:R,query:D}]};if(":"===X[0])T+=2,R[X.slice(1)]=P.shift();else if(X===P[0])T+=1,P.shift();else return{score:1/0}}}const U=G(P,N.routes||[])||{score:1/0};if(U.score!==1/0)return T*=Math.pow(10,P.length),T+=U.score,{score:T,stack:[{route:N,dynamics:R,query:D}].concat(U.stack)};return P.length?U:{score:T,stack:[{route:N,dynamics:R,query:D}]}}).sort((N,P)=>N.score-P.score);return K[0]},H=G(E,this.routes);return H.stack}performTransition(C){var _this2=this;return _asyncToGenerator(function*(){const D=function(J,K){if(J.route!=K.route)return!1;if(Object.keys(J.dynamics).length!==Object.keys(K.dynamics).length)return!1;for(let[N,P]of Object.entries(J.dynamics))if(P!==K[N])return!1;for(let[N,P]of Object.entries(J.route.queryParams||{}))if(P.refreshModel&&J.query[N]!==K.query[N])return!1;return!0};for(var E=0;C[E]&&_this2.stack[E]&&D(C[E],_this2.stack[E]);)E++;const G=function(J){return`${_this2.stack.slice(0,J+1).map(function(K){return K.route.name}).join("-")}-route`},H=function(J){return`${C.slice(0,J+1).map(function(K){return K.route.name}).join("-")}-route`},I={aborted:!1,abort(){this.aborted=!0},stack:C};for(let J=_this2.stack.length-1;J>=E;J--){const K=_this2.stack[J],N=_this2.getOwner().lookup(`${K.route.name}-route`);if(N.willTransition(I),I.aborted)return}for(let J=0;J<E;J++){const K=_this2.getOwner().lookup(H(J));for(let N of Object.keys(C[J].route.queryParams||{}))K[N]=C[J].query[N]}for(let J=E;J<C.length;J++){const K=_this2.getOwner().lookup(H(J));for(let N of Object.keys(C[J].route.queryParams||{}))C[J].dynamics[N]=K[N]=C[J].query[N];if(!C[J].model){const N=yield K.modelHook(C[J].dynamics);C[J].model=N}}for(let J=_this2.stack.length-1;J>=E;J--){const K=_this2.stack.pop(),N=_this2.getOwner().lookup(`${K.route.name}-route`);let P;P=0===E?_this2.getOwner().lookup("application-route"):_this2.getOwner().lookup(G(E-1)),P.outlet=null,P.renderNode.update(),N.didLeave()}for(;E<C.length;E++){_this2.stack[E]=C[E];const J=_this2.getOwner().lookup(G(E));J.model=C[E].model;let K;K=0===E?_this2.getOwner().lookup("application-route"):_this2.getOwner().lookup(G(E-1)),J.tagName=G(E),K.outlet=J,K.renderNode.update(),J.didEnter()}_this2.currentRoute=_this2.stack.map(function(J){return J.route.name}).join(".")})()}}g.Router=B}),require(["app"]);